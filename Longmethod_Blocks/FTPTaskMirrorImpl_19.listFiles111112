FTPFile#[#]#listFiles#(#String#directory#,#boolean#changedir#)#{##//task.log("listing files in directory " + directory, Project.MSG_DEBUG);#String#currentPath#=#directory#;##if#(#changedir#)#{#try#{#boolean#result#=#ftp#.#changeWorkingDirectory#(#directory#)#;##if#(#!#result#)#{##return#null#;#}##currentPath#=#ftp#.#printWorkingDirectory#(#)#;#}##catch#(#IOException#ioe#)#{#throw#new#BuildException#(#ioe#,#task#.#getLocation#(#)#)#;#}#}##if#(#fileListMap#.#containsKey#(#currentPath#)#)#{#task#.#log#(#"filelist map used in listing files"#,#Project#.#MSG_DEBUG#)#;##return#(#(#FTPFile#[#]#)#fileListMap#.#get#(#currentPath#)#)#;#}##FTPFile#[#]#result#=#null#;##try#{#result#=#ftp#.#listFiles#(#)#;#}##catch#(#IOException#ioe#)#{#throw#new#BuildException#(#ioe#,#task#.#getLocation#(#)#)#;#}##fileListMap#.#put#(#currentPath#,#result#)#;##if#(#!#remoteSensitivityChecked#)#{#checkRemoteSensitivity#(#result#,#directory#)#;#}##return#result#;#}