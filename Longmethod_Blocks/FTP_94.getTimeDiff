long#getTimeDiff#(#FTPClient#ftp#)#{#long#returnValue#=#0#;#File#tempFile#=#findFileName#(#ftp#)#;##try#{##// create a local temporary file#FILE_UTILS#.#createNewFile#(#tempFile#)#;#long#localTimeStamp#=#tempFile#.#lastModified#(#)#;#BufferedInputStream#instream#=#new#BufferedInputStream#(#new#FileInputStream#(#tempFile#)#)#;#ftp#.#storeFile#(#tempFile#.#getName#(#)#,#instream#)#;#instream#.#close#(#)#;#boolean#success#=#FTPReply#.#isPositiveCompletion#(#ftp#.#getReplyCode#(#)#)#;##if#(#success#)#{#FTPFile#[#]#ftpFiles#=#ftp#.#listFiles#(#tempFile#.#getName#(#)#)#;##if#(#ftpFiles#.#length#==#1#)#{#long#remoteTimeStamp#=#ftpFiles#[#0#]#.#getTimestamp#(#)#.#getTime#(#)#.#getTime#(#)#;#returnValue#=#localTimeStamp#-#remoteTimeStamp#;#}##ftp#.#deleteFile#(#ftpFiles#[#0#]#.#getName#(#)#)#;#}##// delegate the deletion of the local temp file to the delete task##// because of race conditions occuring on Windows#Delete#mydelete#=#new#Delete#(#)#;#mydelete#.#bindToOwner#(#this#)#;#mydelete#.#setFile#(#tempFile#.#getCanonicalFile#(#)#)#;#mydelete#.#execute#(#)#;#}##catch#(#Exception#e#)#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}##return#returnValue#;#}