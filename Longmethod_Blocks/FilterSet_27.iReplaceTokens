String#iReplaceTokens#(#String#line#)#{#String#beginToken#=#getBeginToken#(#)#;#String#endToken#=#getEndToken#(#)#;#int#index#=#line#.#indexOf#(#beginToken#)#;##if#(#index#>#-#1#)#{#Hashtable#tokens#=#getFilterHash#(#)#;##try#{#StringBuffer#b#=#new#StringBuffer#(#)#;#int#i#=#0#;#String#token#=#null#;#String#value#=#null#;##while#(#index#>#-#1#)#{##//can't have zero-length token#int#endIndex#=#line#.#indexOf#(#endToken#,#index#+#beginToken#.#length#(#)#+#1#)#;##if#(#endIndex#==#-#1#)#{#break#;#}##token#=#line#.#substring#(#index#+#beginToken#.#length#(#)#,#endIndex#)#;#b#.#append#(#line#.#substring#(#i#,#index#)#)#;##if#(#tokens#.#containsKey#(#token#)#)#{#value#=#(#String#)#tokens#.#get#(#token#)#;##if#(#recurse#&&#!#value#.#equals#(#token#)#)#{##// we have another token, let's parse it.#value#=#replaceTokens#(#value#,#token#)#;#}##log#(#"Replacing: "#+#beginToken#+#token#+#endToken#+#" -> "#+#value#,#Project#.#MSG_VERBOSE#)#;#b#.#append#(#value#)#;#i#=#index#+#beginToken#.#length#(#)#+#token#.#length#(#)#+#endToken#.#length#(#)#;#}#else#{##// just append first character of beginToken##// and search further##// we can't skip the complete beginToken since##// it may contain the start of another##// candidate begin token (Bugzilla 45094)#b#.#append#(#beginToken#.#charAt#(#0#)#)#;#i#=#index#+#1#;#}##index#=#line#.#indexOf#(#beginToken#,#i#)#;#}##b#.#append#(#line#.#substring#(#i#)#)#;##return#b#.#toString#(#)#;#}##catch#(#StringIndexOutOfBoundsException#e#)#{##return#line#;#}#}#else#{##return#line#;#}#}