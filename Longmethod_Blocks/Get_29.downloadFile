boolean#downloadFile#(#)#throws#FileNotFoundException#,#IOException#{#for#(#int#i#=#0#;##i#<#numberRetries#;#i#++#)#{##// this three attempt trick is to get round quirks in different##// Java implementations. Some of them take a few goes to bind##// property; we ignore the first couple of such failures.#try#{#is#=#connection#.#getInputStream#(#)#;#break#;#}##catch#(#IOException#ex#)#{#log#(#"Error opening connection "#+#ex#,#logLevel#)#;#}#}##if#(#is#==#null#)#{#log#(#"Can't get "#+#source#+#" to "#+#dest#,#logLevel#)#;##if#(#ignoreErrors#)#{##return#false#;#}##throw#new#BuildException#(#"Can't get "#+#source#+#" to "#+#dest#,#getLocation#(#)#)#;#}##os#=#new#FileOutputStream#(#dest#)#;#progress#.#beginDownload#(#)#;#boolean#finished#=#false#;##try#{#byte#[#]#buffer#=#new#byte#[#BIG_BUFFER_SIZE#]#;#int#length#;##while#(#!#isInterrupted#(#)#&&#(#length#=#is#.#read#(#buffer#)#)#>=#0#)#{#os#.#write#(#buffer#,#0#,#length#)#;#progress#.#onTick#(#)#;#}##finished#=#!#isInterrupted#(#)#;#}##finally#{#FileUtils#.#close#(#os#)#;#FileUtils#.#close#(#is#)#;##// we have started to (over)write dest, but failed.##// Try to delete the garbage we'd otherwise leave##// behind.##if#(#!#finished#)#{#dest#.#delete#(#)#;#}#}##progress#.#endDownload#(#)#;##return#true#;#}