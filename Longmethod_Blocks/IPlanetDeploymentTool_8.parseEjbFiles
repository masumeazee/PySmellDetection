Hashtable#parseEjbFiles#(#String#descriptorFileName#,#SAXParser#saxParser#)#throws#IOException#,#SAXException#{#Hashtable#files#;##/* Build and populate an instance of the ejbc utility */#IPlanetEjbc#ejbc#=#new#IPlanetEjbc#(#new#File#(#getConfig#(#)#.#descriptorDir#,#descriptorFileName#)#,#new#File#(#getConfig#(#)#.#descriptorDir#,#getIasDescriptorName#(#)#)#,#getConfig#(#)#.#srcDir#,#getCombinedClasspath#(#)#.#toString#(#)#,#saxParser#)#;#ejbc#.#setRetainSource#(#keepgenerated#)#;#ejbc#.#setDebugOutput#(#debug#)#;##if#(#iashome#!=#null#)#{#ejbc#.#setIasHomeDir#(#iashome#)#;#}##if#(#getConfig#(#)#.#dtdLocations#!=#null#)#{#for#(#Iterator#i#=#getConfig#(#)#.#dtdLocations#.#iterator#(#)#;##i#.#hasNext#(#)#;#)#{#EjbJar#.#DTDLocation#dtdLocation#=#(#EjbJar#.#DTDLocation#)#i#.#next#(#)#;#ejbc#.#registerDTD#(#dtdLocation#.#getPublicId#(#)#,#dtdLocation#.#getLocation#(#)#)#;#}#}##/* Execute the ejbc utility -- stubs/skeletons are rebuilt, if needed */#try#{#ejbc#.#execute#(#)#;#}##catch#(#IPlanetEjbc#.#EjbcException#e#)#{#throw#new#BuildException#(#"An error has occurred while trying to "#+#"execute the iAS ejbc utility"#,#e#,#getLocation#(#)#)#;#}##displayName#=#ejbc#.#getDisplayName#(#)#;#files#=#ejbc#.#getEjbFiles#(#)#;##/* Add CMP descriptors to the list of EJB files */#String#[#]#cmpDescriptors#=#ejbc#.#getCmpDescriptors#(#)#;##if#(#cmpDescriptors#.#length#>#0#)#{#File#baseDir#=#getConfig#(#)#.#descriptorDir#;#int#endOfPath#=#descriptorFileName#.#lastIndexOf#(#File#.#separator#)#;#String#relativePath#=#descriptorFileName#.#substring#(#0#,#endOfPath#+#1#)#;##for#(#int#i#=#0#;##i#<#cmpDescriptors#.#length#;#i#++#)#{#int#endOfCmp#=#cmpDescriptors#[#i#]#.#lastIndexOf#(#'/'#)#;#String#cmpDescriptor#=#cmpDescriptors#[#i#]#.#substring#(#endOfCmp#+#1#)#;#File#cmpFile#=#new#File#(#baseDir#,#relativePath#+#cmpDescriptor#)#;##if#(#!#cmpFile#.#exists#(#)#)#{#throw#new#BuildException#(#"The CMP descriptor file ("#+#cmpFile#+#") could not be found."#,#getLocation#(#)#)#;#}##files#.#put#(#cmpDescriptors#[#i#]#,#cmpFile#)#;#}#}##return#files#;#}