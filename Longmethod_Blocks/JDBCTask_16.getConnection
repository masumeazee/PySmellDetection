Connection#getConnection#(#)#throws#BuildException#{##if#(#userId#==#null#)#{#throw#new#BuildException#(#"UserId attribute must be set!"#,#getLocation#(#)#)#;#}##if#(#password#==#null#)#{#throw#new#BuildException#(#"Password attribute must be set!"#,#getLocation#(#)#)#;#}##if#(#url#==#null#)#{#throw#new#BuildException#(#"Url attribute must be set!"#,#getLocation#(#)#)#;#}##try#{#log#(#"connecting to "#+#getUrl#(#)#,#Project#.#MSG_VERBOSE#)#;#Properties#info#=#new#Properties#(#)#;#info#.#put#(#"user"#,#getUserId#(#)#)#;#info#.#put#(#"password"#,#getPassword#(#)#)#;##for#(#Iterator#props#=#connectionProperties#.#iterator#(#)#;##props#.#hasNext#(#)#;#)#{#Property#p#=#(#Property#)#props#.#next#(#)#;#String#name#=#p#.#getName#(#)#;#String#value#=#p#.#getValue#(#)#;##if#(#name#==#null#||#value#==#null#)#{#log#(#"Only name/value pairs are supported as connection"#+#" properties."#,#Project#.#MSG_WARN#)#;#}#else#{#log#(#"Setting connection property "#+#name#+#" to "#+#value#,#Project#.#MSG_VERBOSE#)#;#info#.#put#(#name#,#value#)#;#}#}##Connection#conn#=#getDriver#(#)#.#connect#(#getUrl#(#)#,#info#)#;##if#(#conn#==#null#)#{##// Driver doesn't understand the URL#throw#new#SQLException#(#"No suitable Driver for "#+#url#)#;#}##conn#.#setAutoCommit#(#autocommit#)#;##return#conn#;#}##catch#(#SQLException#e#)#{##// failed to connect##if#(#!#failOnConnectionError#)#{#log#(#"Failed to connect: "#+#e#.#getMessage#(#)#,#Project#.#MSG_WARN#)#;##return#null#;#}#else#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#}#}