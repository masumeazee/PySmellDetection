Driver#getDriver#(#)#throws#BuildException#{##if#(#driver#==#null#)#{#throw#new#BuildException#(#"Driver attribute must be set!"#,#getLocation#(#)#)#;#}##Driver#driverInstance#=#null#;##try#{#Class#dc#;##if#(#classpath#!=#null#)#{##// check first that it is not already loaded otherwise##// consecutive runs seems to end into an OutOfMemoryError##// or it fails when there is a native library to load##// several times.##// this is far from being perfect but should work##// in most cases.#synchronized#(#loaderMap#)#{##if#(#caching#)#{#loader#=#(#AntClassLoader#)#loaderMap#.#get#(#driver#)#;#}##if#(#loader#==#null#)#{#log#(#"Loading "#+#driver#+#" using AntClassLoader with classpath "#+#classpath#,#Project#.#MSG_VERBOSE#)#;#loader#=#getProject#(#)#.#createClassLoader#(#classpath#)#;##if#(#caching#)#{#loaderMap#.#put#(#driver#,#loader#)#;#}#}#else#{#log#(#"Loading "#+#driver#+#" using a cached AntClassLoader."#,#Project#.#MSG_VERBOSE#)#;#}#}##dc#=#loader#.#loadClass#(#driver#)#;#}#else#{#log#(#"Loading "#+#driver#+#" using system loader."#,#Project#.#MSG_VERBOSE#)#;#dc#=#Class#.#forName#(#driver#)#;#}##driverInstance#=#(#Driver#)#dc#.#newInstance#(#)#;#}##catch#(#ClassNotFoundException#e#)#{#throw#new#BuildException#(#"Class Not Found: JDBC driver "#+#driver#+#" could not be loaded"#,#e#,#getLocation#(#)#)#;#}##catch#(#IllegalAccessException#e#)#{#throw#new#BuildException#(#"Illegal Access: JDBC driver "#+#driver#+#" could not be loaded"#,#e#,#getLocation#(#)#)#;#}##catch#(#InstantiationException#e#)#{#throw#new#BuildException#(#"Instantiation Exception: JDBC driver "#+#driver#+#" could not be loaded"#,#e#,#getLocation#(#)#)#;#}##return#driverInstance#;#}