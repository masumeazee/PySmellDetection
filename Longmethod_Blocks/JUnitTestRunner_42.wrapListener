TestListener#wrapListener#(#final#TestListener#testListener#)#{##return#new#TestListener#(#)#{#public#void#addError#(#Test#test#,#Throwable#t#)#{##if#(#junit4#&&#t#instanceof#AssertionFailedError#)#{##// JUnit 4 does not distinguish between errors and failures##// even in the JUnit 3 adapter.##// So we need to help it a bit to retain compatibility for JUnit 3 tests.#testListener#.#addFailure#(#test#,#(#AssertionFailedError#)#t#)#;#}#else##if#(#junit4#&&#t#instanceof#AssertionError#)#{##// Not strictly necessary but probably desirable.##// JUnit 4-specific test GUIs will show just "failures".##// But Ant's output shows "failures" vs. "errors".##// We would prefer to show "failure" for things that logically are.#String#msg#=#t#.#getMessage#(#)#;#AssertionFailedError#failure#=#msg#!=#null#?#new#AssertionFailedError#(#msg#)#:#new#AssertionFailedError#(#)#;#failure#.#setStackTrace#(#t#.#getStackTrace#(#)#)#;#testListener#.#addFailure#(#test#,#failure#)#;#}#else#{#testListener#.#addError#(#test#,#t#)#;#}#}##public#void#addFailure#(#Test#test#,#AssertionFailedError#t#)#{#testListener#.#addFailure#(#test#,#t#)#;#}##public#void#addFailure#(#Test#test#,#Throwable#t#)#{##// pre-3.4##if#(#t#instanceof#AssertionFailedError#)#{#testListener#.#addFailure#(#test#,#(#AssertionFailedError#)#t#)#;#}#else#{#testListener#.#addError#(#test#,#t#)#;#}#}##public#void#endTest#(#Test#test#)#{#testListener#.#endTest#(#test#)#;#}##public#void#startTest#(#Test#test#)#{#testListener#.#startTest#(#test#)#;#}#}#;#}