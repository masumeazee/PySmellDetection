void#testPreserve#(#)#throws#Exception#{#File#simple#=#new#File#(#System#.#getProperty#(#"root"#)#,#"src/etc/testcases/util/simple.properties"#)#;#FileInputStream#fis#=#new#FileInputStream#(#simple#)#;#LayoutPreservingProperties#lpf#=#new#LayoutPreservingProperties#(#)#;#lpf#.#load#(#fis#)#;#File#tmp#=#File#.#createTempFile#(#"tmp"#,#"props"#)#;#tmp#.#deleteOnExit#(#)#;#lpf#.#saveAs#(#tmp#)#;##// now compare original and tmp for property equivalence#Properties#originalProps#=#new#Properties#(#)#;#originalProps#.#load#(#new#FileInputStream#(#simple#)#)#;#Properties#tmpProps#=#new#Properties#(#)#;#tmpProps#.#load#(#new#FileInputStream#(#tmp#)#)#;#assertEquals#(#"properties corrupted"#,#originalProps#,#tmpProps#)#;##// and now make sure that the comments made it into the new file#String#s#=#readFile#(#tmp#)#;#assertTrue#(#"missing comment"#,#s#.#indexOf#(#"# a comment"#)#>#-#1#)#;#assertTrue#(#"missing comment"#,#s#.#indexOf#(#"! more comment"#)#>#-#1#)#;#}