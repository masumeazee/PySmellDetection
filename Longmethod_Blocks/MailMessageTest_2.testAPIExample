void#testAPIExample#(#)#{#ServerThread#testMailServer#=#new#ServerThread#(#)#;#Thread#server#=#new#Thread#(#testMailServer#)#;#server#.#start#(#)#;#ClientThread#testMailClient#=#new#ClientThread#(#)#;#testMailClient#.#from#(#"Mail Message <EmailTaskTest@ant.apache.org>"#)#;#testMailClient#.#to#(#"to@you.com"#)#;#testMailClient#.#cc#(#"cc1@you.com"#)#;#testMailClient#.#cc#(#"cc2@you.com"#)#;#testMailClient#.#bcc#(#"bcc@you.com"#)#;#testMailClient#.#setSubject#(#"Test subject"#)#;#testMailClient#.#setMessage#(#"test line 1\n"#+#"test line 2"#)#;#Thread#client#=#new#Thread#(#testMailClient#)#;#client#.#start#(#)#;##try#{#server#.#join#(#60#*#1000#)#;##// 60s#client#.#join#(#30#*#1000#)#;##// a further 30s#}##catch#(#InterruptedException#ie#)#{#fail#(#"InterruptedException: "#+#ie#)#;#}##String#result#=#testMailServer#.#getResult#(#)#;#String#expectedResult#=#"220 test SMTP EmailTaskTest\r\n"#+#"HELO "#+#local#+#"\r\n"#+#"250 "#+#local#+#" Hello "#+#local#+#" [127.0.0.1], pleased to meet you\r\n"#+#"MAIL FROM: <EmailTaskTest@ant.apache.org>\r\n"#+#"250\r\n"#+#"RCPT TO: <to@you.com>\r\n"#+#"250\r\n"#+#"RCPT TO: <cc1@you.com>\r\n"#+#"250\r\n"#+#"RCPT TO: <cc2@you.com>\r\n"#+#"250\r\n"#+#"RCPT TO: <bcc@you.com>\r\n"#+#"250\r\n"#+#"DATA\r\n"#+#"354\r\n"#+#"Subject: Test subject\r\n"#+#"From: Mail Message <EmailTaskTest@ant.apache.org>\r\n"#+#"To: to@you.com\r\n"#+#"Cc: cc1@you.com, cc2@you.com\r\n"#+#"X-Mailer: org.apache.tools.mail.MailMessage (ant.apache.org)\r\n"#+#"\r\n"#+#"test line 1\r\n"#+#"test line 2\r\n"#+#"\r\n"#+#".\r\n"#+#"250\r\n"#+#"QUIT\r\n"#+#"221\r\n"#;##for#(#int#icounter#=#0#;##icounter#<#expectedResult#.#length#(#)#;#icounter#++#)#{##if#(#icounter#<#result#.#length#(#)#)#{##if#(#expectedResult#.#charAt#(#icounter#)#!=#result#.#charAt#(#icounter#)#)#{#System#.#out#.#println#(#"posit "#+#icounter#+#" expected "#+#expectedResult#.#charAt#(#icounter#)#+#" result "#+#result#.#charAt#(#icounter#)#)#;#}#}#}##if#(#expectedResult#.#length#(#)#>#result#.#length#(#)#)#{#System#.#out#.#println#(#"excedent of expected result "#+#expectedResult#.#substring#(#result#.#length#(#)#)#)#;#}##if#(#expectedResult#.#length#(#)#<#result#.#length#(#)#)#{#System#.#out#.#println#(#"excedent of result "#+#result#.#substring#(#expectedResult#.#length#(#)#)#)#;#}##assertEquals#(#expectedResult#.#length#(#)#,#result#.#length#(#)#)#;#assertEquals#(#expectedResult#,#result#)#;##// order of headers cannot be guaranteed##if#(#testMailClient#.#isFailed#(#)#)#{#fail#(#testMailClient#.#getFailMessage#(#)#)#;#}#}