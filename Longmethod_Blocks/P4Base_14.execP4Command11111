void#execP4Command#(#String#command#,#P4Handler#handler#)#throws#BuildException#{#try#{##// reset error flags before executing the command#inError#=#false#;#errorMessage#=#""#;#Commandline#commandline#=#new#Commandline#(#)#;#commandline#.#setExecutable#(#"p4"#)#;##//Check API for these - it's how CVS does it...##if#(#P4Port#!=#null#&&#P4Port#.#length#(#)#!=#0#)#{#commandline#.#createArgument#(#)#.#setValue#(#P4Port#)#;#}##if#(#P4User#!=#null#&&#P4User#.#length#(#)#!=#0#)#{#commandline#.#createArgument#(#)#.#setValue#(#P4User#)#;#}##if#(#P4Client#!=#null#&&#P4Client#.#length#(#)#!=#0#)#{#commandline#.#createArgument#(#)#.#setValue#(#P4Client#)#;#}##if#(#P4Opts#!=#null#&&#P4Opts#.#length#(#)#!=#0#)#{#commandline#.#createArgument#(#)#.#setLine#(#P4Opts#)#;#}##commandline#.#createArgument#(#)#.#setLine#(#command#)#;#log#(#commandline#.#describeCommand#(#)#,#Project#.#MSG_VERBOSE#)#;##if#(#handler#==#null#)#{#handler#=#new#SimpleP4OutputHandler#(#this#)#;#}##Execute#exe#=#new#Execute#(#handler#,#null#)#;#exe#.#setAntRun#(#getProject#(#)#)#;#exe#.#setCommandline#(#commandline#.#getCommandline#(#)#)#;##try#{#exe#.#execute#(#)#;##if#(#inError#&&#failOnError#)#{#throw#new#BuildException#(#errorMessage#)#;#}#}##catch#(#IOException#e#)#{#throw#new#BuildException#(#e#)#;#}##finally#{#try#{#handler#.#stop#(#)#;#}##catch#(#Exception#e#)#{#log#(#"Error stopping execution framework: "#+#e#.#toString#(#)#,#Project#.#MSG_ERR#)#;#}#}#}##catch#(#Exception#e#)#{#String#failMsg#=#"Problem exec'ing P4 command: "#+#e#.#getMessage#(#)#;##if#(#failOnError#)#{##if#(#e#instanceof#BuildException#)#{#throw#(#BuildException#)#e#;#}#else#{#throw#new#BuildException#(#failMsg#,#e#)#;#}#}#else#{#log#(#failMsg#,#Project#.#MSG_ERR#)#;#}#}#}