void#writeFile#(#)#throws#BuildException#{##// Write to RAM first, as an OOME could otherwise produce a truncated file:#ByteArrayOutputStream#baos#=#new#ByteArrayOutputStream#(#)#;##try#{#properties#.#store#(#baos#,#comment#)#;#}##catch#(#IOException#x#)#{##// should not happen#throw#new#BuildException#(#x#,#getLocation#(#)#)#;#}##try#{#OutputStream#os#=#new#FileOutputStream#(#propertyfile#)#;##try#{#try#{#os#.#write#(#baos#.#toByteArray#(#)#)#;#}##finally#{#os#.#close#(#)#;#}#}##catch#(#IOException#x#)#{##// possibly corrupt#FileUtils#.#getFileUtils#(#)#.#tryHardToDelete#(#propertyfile#)#;#throw#x#;#}#}##catch#(#IOException#x#)#{##// opening, writing, or closing#throw#new#BuildException#(#x#,#getLocation#(#)#)#;#}#}