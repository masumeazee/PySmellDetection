void#fetchFile#(#File#localFile#,#long#filesize#,#OutputStream#out#,#InputStream#in#)#throws#IOException#,#JSchException#{#byte#[#]#buf#=#new#byte#[#BUFFER_SIZE#]#;#sendAck#(#out#)#;##// read a content of lfile#FileOutputStream#fos#=#new#FileOutputStream#(#localFile#)#;#int#length#;#long#totalLength#=#0#;#long#startTime#=#System#.#currentTimeMillis#(#)#;##// only track progress for files larger than 100kb in verbose mode#boolean#trackProgress#=#getVerbose#(#)#&&#filesize#>#HUNDRED_KILOBYTES#;##// since filesize keeps on decreasing we have to store the##// initial filesize#long#initFilesize#=#filesize#;#int#percentTransmitted#=#0#;##try#{#while#(#true#)#{#length#=#in#.#read#(#buf#,#0#,#(#BUFFER_SIZE#<#filesize#)#?#BUFFER_SIZE#:#(#int#)#filesize#)#;##if#(#length#<#0#)#{#throw#new#EOFException#(#"Unexpected end of stream."#)#;#}##fos#.#write#(#buf#,#0#,#length#)#;#filesize#-=#length#;#totalLength#+=#length#;##if#(#filesize#==#0#)#{#break#;#}##if#(#trackProgress#)#{#percentTransmitted#=#trackProgress#(#initFilesize#,#totalLength#,#percentTransmitted#)#;#}#}#}##finally#{#long#endTime#=#System#.#currentTimeMillis#(#)#;#logStats#(#startTime#,#endTime#,#totalLength#)#;#fos#.#flush#(#)#;#fos#.#close#(#)#;#}##if#(#getPreserveLastModified#(#)#)#{#setLastModified#(#localFile#)#;#}#}