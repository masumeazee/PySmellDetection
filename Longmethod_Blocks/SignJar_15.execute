void#execute#(#)#throws#BuildException#{##//validation logic#final#boolean#hasJar#=#jar#!=#null#;#final#boolean#hasSignedJar#=#signedjar#!=#null#;#final#boolean#hasDestDir#=#destDir#!=#null#;#final#boolean#hasMapper#=#mapper#!=#null#;##if#(#!#hasJar#&&#!#hasResources#(#)#)#{#throw#new#BuildException#(#ERROR_NO_SOURCE#)#;#}##if#(#null#==#alias#)#{#throw#new#BuildException#(#ERROR_NO_ALIAS#)#;#}##if#(#null#==#storepass#)#{#throw#new#BuildException#(#ERROR_NO_STOREPASS#)#;#}##if#(#hasDestDir#&&#hasSignedJar#)#{#throw#new#BuildException#(#ERROR_TODIR_AND_SIGNEDJAR#)#;#}##if#(#hasResources#(#)#&&#hasSignedJar#)#{#throw#new#BuildException#(#ERROR_SIGNEDJAR_AND_PATHS#)#;#}##//this isnt strictly needed, but by being fussy now,##//we can change implementation details later##if#(#!#hasDestDir#&&#hasMapper#)#{#throw#new#BuildException#(#ERROR_MAPPER_WITHOUT_DEST#)#;#}##beginExecution#(#)#;##try#{##//special case single jar handling with signedjar attribute set##if#(#hasJar#&&#hasSignedJar#)#{##// single jar processing#signOneJar#(#jar#,#signedjar#)#;##//return here.##return#;#}##//the rest of the method treats single jar like##//a nested path with one file#Path#sources#=#createUnifiedSourcePath#(#)#;##//set up our mapping policy#FileNameMapper#destMapper#;##if#(#hasMapper#)#{#destMapper#=#mapper#;#}#else#{##//no mapper? use the identity policy#destMapper#=#new#IdentityMapper#(#)#;#}##//at this point the paths are set up with lists of files,##//and the mapper is ready to map from source dirs to dest files##//now we iterate through every JAR giving source and dest names##// deal with the paths#Iterator#iter#=#sources#.#iterator#(#)#;##while#(#iter#.#hasNext#(#)#)#{#Resource#r#=#(#Resource#)#iter#.#next#(#)#;#FileResource#fr#=#ResourceUtils#.#asFileResource#(#(#FileProvider#)#r#.#as#(#FileProvider#.#class#)#)#;##//calculate our destination directory; it is either the destDir##//attribute, or the base dir of the fileset (for in situ updates)#File#toDir#=#hasDestDir#?#destDir#:#fr#.#getBaseDir#(#)#;##//determine the destination filename via the mapper#String#[#]#destFilenames#=#destMapper#.#mapFileName#(#fr#.#getName#(#)#)#;##if#(#destFilenames#==#null#||#destFilenames#.#length#!=#1#)#{##//we only like simple mappers.#throw#new#BuildException#(#ERROR_BAD_MAP#+#fr#.#getFile#(#)#)#;#}##File#destFile#=#new#File#(#toDir#,#destFilenames#[#0#]#)#;#signOneJar#(#fr#.#getFile#(#)#,#destFile#)#;#}#}##finally#{#endExecution#(#)#;#}#}