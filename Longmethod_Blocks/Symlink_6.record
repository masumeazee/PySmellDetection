void#record#(#)#throws#BuildException#{#try#{##if#(#fileSets#.#isEmpty#(#)#)#{#handleError#(#"Fileset identifying links to record required"#)#;##return#;#}##if#(#linkFileName#==#null#)#{#handleError#(#"Name of file to record links in required"#)#;##return#;#}##// create a hashtable to group them by parent directory:#Hashtable#byDir#=#new#Hashtable#(#)#;##// get an Iterator of file objects representing links (canonical):#for#(#Iterator#litr#=#findLinks#(#fileSets#)#.#iterator#(#)#;##litr#.#hasNext#(#)#;#)#{#File#thisLink#=#(#File#)#litr#.#next#(#)#;#File#parent#=#thisLink#.#getParentFile#(#)#;#Vector#v#=#(#Vector#)#byDir#.#get#(#parent#)#;##if#(#v#==#null#)#{#v#=#new#Vector#(#)#;#byDir#.#put#(#parent#,#v#)#;#}##v#.#addElement#(#thisLink#)#;#}##// write a Properties file in each directory:#for#(#Iterator#dirs#=#byDir#.#keySet#(#)#.#iterator#(#)#;##dirs#.#hasNext#(#)#;#)#{#File#dir#=#(#File#)#dirs#.#next#(#)#;#Vector#linksInDir#=#(#Vector#)#byDir#.#get#(#dir#)#;#Properties#linksToStore#=#new#Properties#(#)#;##// fill up a Properties object with link and resource names:#for#(#Iterator#dlnk#=#linksInDir#.#iterator#(#)#;##dlnk#.#hasNext#(#)#;#)#{#File#lnk#=#(#File#)#dlnk#.#next#(#)#;##try#{#linksToStore#.#put#(#lnk#.#getName#(#)#,#lnk#.#getCanonicalPath#(#)#)#;#}##catch#(#IOException#ioe#)#{#handleError#(#"Couldn't get canonical name of parent link"#)#;#}#}##writePropertyFile#(#linksToStore#,#dir#)#;#}#}##finally#{#setDefaults#(#)#;#}#}