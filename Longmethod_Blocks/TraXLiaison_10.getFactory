TransformerFactory#getFactory#(#)#throws#BuildException#{##if#(#tfactory#!=#null#)#{##return#tfactory#;#}##// not initialized yet, so create the factory##if#(#factoryName#==#null#)#{#tfactory#=#TransformerFactory#.#newInstance#(#)#;#}#else#{#try#{#Class#clazz#=#null#;##try#{#clazz#=#Class#.#forName#(#factoryName#,#true#,#Thread#.#currentThread#(#)#.#getContextClassLoader#(#)#)#;#}##catch#(#ClassNotFoundException#cnfe#)#{#String#msg#=#"Failed to load "#+#factoryName#+#" via the configured classpath, will try"#+#" Ant's classpath instead."#;##if#(#logger#!=#null#)#{#logger#.#log#(#msg#)#;#}#else##if#(#project#!=#null#)#{#project#.#log#(#msg#,#Project#.#MSG_WARN#)#;#}#else#{#System#.#err#.#println#(#msg#)#;#}#}##if#(#clazz#==#null#)#{#clazz#=#Class#.#forName#(#factoryName#)#;#}##tfactory#=#(#TransformerFactory#)#clazz#.#newInstance#(#)#;#}##catch#(#Exception#e#)#{#throw#new#BuildException#(#e#)#;#}#}##tfactory#.#setErrorListener#(#this#)#;##// specific attributes for the transformer#for#(#int#i#=#0#;##i#<#attributes#.#size#(#)#;#i#++#)#{#final#Object#[#]#pair#=#(#Object#[#]#)#attributes#.#elementAt#(#i#)#;#tfactory#.#setAttribute#(#(#String#)#pair#[#0#]#,#pair#[#1#]#)#;#}##if#(#uriResolver#!=#null#)#{#tfactory#.#setURIResolver#(#uriResolver#)#;#}##return#tfactory#;#}