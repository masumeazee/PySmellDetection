XMLReader#createXmlReader#(#)#{#Object#reader#=#null#;##if#(#readerClassName#==#null#)#{#reader#=#createDefaultReaderOrParser#(#)#;#}#else#{#Class#readerClass#=#null#;##try#{##// load the parser class##if#(#classpath#!=#null#)#{#readerLoader#=#getProject#(#)#.#createClassLoader#(#classpath#)#;#readerClass#=#Class#.#forName#(#readerClassName#,#true#,#readerLoader#)#;#}#else#{#readerClass#=#Class#.#forName#(#readerClassName#)#;#}##reader#=#readerClass#.#newInstance#(#)#;#}##catch#(#ClassNotFoundException#e#)#{#throw#new#BuildException#(#INIT_FAILED_MSG#+#readerClassName#,#e#)#;#}##catch#(#InstantiationException#e#)#{#throw#new#BuildException#(#INIT_FAILED_MSG#+#readerClassName#,#e#)#;#}##catch#(#IllegalAccessException#e#)#{#throw#new#BuildException#(#INIT_FAILED_MSG#+#readerClassName#,#e#)#;#}#}##// then check it implements XMLReader#XMLReader#newReader#;##if#(#reader#instanceof#XMLReader#)#{#newReader#=#(#XMLReader#)#reader#;#log#(#"Using SAX2 reader "#+#reader#.#getClass#(#)#.#getName#(#)#,#Project#.#MSG_VERBOSE#)#;#}#else#{##// see if it is a SAX1 Parser##if#(#reader#instanceof#Parser#)#{#newReader#=#new#ParserAdapter#(#(#Parser#)#reader#)#;#log#(#"Using SAX1 parser "#+#reader#.#getClass#(#)#.#getName#(#)#,#Project#.#MSG_VERBOSE#)#;#}#else#{#throw#new#BuildException#(#INIT_FAILED_MSG#+#reader#.#getClass#(#)#.#getName#(#)#+#" implements nor SAX1 Parser nor SAX2 XMLReader."#)#;#}#}##return#newReader#;#}