void#link#(#)#throws#Exception#{#ZipOutputStream#output#=#new#ZipOutputStream#(#new#FileOutputStream#(#outfile#)#)#;##if#(#compression#)#{#output#.#setMethod#(#ZipOutputStream#.#DEFLATED#)#;#output#.#setLevel#(#Deflater#.#DEFAULT_COMPRESSION#)#;#}#else#{#output#.#setMethod#(#ZipOutputStream#.#STORED#)#;#}##Enumeration#merges#=#mergefiles#.#elements#(#)#;##while#(#merges#.#hasMoreElements#(#)#)#{#String#path#=#(#String#)#merges#.#nextElement#(#)#;#File#f#=#new#File#(#path#)#;##if#(#f#.#getName#(#)#.#endsWith#(#".jar"#)#||#f#.#getName#(#)#.#endsWith#(#".zip"#)#)#{##//Do the merge#mergeZipJarContents#(#output#,#f#)#;#}#else#{##//Add this file to the addfiles Vector and add it##//later at the top level of the output file.#addAddFile#(#path#)#;#}#}##Enumeration#adds#=#addfiles#.#elements#(#)#;##while#(#adds#.#hasMoreElements#(#)#)#{#String#name#=#(#String#)#adds#.#nextElement#(#)#;#File#f#=#new#File#(#name#)#;##if#(#f#.#isDirectory#(#)#)#{##//System.out.println("in jlink: adding directory contents of " + f.getPath());#addDirContents#(#output#,#f#,#f#.#getName#(#)#+#'/'#,#compression#)#;#}#else#{#addFile#(#output#,#f#,#""#,#compression#)#;#}#}##FileUtils#.#close#(#output#)#;#}