Object#evaluate#(#String#property#,#PropertyHelper#propertyHelper#)#{#Object#o#=#null#;#if#(#property#.#startsWith#(#PREFIX#)#&&#propertyHelper#.#getProject#(#)#!=#null#)#{#o#=#propertyHelper#.#getProject#(#)#.#getReference#(#property#.#substring#(#PREFIX_LEN#)#)#;#}#return#o#==#null#?#null#:#o#.#toString#(#)#;#}##String#parsePropertyName#(#String#s#,#ParsePosition#pos#,#ParseNextProperty#notUsed#)#{#int#index#=#pos#.#getIndex#(#)#;#if#(#s#.#indexOf#(#"${"#,#index#)#==#index#)#{#int#end#=#s#.#indexOf#(#'}'#,#index#)#;#if#(#end#<#0#)#{#throw#new#BuildException#(#"Syntax error in property: "#+#s#)#;#}#int#start#=#index#+#2#;#pos#.#setIndex#(#end#+#1#)#;#return#s#.#substring#(#start#,#end#)#;#}#return#null#;#}##String#parsePropertyName#(#String#s#,#ParsePosition#pos#,#ParseNextProperty#notUsed#)#{#int#index#=#pos#.#getIndex#(#)#;#if#(#s#.#indexOf#(#"$$"#,#index#)#==#index#)#{#pos#.#setIndex#(#++#index#)#;#}#return#null#;#}##Object#evaluate#(#String#prop#,#PropertyHelper#helper#)#{#return#prop#.#startsWith#(#PREFIX#)#&&#helper#.#getProject#(#)#!=#null#?#helper#.#getProject#(#)#.#getReference#(#prop#.#substring#(#PREFIX_LEN#)#)#:#null#;#}##Object#getProperty#(#Project#project#,#String#name#)#{#return#PropertyHelper#.#getPropertyHelper#(#project#)#.#getProperty#(#name#)#;#}##void#setProperty#(#Project#project#,#String#name#,#Object#value#)#{#PropertyHelper#.#getPropertyHelper#(#project#)#.#setProperty#(#name#,#value#,#true#)#;#}##void#setNewProperty#(#Project#project#,#String#name#,#Object#value#)#{#PropertyHelper#.#getPropertyHelper#(#project#)#.#setNewProperty#(#name#,#value#)#;#}##void#setProject#(#Project#p#)#{#this#.#project#=#p#;#}##Project#getProject#(#)#{#return#project#;#}##void#setNext#(#PropertyHelper#next#)#{#this#.#next#=#next#;#}##PropertyHelper#getNext#(#)#{#return#next#;#}##PropertyHelper#getPropertyHelper#(#Project#project#)#{#PropertyHelper#helper#=#null#;#if#(#project#!=#null#)#{#helper#=#(#PropertyHelper#)#project#.#getReference#(#MagicNames#.#REFID_PROPERTY_HELPER#)#;#}#if#(#helper#!=#null#)#{#return#helper#;#}#helper#=#new#PropertyHelper#(#)#;#helper#.#setProject#(#project#)#;#if#(#project#!=#null#)#{#project#.#addReference#(#MagicNames#.#REFID_PROPERTY_HELPER#,#helper#)#;#}#return#helper#;#}##Collection#getExpanders#(#)#{#return#getDelegates#(#PropertyExpander#.#class#)#;#}##boolean#setPropertyHook#(#String#ns#,#String#name#,#Object#value#,#boolean#inherited#,#boolean#user#,#boolean#isNew#)#{#if#(#getNext#(#)#!=#null#)#{#boolean#subst#=#getNext#(#)#.#setPropertyHook#(#ns#,#name#,#value#,#inherited#,#user#,#isNew#)#;#// If next has handled the property#if#(#subst#)#{#return#true#;#}#}#return#false#;#}##Object#getPropertyHook#(#String#ns#,#String#name#,#boolean#user#)#{#if#(#getNext#(#)#!=#null#)#{#Object#o#=#getNext#(#)#.#getPropertyHook#(#ns#,#name#,#user#)#;#if#(#o#!=#null#)#{#return#o#;#}#}#// Experimental/Testing, will be removed#if#(#project#!=#null#&&#name#.#startsWith#(#"toString:"#)#)#{#name#=#name#.#substring#(#"toString:"#.#length#(#)#)#;#Object#v#=#project#.#getReference#(#name#)#;#return#(#v#==#null#)#?#null#:#v#.#toString#(#)#;#}#return#null#;#}##void#parsePropertyString#(#String#value#,#Vector#fragments#,#Vector#propertyRefs#)#throws#BuildException#{#parsePropertyStringDefault#(#value#,#fragments#,#propertyRefs#)#;#}##String#replaceProperties#(#String#ns#,#String#value#,#Hashtable#keys#)#throws#BuildException#{#return#replaceProperties#(#value#)#;#}##String#replaceProperties#(#String#value#)#throws#BuildException#{#Object#o#=#parseProperties#(#value#)#;#return#o#==#null#||#o#instanceof#String#?#(#String#)#o#:#o#.#toString#(#)#;#}##Object#parseProperties#(#String#value#)#throws#BuildException#{#return#new#ParseProperties#(#getProject#(#)#,#getExpanders#(#)#,#this#)#.#parseProperties#(#value#)#;#}##boolean#containsProperties#(#String#value#)#{#return#new#ParseProperties#(#getProject#(#)#,#getExpanders#(#)#,#this#)#.#containsProperties#(#value#)#;#}##boolean#setProperty#(#String#ns#,#String#name#,#Object#value#,#boolean#verbose#)#{#return#setProperty#(#name#,#value#,#verbose#)#;#}##boolean#setProperty#(#String#name#,#Object#value#,#boolean#verbose#)#{#for#(#Iterator#iter#=#getDelegates#(#PropertySetter#.#class#)#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#PropertySetter#setter#=#(#PropertySetter#)#iter#.#next#(#)#;#if#(#setter#.#set#(#name#,#value#,#this#)#)#{#return#true#;#}#}#synchronized#(#this#)#{#// user (CLI) properties take precedence#if#(#userProperties#.#containsKey#(#name#)#)#{#if#(#project#!=#null#&&#verbose#)#{#project#.#log#(#"Override ignored for user property \""#+#name#+#"\""#,#Project#.#MSG_VERBOSE#)#;#}#return#false#;#}#if#(#project#!=#null#&&#verbose#)#{#if#(#properties#.#containsKey#(#name#)#)#{#project#.#log#(#"Overriding previous definition of property \""#+#name#+#"\""#,#Project#.#MSG_VERBOSE#)#;#}#project#.#log#(#"Setting project property: "#+#name#+#" -> "#+#value#,#Project#.#MSG_DEBUG#)#;#}#if#(#name#!=#null#&&#value#!=#null#)#{#properties#.#put#(#name#,#value#)#;#}#return#true#;#}#}##void#setNewProperty#(#String#ns#,#String#name#,#Object#value#)#{#setNewProperty#(#name#,#value#)#;#}##void#setNewProperty#(#String#name#,#Object#value#)#{#for#(#Iterator#iter#=#getDelegates#(#PropertySetter#.#class#)#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#PropertySetter#setter#=#(#PropertySetter#)#iter#.#next#(#)#;#if#(#setter#.#setNew#(#name#,#value#,#this#)#)#{#return#;#}#}#synchronized#(#this#)#{#if#(#project#!=#null#&&#properties#.#containsKey#(#name#)#)#{#project#.#log#(#"Override ignored for property \""#+#name#+#"\""#,#Project#.#MSG_VERBOSE#)#;#return#;#}#if#(#project#!=#null#)#{#project#.#log#(#"Setting project property: "#+#name#+#" -> "#+#value#,#Project#.#MSG_DEBUG#)#;#}#if#(#name#!=#null#&&#value#!=#null#)#{#properties#.#put#(#name#,#value#)#;#}#}#}##void#setUserProperty#(#String#ns#,#String#name#,#Object#value#)#{#setUserProperty#(#name#,#value#)#;#}##void#setUserProperty#(#String#name#,#Object#value#)#{#if#(#project#!=#null#)#{#project#.#log#(#"Setting ro project property: "#+#name#+#" -> "#+#value#,#Project#.#MSG_DEBUG#)#;#}#synchronized#(#this#)#{#userProperties#.#put#(#name#,#value#)#;#properties#.#put#(#name#,#value#)#;#}#}##void#setInheritedProperty#(#String#ns#,#String#name#,#Object#value#)#{#setInheritedProperty#(#name#,#value#)#;#}##void#setInheritedProperty#(#String#name#,#Object#value#)#{#if#(#project#!=#null#)#{#project#.#log#(#"Setting ro project property: "#+#name#+#" -> "#+#value#,#Project#.#MSG_DEBUG#)#;#}#synchronized#(#this#)#{#inheritedProperties#.#put#(#name#,#value#)#;#userProperties#.#put#(#name#,#value#)#;#properties#.#put#(#name#,#value#)#;#}#}##Object#getProperty#(#String#ns#,#String#name#)#{#return#getProperty#(#name#)#;#}##Object#getProperty#(#String#name#)#{#if#(#name#==#null#)#{#return#null#;#}#for#(#Iterator#iter#=#getDelegates#(#PropertyEvaluator#.#class#)#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#Object#o#=#(#(#PropertyEvaluator#)#iter#.#next#(#)#)#.#evaluate#(#name#,#this#)#;#if#(#o#!=#null#)#{#if#(#o#instanceof#NullReturn#)#{#return#null#;#}#return#o#;#}#}#return#properties#.#get#(#name#)#;#}##Object#getUserProperty#(#String#ns#,#String#name#)#{#return#getUserProperty#(#name#)#;#}##Object#getUserProperty#(#String#name#)#{#if#(#name#==#null#)#{#return#null#;#}#return#userProperties#.#get#(#name#)#;#}##Hashtable#getProperties#(#)#{#//avoid concurrent modification:#synchronized#(#properties#)#{#return#new#Hashtable#(#properties#)#;#}#// There is a better way to save the context. This shouldn't#// delegate to next, it's for backward compatibility only.#}##Hashtable#getUserProperties#(#)#{#//avoid concurrent modification:#synchronized#(#userProperties#)#{#return#new#Hashtable#(#userProperties#)#;#}#}##Hashtable#getInheritedProperties#(#)#{#//avoid concurrent modification:#synchronized#(#inheritedProperties#)#{#return#new#Hashtable#(#inheritedProperties#)#;#}#}##Hashtable#getInternalProperties#(#)#{#return#properties#;#}##Hashtable#getInternalUserProperties#(#)#{#return#userProperties#;#}##Hashtable#getInternalInheritedProperties#(#)#{#return#inheritedProperties#;#}##void#copyInheritedProperties#(#Project#other#)#{#//avoid concurrent modification:#synchronized#(#inheritedProperties#)#{#Enumeration#e#=#inheritedProperties#.#keys#(#)#;#while#(#e#.#hasMoreElements#(#)#)#{#String#arg#=#e#.#nextElement#(#)#.#toString#(#)#;#if#(#other#.#getUserProperty#(#arg#)#!=#null#)#{#continue#;#}#Object#value#=#inheritedProperties#.#get#(#arg#)#;#other#.#setInheritedProperty#(#arg#,#value#.#toString#(#)#)#;#}#}#}##void#copyUserProperties#(#Project#other#)#{#//avoid concurrent modification:#synchronized#(#userProperties#)#{#Enumeration#e#=#userProperties#.#keys#(#)#;#while#(#e#.#hasMoreElements#(#)#)#{#Object#arg#=#e#.#nextElement#(#)#;#if#(#inheritedProperties#.#containsKey#(#arg#)#)#{#continue#;#}#Object#value#=#userProperties#.#get#(#arg#)#;#other#.#setUserProperty#(#arg#.#toString#(#)#,#value#.#toString#(#)#)#;#}#}#}##void#parsePropertyStringDefault#(#String#value#,#Vector#fragments#,#Vector#propertyRefs#)#throws#BuildException#{#int#prev#=#0#;#int#pos#;#//search for the next instance of $ from the 'prev' position#while#(#(#pos#=#value#.#indexOf#(#"$"#,#prev#)#)#>=#0#)#{#//if there was any text before this, add it as a fragment#//TODO, this check could be modified to go if pos>prev;#//seems like this current version could stick empty strings#//into the list#if#(#pos#>#0#)#{#fragments#.#addElement#(#value#.#substring#(#prev#,#pos#)#)#;#}#//if we are at the end of the string, we tack on a $#//then move past it#if#(#pos#==#(#value#.#length#(#)#-#1#)#)#{#fragments#.#addElement#(#"$"#)#;#prev#=#pos#+#1#;#}#else#if#(#value#.#charAt#(#pos#+#1#)#!=#'{'#)#{#//peek ahead to see if the next char is a property or not#//not a property: insert the char as a literal#/*
                fragments.addElement(value.substring(pos + 1, pos + 2));
                prev = pos + 2;
                */#if#(#value#.#charAt#(#pos#+#1#)#==#'$'#)#{#//backwards compatibility two $ map to one mode#fragments#.#addElement#(#"$"#)#;#prev#=#pos#+#2#;#}#else#{#//new behaviour: $X maps to $X for all values of X!='$'#fragments#.#addElement#(#value#.#substring#(#pos#,#pos#+#2#)#)#;#prev#=#pos#+#2#;#}#}#else#{#//property found, extract its name or bail on a typo#int#endName#=#value#.#indexOf#(#'}'#,#pos#)#;#if#(#endName#<#0#)#{#throw#new#BuildException#(#"Syntax error in property: "#+#value#)#;#}#String#propertyName#=#value#.#substring#(#pos#+#2#,#endName#)#;#fragments#.#addElement#(#null#)#;#propertyRefs#.#addElement#(#propertyName#)#;#prev#=#endName#+#1#;#}#}#//no more $ signs found#//if there is any tail to the file, append it#if#(#prev#<#value#.#length#(#)#)#{#fragments#.#addElement#(#value#.#substring#(#prev#)#)#;#}#}##void#add#(#Delegate#delegate#)#{#synchronized#(#delegates#)#{#for#(#Iterator#iter#=#getDelegateInterfaces#(#delegate#)#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#Object#key#=#iter#.#next#(#)#;#List#list#=#(#List#)#delegates#.#get#(#key#)#;#if#(#list#==#null#)#{#list#=#new#ArrayList#(#)#;#}#else#{#list#=#new#ArrayList#(#list#)#;#list#.#remove#(#delegate#)#;#}#list#.#add#(#0#,#delegate#)#;#delegates#.#put#(#key#,#Collections#.#unmodifiableList#(#list#)#)#;#}#}#}##List#getDelegates#(#Class#type#)#{#List#r#=#(#List#)#delegates#.#get#(#type#)#;#return#r#==#null#?#Collections#.#EMPTY_LIST#:#r#;#}##Set#getDelegateInterfaces#(#Delegate#d#)#{#HashSet#result#=#new#HashSet#(#)#;#Class#c#=#d#.#getClass#(#)#;#while#(#c#!=#null#)#{#Class#[#]#ifs#=#c#.#getInterfaces#(#)#;#for#(#int#i#=#0#;#i#<#ifs#.#length#;#i#++#)#{#if#(#Delegate#.#class#.#isAssignableFrom#(#ifs#[#i#]#)#)#{#result#.#add#(#ifs#[#i#]#)#;#}#}#c#=#c#.#getSuperclass#(#)#;#}#result#.#remove#(#Delegate#.#class#)#;#return#result#;#}##Boolean#toBoolean#(#Object#value#)#{#if#(#value#instanceof#Boolean#)#{#return#(#Boolean#)#value#;#}#if#(#value#instanceof#String#)#{#String#s#=#(#String#)#value#;#if#(#Project#.#toBoolean#(#s#)#)#{#return#Boolean#.#TRUE#;#}#if#(#"off"#.#equalsIgnoreCase#(#s#)#||#"false"#.#equalsIgnoreCase#(#s#)#||#"no"#.#equalsIgnoreCase#(#s#)#)#{#return#Boolean#.#FALSE#;#}#}#return#null#;#}##boolean#nullOrEmpty#(#Object#value#)#{#return#value#==#null#||#""#.#equals#(#value#)#;#}##boolean#evalAsBooleanOrPropertyName#(#Object#value#)#{#Boolean#b#=#toBoolean#(#value#)#;#if#(#b#!=#null#)#{#return#b#.#booleanValue#(#)#;#}#return#getProperty#(#String#.#valueOf#(#value#)#)#!=#null#;#}##boolean#testIfCondition#(#Object#value#)#{#return#nullOrEmpty#(#value#)#||#evalAsBooleanOrPropertyName#(#value#)#;#}##boolean#testUnlessCondition#(#Object#value#)#{#return#nullOrEmpty#(#value#)#||#!#evalAsBooleanOrPropertyName#(#value#)#;#}##