int#getNextChar#(#)#throws#IOException#{#if#(#queueIndex#!=#-#1#)#{#final#int#ch#=#queuedData#.#charAt#(#queueIndex#++#)#;#if#(#queueIndex#>=#queuedData#.#length#(#)#)#{#queueIndex#=#-#1#;#}#return#ch#;#}#return#in#.#read#(#)#;#}##int#read#(#)#throws#IOException#{#if#(#!#getInitialized#(#)#)#{#initialize#(#)#;#setInitialized#(#true#)#;#}#if#(#replaceIndex#!=#-#1#)#{#final#int#ch#=#replaceData#.#charAt#(#replaceIndex#++#)#;#if#(#replaceIndex#>=#replaceData#.#length#(#)#)#{#replaceIndex#=#-#1#;#}#return#ch#;#}#int#ch#=#getNextChar#(#)#;#if#(#ch#==#beginToken#)#{#final#StringBuffer#key#=#new#StringBuffer#(#""#)#;#do#{#ch#=#getNextChar#(#)#;#if#(#ch#!=#-#1#)#{#key#.#append#(#(#char#)#ch#)#;#}#else#{#break#;#}#}#while#(#ch#!=#endToken#)#;#if#(#ch#==#-#1#)#{#if#(#queuedData#==#null#||#queueIndex#==#-#1#)#{#queuedData#=#key#.#toString#(#)#;#}#else#{#queuedData#=#key#.#toString#(#)#+#queuedData#.#substring#(#queueIndex#)#;#}#if#(#queuedData#.#length#(#)#>#0#)#{#queueIndex#=#0#;#}#else#{#queueIndex#=#-#1#;#}#return#beginToken#;#}#else#{#key#.#setLength#(#key#.#length#(#)#-#1#)#;#final#String#replaceWith#=#(#String#)#hash#.#get#(#key#.#toString#(#)#)#;#if#(#replaceWith#!=#null#)#{#if#(#replaceWith#.#length#(#)#>#0#)#{#replaceData#=#replaceWith#;#replaceIndex#=#0#;#}#return#read#(#)#;#}#else#{#String#newData#=#key#.#toString#(#)#+#endToken#;#if#(#queuedData#==#null#||#queueIndex#==#-#1#)#{#queuedData#=#newData#;#}#else#{#queuedData#=#newData#+#queuedData#.#substring#(#queueIndex#)#;#}#queueIndex#=#0#;#return#beginToken#;#}#}#}#return#ch#;#}##void#setBeginToken#(#final#char#beginToken#)#{#this#.#beginToken#=#beginToken#;#}##char#getBeginToken#(#)#{#return#beginToken#;#}##void#setEndToken#(#final#char#endToken#)#{#this#.#endToken#=#endToken#;#}##char#getEndToken#(#)#{#return#endToken#;#}##void#setPropertiesResource#(#Resource#r#)#{#makeTokensFromProperties#(#r#)#;#}##void#addConfiguredToken#(#final#Token#token#)#{#hash#.#put#(#token#.#getKey#(#)#,#token#.#getValue#(#)#)#;#}##Properties#getProperties#(#Resource#r#)#{#InputStream#in#=#null#;#Properties#props#=#new#Properties#(#)#;#try#{#in#=#r#.#getInputStream#(#)#;#props#.#load#(#in#)#;#}#catch#(#IOException#ioe#)#{#ioe#.#printStackTrace#(#)#;#}#finally#{#FileUtils#.#close#(#in#)#;#}#return#props#;#}##void#setTokens#(#final#Hashtable#hash#)#{#this#.#hash#=#hash#;#}##Hashtable#getTokens#(#)#{#return#hash#;#}##Reader#chain#(#final#Reader#rdr#)#{#ReplaceTokens#newFilter#=#new#ReplaceTokens#(#rdr#)#;#newFilter#.#setBeginToken#(#getBeginToken#(#)#)#;#newFilter#.#setEndToken#(#getEndToken#(#)#)#;#newFilter#.#setTokens#(#getTokens#(#)#)#;#newFilter#.#setInitialized#(#true#)#;#return#newFilter#;#}##void#initialize#(#)#{#Parameter#[#]#params#=#getParameters#(#)#;#if#(#params#!=#null#)#{#for#(#int#i#=#0#;#i#<#params#.#length#;#i#++#)#{#if#(#params#[#i#]#!=#null#)#{#final#String#type#=#params#[#i#]#.#getType#(#)#;#if#(#"tokenchar"#.#equals#(#type#)#)#{#final#String#name#=#params#[#i#]#.#getName#(#)#;#String#value#=#params#[#i#]#.#getValue#(#)#;#if#(#"begintoken"#.#equals#(#name#)#)#{#if#(#value#.#length#(#)#==#0#)#{#throw#new#BuildException#(#"Begin token cannot "#+#"be empty"#)#;#}#beginToken#=#params#[#i#]#.#getValue#(#)#.#charAt#(#0#)#;#}#else#if#(#"endtoken"#.#equals#(#name#)#)#{#if#(#value#.#length#(#)#==#0#)#{#throw#new#BuildException#(#"End token cannot "#+#"be empty"#)#;#}#endToken#=#params#[#i#]#.#getValue#(#)#.#charAt#(#0#)#;#}#}#else#if#(#"token"#.#equals#(#type#)#)#{#final#String#name#=#params#[#i#]#.#getName#(#)#;#final#String#value#=#params#[#i#]#.#getValue#(#)#;#hash#.#put#(#name#,#value#)#;#}#else#if#(#"propertiesfile"#.#equals#(#type#)#)#{#makeTokensFromProperties#(#new#FileResource#(#new#File#(#params#[#i#]#.#getValue#(#)#)#)#)#;#}#}#}#}#}##void#makeTokensFromProperties#(#Resource#r#)#{#Properties#props#=#getProperties#(#r#)#;#for#(#Enumeration#e#=#props#.#keys#(#)#;#e#.#hasMoreElements#(#)#;#)#{#String#key#=#(#String#)#e#.#nextElement#(#)#;#String#value#=#props#.#getProperty#(#key#)#;#hash#.#put#(#key#,#value#)#;#}#}##void#setKey#(#String#key#)#{#this#.#key#=#key#;#}##void#setValue#(#String#value#)#{#this#.#value#=#value#;#}##String#getKey#(#)#{#return#key#;#}##String#getValue#(#)#{#return#value#;#}##