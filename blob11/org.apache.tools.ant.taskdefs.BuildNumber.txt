void#setFile#(#final#File#file#)#{#myFile#=#file#;#}##void#execute#(#)#throws#BuildException#{#File#savedFile#=#myFile#;#// may be altered in validate#validate#(#)#;#final#Properties#properties#=#loadProperties#(#)#;#final#int#buildNumber#=#getBuildNumber#(#properties#)#;#properties#.#put#(#DEFAULT_PROPERTY_NAME#,#String#.#valueOf#(#buildNumber#+#1#)#)#;#// Write the properties file back out#FileOutputStream#output#=#null#;#try#{#output#=#new#FileOutputStream#(#myFile#)#;#final#String#header#=#"Build Number for ANT. Do not edit!"#;#properties#.#store#(#output#,#header#)#;#}#catch#(#final#IOException#ioe#)#{#final#String#message#=#"Error while writing "#+#myFile#;#throw#new#BuildException#(#message#,#ioe#)#;#}#finally#{#if#(#null#!=#output#)#{#try#{#output#.#close#(#)#;#}#catch#(#final#IOException#ioe#)#{#log#(#"error closing output stream "#+#ioe#,#Project#.#MSG_ERR#)#;#}#}#myFile#=#savedFile#;#}#//Finally set the property#getProject#(#)#.#setNewProperty#(#DEFAULT_PROPERTY_NAME#,#String#.#valueOf#(#buildNumber#)#)#;#}##int#getBuildNumber#(#final#Properties#properties#)#throws#BuildException#{#final#String#buildNumber#=#properties#.#getProperty#(#DEFAULT_PROPERTY_NAME#,#"0"#)#.#trim#(#)#;#// Try parsing the line into an integer.#try#{#return#Integer#.#parseInt#(#buildNumber#)#;#}#catch#(#final#NumberFormatException#nfe#)#{#final#String#message#=#myFile#+#" contains a non integer build number: "#+#buildNumber#;#throw#new#BuildException#(#message#,#nfe#)#;#}#}##Properties#loadProperties#(#)#throws#BuildException#{#FileInputStream#input#=#null#;#try#{#final#Properties#properties#=#new#Properties#(#)#;#input#=#new#FileInputStream#(#myFile#)#;#properties#.#load#(#input#)#;#return#properties#;#}#catch#(#final#IOException#ioe#)#{#throw#new#BuildException#(#ioe#)#;#}#finally#{#if#(#null#!=#input#)#{#try#{#input#.#close#(#)#;#}#catch#(#final#IOException#ioe#)#{#log#(#"error closing input stream "#+#ioe#,#Project#.#MSG_ERR#)#;#}#}#}#}##void#validate#(#)#throws#BuildException#{#if#(#null#==#myFile#)#{#myFile#=#FILE_UTILS#.#resolveFile#(#getProject#(#)#.#getBaseDir#(#)#,#DEFAULT_FILENAME#)#;#}#if#(#!#myFile#.#exists#(#)#)#{#try#{#FILE_UTILS#.#createNewFile#(#myFile#)#;#}#catch#(#final#IOException#ioe#)#{#final#String#message#=#myFile#+#" doesn't exist and new file can't be created."#;#throw#new#BuildException#(#message#,#ioe#)#;#}#}#if#(#!#myFile#.#canRead#(#)#)#{#final#String#message#=#"Unable to read from "#+#myFile#+#"."#;#throw#new#BuildException#(#message#)#;#}#if#(#!#myFile#.#canWrite#(#)#)#{#final#String#message#=#"Unable to write to "#+#myFile#+#"."#;#throw#new#BuildException#(#message#)#;#}#}##