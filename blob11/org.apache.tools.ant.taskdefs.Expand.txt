void#setFailOnEmptyArchive#(#boolean#b#)#{#failOnEmptyArchive#=#b#;#}##boolean#getFailOnEmptyArchive#(#)#{#return#failOnEmptyArchive#;#}##void#execute#(#)#throws#BuildException#{#if#(#"expand"#.#equals#(#getTaskType#(#)#)#)#{#log#(#"!! expand is deprecated. Use unzip instead. !!"#)#;#}#if#(#source#==#null#&&#!#resourcesSpecified#)#{#throw#new#BuildException#(#"src attribute and/or resources must be "#+#"specified"#)#;#}#if#(#dest#==#null#)#{#throw#new#BuildException#(#"Dest attribute must be specified"#)#;#}#if#(#dest#.#exists#(#)#&&#!#dest#.#isDirectory#(#)#)#{#throw#new#BuildException#(#"Dest must be a directory."#,#getLocation#(#)#)#;#}#if#(#source#!=#null#)#{#if#(#source#.#isDirectory#(#)#)#{#throw#new#BuildException#(#"Src must not be a directory."#+#" Use nested filesets instead."#,#getLocation#(#)#)#;#}#else#if#(#!#source#.#exists#(#)#)#{#throw#new#BuildException#(#"src '"#+#source#+#"' doesn't exist."#)#;#}#else#if#(#!#source#.#canRead#(#)#)#{#throw#new#BuildException#(#"src '"#+#source#+#"' cannot be read."#)#;#}#else#{#expandFile#(#FILE_UTILS#,#source#,#dest#)#;#}#}#Iterator#iter#=#resources#.#iterator#(#)#;#while#(#iter#.#hasNext#(#)#)#{#Resource#r#=#(#Resource#)#iter#.#next#(#)#;#if#(#!#r#.#isExists#(#)#)#{#log#(#"Skipping '"#+#r#.#getName#(#)#+#"' because it doesn't exist."#)#;#continue#;#}#FileProvider#fp#=#(#FileProvider#)#r#.#as#(#FileProvider#.#class#)#;#if#(#fp#!=#null#)#{#expandFile#(#FILE_UTILS#,#fp#.#getFile#(#)#,#dest#)#;#}#else#{#expandResource#(#r#,#dest#)#;#}#}#}##void#expandFile#(#FileUtils#fileUtils#,#File#srcF#,#File#dir#)#{#log#(#"Expanding: "#+#srcF#+#" into "#+#dir#,#Project#.#MSG_INFO#)#;#ZipFile#zf#=#null#;#FileNameMapper#mapper#=#getMapper#(#)#;#if#(#!#srcF#.#exists#(#)#)#{#throw#new#BuildException#(#"Unable to expand "#+#srcF#+#" as the file does not exist"#,#getLocation#(#)#)#;#}#try#{#zf#=#new#ZipFile#(#srcF#,#encoding#,#scanForUnicodeExtraFields#)#;#boolean#empty#=#true#;#Enumeration#e#=#zf#.#getEntries#(#)#;#while#(#e#.#hasMoreElements#(#)#)#{#empty#=#false#;#ZipEntry#ze#=#(#ZipEntry#)#e#.#nextElement#(#)#;#InputStream#is#=#null#;#log#(#"extracting "#+#ze#.#getName#(#)#,#Project#.#MSG_DEBUG#)#;#try#{#extractFile#(#fileUtils#,#srcF#,#dir#,#is#=#zf#.#getInputStream#(#ze#)#,#ze#.#getName#(#)#,#new#Date#(#ze#.#getTime#(#)#)#,#ze#.#isDirectory#(#)#,#mapper#)#;#}#finally#{#FileUtils#.#close#(#is#)#;#}#}#if#(#empty#&&#getFailOnEmptyArchive#(#)#)#{#throw#new#BuildException#(#"archive '"#+#srcF#+#"' is empty"#)#;#}#log#(#"expand complete"#,#Project#.#MSG_VERBOSE#)#;#}#catch#(#IOException#ioe#)#{#throw#new#BuildException#(#"Error while expanding "#+#srcF#.#getPath#(#)#+#"\n"#+#ioe#.#toString#(#)#,#ioe#)#;#}#finally#{#ZipFile#.#closeQuietly#(#zf#)#;#}#}##void#expandResource#(#Resource#srcR#,#File#dir#)#{#throw#new#BuildException#(#"only filesystem based resources are"#+#" supported by this task."#)#;#}##FileNameMapper#getMapper#(#)#{#FileNameMapper#mapper#=#null#;#if#(#mapperElement#!=#null#)#{#mapper#=#mapperElement#.#getImplementation#(#)#;#}#else#{#mapper#=#new#IdentityMapper#(#)#;#}#return#mapper#;#}##void#extractFile#(#FileUtils#fileUtils#,#File#srcF#,#File#dir#,#InputStream#compressedInputStream#,#String#entryName#,#Date#entryDate#,#boolean#isDirectory#,#FileNameMapper#mapper#)#throws#IOException#{#if#(#stripAbsolutePathSpec#&&#entryName#.#length#(#)#>#0#&&#(#entryName#.#charAt#(#0#)#==#File#.#separatorChar#||#entryName#.#charAt#(#0#)#==#'/'#||#entryName#.#charAt#(#0#)#==#'\\'#)#)#{#log#(#"stripped absolute path spec from "#+#entryName#,#Project#.#MSG_VERBOSE#)#;#entryName#=#entryName#.#substring#(#1#)#;#}#if#(#patternsets#!=#null#&&#patternsets#.#size#(#)#>#0#)#{#String#name#=#entryName#.#replace#(#'/'#,#File#.#separatorChar#)#.#replace#(#'\\'#,#File#.#separatorChar#)#;#boolean#included#=#false#;#Set#includePatterns#=#new#HashSet#(#)#;#Set#excludePatterns#=#new#HashSet#(#)#;#for#(#int#v#=#0#,#size#=#patternsets#.#size#(#)#;#v#<#size#;#v#++#)#{#PatternSet#p#=#(#PatternSet#)#patternsets#.#elementAt#(#v#)#;#String#[#]#incls#=#p#.#getIncludePatterns#(#getProject#(#)#)#;#if#(#incls#==#null#||#incls#.#length#==#0#)#{#// no include pattern implicitly means includes="**"#incls#=#new#String#[#]#{#"**"#}#;#}#for#(#int#w#=#0#;#w#<#incls#.#length#;#w#++#)#{#String#pattern#=#incls#[#w#]#.#replace#(#'/'#,#File#.#separatorChar#)#.#replace#(#'\\'#,#File#.#separatorChar#)#;#if#(#pattern#.#endsWith#(#File#.#separator#)#)#{#pattern#+=#"**"#;#}#includePatterns#.#add#(#pattern#)#;#}#String#[#]#excls#=#p#.#getExcludePatterns#(#getProject#(#)#)#;#if#(#excls#!=#null#)#{#for#(#int#w#=#0#;#w#<#excls#.#length#;#w#++#)#{#String#pattern#=#excls#[#w#]#.#replace#(#'/'#,#File#.#separatorChar#)#.#replace#(#'\\'#,#File#.#separatorChar#)#;#if#(#pattern#.#endsWith#(#File#.#separator#)#)#{#pattern#+=#"**"#;#}#excludePatterns#.#add#(#pattern#)#;#}#}#}#for#(#Iterator#iter#=#includePatterns#.#iterator#(#)#;#!#included#&&#iter#.#hasNext#(#)#;#)#{#String#pattern#=#(#String#)#iter#.#next#(#)#;#included#=#SelectorUtils#.#matchPath#(#pattern#,#name#)#;#}#for#(#Iterator#iter#=#excludePatterns#.#iterator#(#)#;#included#&&#iter#.#hasNext#(#)#;#)#{#String#pattern#=#(#String#)#iter#.#next#(#)#;#included#=#!#SelectorUtils#.#matchPath#(#pattern#,#name#)#;#}#if#(#!#included#)#{#//Do not process this file#log#(#"skipping "#+#entryName#+#" as it is excluded or not included."#,#Project#.#MSG_VERBOSE#)#;#return#;#}#}#String#[#]#mappedNames#=#mapper#.#mapFileName#(#entryName#)#;#if#(#mappedNames#==#null#||#mappedNames#.#length#==#0#)#{#mappedNames#=#new#String#[#]#{#entryName#}#;#}#File#f#=#fileUtils#.#resolveFile#(#dir#,#mappedNames#[#0#]#)#;#try#{#if#(#!#overwrite#&&#f#.#exists#(#)#&&#f#.#lastModified#(#)#>=#entryDate#.#getTime#(#)#)#{#log#(#"Skipping "#+#f#+#" as it is up-to-date"#,#Project#.#MSG_DEBUG#)#;#return#;#}#log#(#"expanding "#+#entryName#+#" to "#+#f#,#Project#.#MSG_VERBOSE#)#;#// create intermediary directories - sometimes zip don't add them#File#dirF#=#f#.#getParentFile#(#)#;#if#(#dirF#!=#null#)#{#dirF#.#mkdirs#(#)#;#}#if#(#isDirectory#)#{#f#.#mkdirs#(#)#;#}#else#{#byte#[#]#buffer#=#new#byte#[#BUFFER_SIZE#]#;#int#length#=#0#;#FileOutputStream#fos#=#null#;#try#{#fos#=#new#FileOutputStream#(#f#)#;#while#(#(#length#=#compressedInputStream#.#read#(#buffer#)#)#>=#0#)#{#fos#.#write#(#buffer#,#0#,#length#)#;#}#fos#.#close#(#)#;#fos#=#null#;#}#finally#{#FileUtils#.#close#(#fos#)#;#}#}#fileUtils#.#setFileLastModified#(#f#,#entryDate#.#getTime#(#)#)#;#}#catch#(#FileNotFoundException#ex#)#{#log#(#"Unable to expand to file "#+#f#.#getPath#(#)#,#ex#,#Project#.#MSG_WARN#)#;#}#}##void#setDest#(#File#d#)#{#this#.#dest#=#d#;#}##void#setSrc#(#File#s#)#{#this#.#source#=#s#;#}##void#setOverwrite#(#boolean#b#)#{#overwrite#=#b#;#}##void#addPatternset#(#PatternSet#set#)#{#patternsets#.#addElement#(#set#)#;#}##void#addFileset#(#FileSet#set#)#{#add#(#set#)#;#}##void#add#(#ResourceCollection#rc#)#{#resourcesSpecified#=#true#;#resources#.#add#(#rc#)#;#}##Mapper#createMapper#(#)#throws#BuildException#{#if#(#mapperElement#!=#null#)#{#throw#new#BuildException#(#ERROR_MULTIPLE_MAPPERS#,#getLocation#(#)#)#;#}#mapperElement#=#new#Mapper#(#getProject#(#)#)#;#return#mapperElement#;#}##void#add#(#FileNameMapper#fileNameMapper#)#{#createMapper#(#)#.#add#(#fileNameMapper#)#;#}##void#setEncoding#(#String#encoding#)#{#internalSetEncoding#(#encoding#)#;#}##void#internalSetEncoding#(#String#encoding#)#{#if#(#NATIVE_ENCODING#.#equals#(#encoding#)#)#{#encoding#=#null#;#}#this#.#encoding#=#encoding#;#}##String#getEncoding#(#)#{#return#encoding#;#}##void#setStripAbsolutePathSpec#(#boolean#b#)#{#stripAbsolutePathSpec#=#b#;#}##void#setScanForUnicodeExtraFields#(#boolean#b#)#{#internalSetScanForUnicodeExtraFields#(#b#)#;#}##void#internalSetScanForUnicodeExtraFields#(#boolean#b#)#{#scanForUnicodeExtraFields#=#b#;#}##boolean#getScanForUnicodeExtraFields#(#)#{#return#scanForUnicodeExtraFields#;#}##