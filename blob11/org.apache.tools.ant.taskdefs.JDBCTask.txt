void#setClasspath#(#Path#classpath#)#{#this#.#classpath#=#classpath#;#}##void#setCaching#(#boolean#enable#)#{#caching#=#enable#;#}##Path#createClasspath#(#)#{#if#(#this#.#classpath#==#null#)#{#this#.#classpath#=#new#Path#(#getProject#(#)#)#;#}#return#this#.#classpath#.#createPath#(#)#;#}##void#setClasspathRef#(#Reference#r#)#{#createClasspath#(#)#.#setRefid#(#r#)#;#}##void#setDriver#(#String#driver#)#{#this#.#driver#=#driver#.#trim#(#)#;#}##void#setUrl#(#String#url#)#{#this#.#url#=#url#;#}##void#setPassword#(#String#password#)#{#this#.#password#=#password#;#}##void#setAutocommit#(#boolean#autocommit#)#{#this#.#autocommit#=#autocommit#;#}##void#setRdbms#(#String#rdbms#)#{#this#.#rdbms#=#rdbms#;#}##void#setVersion#(#String#version#)#{#this#.#version#=#version#;#}##void#setFailOnConnectionError#(#boolean#b#)#{#failOnConnectionError#=#b#;#}##boolean#isValidRdbms#(#Connection#conn#)#{#if#(#rdbms#==#null#&&#version#==#null#)#{#return#true#;#}#try#{#DatabaseMetaData#dmd#=#conn#.#getMetaData#(#)#;#if#(#rdbms#!=#null#)#{#String#theVendor#=#dmd#.#getDatabaseProductName#(#)#.#toLowerCase#(#)#;#log#(#"RDBMS = "#+#theVendor#,#Project#.#MSG_VERBOSE#)#;#if#(#theVendor#==#null#||#theVendor#.#indexOf#(#rdbms#)#<#0#)#{#log#(#"Not the required RDBMS: "#+#rdbms#,#Project#.#MSG_VERBOSE#)#;#return#false#;#}#}#if#(#version#!=#null#)#{#String#theVersion#=#dmd#.#getDatabaseProductVersion#(#)#.#toLowerCase#(#Locale#.#ENGLISH#)#;#log#(#"Version = "#+#theVersion#,#Project#.#MSG_VERBOSE#)#;#if#(#theVersion#==#null#||#!#(#theVersion#.#startsWith#(#version#)#||#theVersion#.#indexOf#(#" "#+#version#)#>=#0#)#)#{#log#(#"Not the required version: \""#+#version#+#"\""#,#Project#.#MSG_VERBOSE#)#;#return#false#;#}#}#}#catch#(#SQLException#e#)#{#// Could not get the required information#log#(#"Failed to obtain required RDBMS information"#,#Project#.#MSG_ERR#)#;#return#false#;#}#return#true#;#}##Hashtable#getLoaderMap#(#)#{#return#loaderMap#;#}##AntClassLoader#getLoader#(#)#{#return#loader#;#}##void#addConnectionProperty#(#Property#var#)#{#connectionProperties#.#add#(#var#)#;#}##Connection#getConnection#(#)#throws#BuildException#{#if#(#userId#==#null#)#{#throw#new#BuildException#(#"UserId attribute must be set!"#,#getLocation#(#)#)#;#}#if#(#password#==#null#)#{#throw#new#BuildException#(#"Password attribute must be set!"#,#getLocation#(#)#)#;#}#if#(#url#==#null#)#{#throw#new#BuildException#(#"Url attribute must be set!"#,#getLocation#(#)#)#;#}#try#{#log#(#"connecting to "#+#getUrl#(#)#,#Project#.#MSG_VERBOSE#)#;#Properties#info#=#new#Properties#(#)#;#info#.#put#(#"user"#,#getUserId#(#)#)#;#info#.#put#(#"password"#,#getPassword#(#)#)#;#for#(#Iterator#props#=#connectionProperties#.#iterator#(#)#;#props#.#hasNext#(#)#;#)#{#Property#p#=#(#Property#)#props#.#next#(#)#;#String#name#=#p#.#getName#(#)#;#String#value#=#p#.#getValue#(#)#;#if#(#name#==#null#||#value#==#null#)#{#log#(#"Only name/value pairs are supported as connection"#+#" properties."#,#Project#.#MSG_WARN#)#;#}#else#{#log#(#"Setting connection property "#+#name#+#" to "#+#value#,#Project#.#MSG_VERBOSE#)#;#info#.#put#(#name#,#value#)#;#}#}#Connection#conn#=#getDriver#(#)#.#connect#(#getUrl#(#)#,#info#)#;#if#(#conn#==#null#)#{#// Driver doesn't understand the URL#throw#new#SQLException#(#"No suitable Driver for "#+#url#)#;#}#conn#.#setAutoCommit#(#autocommit#)#;#return#conn#;#}#catch#(#SQLException#e#)#{#// failed to connect#if#(#!#failOnConnectionError#)#{#log#(#"Failed to connect: "#+#e#.#getMessage#(#)#,#Project#.#MSG_WARN#)#;#return#null#;#}#else#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#}#}##Driver#getDriver#(#)#throws#BuildException#{#if#(#driver#==#null#)#{#throw#new#BuildException#(#"Driver attribute must be set!"#,#getLocation#(#)#)#;#}#Driver#driverInstance#=#null#;#try#{#Class#dc#;#if#(#classpath#!=#null#)#{#// check first that it is not already loaded otherwise#// consecutive runs seems to end into an OutOfMemoryError#// or it fails when there is a native library to load#// several times.#// this is far from being perfect but should work#// in most cases.#synchronized#(#loaderMap#)#{#if#(#caching#)#{#loader#=#(#AntClassLoader#)#loaderMap#.#get#(#driver#)#;#}#if#(#loader#==#null#)#{#log#(#"Loading "#+#driver#+#" using AntClassLoader with classpath "#+#classpath#,#Project#.#MSG_VERBOSE#)#;#loader#=#getProject#(#)#.#createClassLoader#(#classpath#)#;#if#(#caching#)#{#loaderMap#.#put#(#driver#,#loader#)#;#}#}#else#{#log#(#"Loading "#+#driver#+#" using a cached AntClassLoader."#,#Project#.#MSG_VERBOSE#)#;#}#}#dc#=#loader#.#loadClass#(#driver#)#;#}#else#{#log#(#"Loading "#+#driver#+#" using system loader."#,#Project#.#MSG_VERBOSE#)#;#dc#=#Class#.#forName#(#driver#)#;#}#driverInstance#=#(#Driver#)#dc#.#newInstance#(#)#;#}#catch#(#ClassNotFoundException#e#)#{#throw#new#BuildException#(#"Class Not Found: JDBC driver "#+#driver#+#" could not be loaded"#,#e#,#getLocation#(#)#)#;#}#catch#(#IllegalAccessException#e#)#{#throw#new#BuildException#(#"Illegal Access: JDBC driver "#+#driver#+#" could not be loaded"#,#e#,#getLocation#(#)#)#;#}#catch#(#InstantiationException#e#)#{#throw#new#BuildException#(#"Instantiation Exception: JDBC driver "#+#driver#+#" could not be loaded"#,#e#,#getLocation#(#)#)#;#}#return#driverInstance#;#}##void#isCaching#(#boolean#value#)#{#caching#=#value#;#}##Path#getClasspath#(#)#{#return#classpath#;#}##boolean#isAutocommit#(#)#{#return#autocommit#;#}##String#getUrl#(#)#{#return#url#;#}##String#getUserId#(#)#{#return#userId#;#}##void#setUserid#(#String#userId#)#{#this#.#userId#=#userId#;#}##String#getPassword#(#)#{#return#password#;#}##String#getRdbms#(#)#{#return#rdbms#;#}##String#getVersion#(#)#{#return#version#;#}##