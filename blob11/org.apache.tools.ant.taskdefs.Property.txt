void#setRelative#(#boolean#relative#)#{#this#.#relative#=#relative#;#}##void#setBasedir#(#File#basedir#)#{#this#.#basedir#=#basedir#;#}##void#setName#(#String#name#)#{#this#.#name#=#name#;#}##String#getName#(#)#{#return#name#;#}##void#setLocation#(#File#location#)#{#if#(#relative#)#{#internalSetValue#(#location#)#;#}#else#{#setValue#(#location#.#getAbsolutePath#(#)#)#;#}#}##void#setValue#(#Object#value#)#{#valueAttributeUsed#=#true#;#internalSetValue#(#value#)#;#}##void#internalSetValue#(#Object#value#)#{#this#.#untypedValue#=#value#;#//preserve protected string value for subclasses :(#this#.#value#=#value#==#null#?#null#:#value#.#toString#(#)#;#}##void#setValue#(#String#value#)#{#setValue#(#(#Object#)#value#)#;#}##void#addText#(#String#msg#)#{#if#(#!#valueAttributeUsed#)#{#msg#=#getProject#(#)#.#replaceProperties#(#msg#)#;#String#currentValue#=#getValue#(#)#;#if#(#currentValue#!=#null#)#{#msg#=#currentValue#+#msg#;#}#internalSetValue#(#msg#)#;#}#else#if#(#msg#.#trim#(#)#.#length#(#)#>#0#)#{#throw#new#BuildException#(#"can't combine nested text with value"#+#" attribute"#)#;#}#}##String#getValue#(#)#{#return#value#;#}##void#setFile#(#File#file#)#{#this#.#file#=#file#;#}##File#getFile#(#)#{#return#file#;#}##void#setUrl#(#URL#url#)#{#this#.#url#=#url#;#}##URL#getUrl#(#)#{#return#url#;#}##void#setPrefix#(#String#prefix#)#{#this#.#prefix#=#prefix#;#if#(#!#prefix#.#endsWith#(#"."#)#)#{#this#.#prefix#+=#"."#;#}#}##String#getPrefix#(#)#{#return#prefix#;#}##void#setRefid#(#Reference#ref#)#{#this#.#ref#=#ref#;#}##Reference#getRefid#(#)#{#return#ref#;#}##void#setResource#(#String#resource#)#{#this#.#resource#=#resource#;#}##String#getResource#(#)#{#return#resource#;#}##void#setEnvironment#(#String#env#)#{#this#.#env#=#env#;#}##String#getEnvironment#(#)#{#return#env#;#}##void#setClasspath#(#Path#classpath#)#{#if#(#this#.#classpath#==#null#)#{#this#.#classpath#=#classpath#;#}#else#{#this#.#classpath#.#append#(#classpath#)#;#}#}##Path#createClasspath#(#)#{#if#(#this#.#classpath#==#null#)#{#this#.#classpath#=#new#Path#(#getProject#(#)#)#;#}#return#this#.#classpath#.#createPath#(#)#;#}##void#setClasspathRef#(#Reference#r#)#{#createClasspath#(#)#.#setRefid#(#r#)#;#}##Path#getClasspath#(#)#{#return#classpath#;#}##void#setUserProperty#(#boolean#userProperty#)#{#log#(#"DEPRECATED: Ignoring request to set user property in Property"#+#" task."#,#Project#.#MSG_WARN#)#;#}##String#toString#(#)#{#return#value#==#null#?#""#:#value#;#}##void#execute#(#)#throws#BuildException#{#if#(#getProject#(#)#==#null#)#{#throw#new#IllegalStateException#(#"project has not been set"#)#;#}#if#(#name#!=#null#)#{#if#(#untypedValue#==#null#&&#ref#==#null#)#{#throw#new#BuildException#(#"You must specify value, location or "#+#"refid with the name attribute"#,#getLocation#(#)#)#;#}#}#else#{#if#(#url#==#null#&&#file#==#null#&&#resource#==#null#&&#env#==#null#)#{#throw#new#BuildException#(#"You must specify url, file, resource or "#+#"environment when not using the "#+#"name attribute"#,#getLocation#(#)#)#;#}#}#if#(#url#==#null#&&#file#==#null#&&#resource#==#null#&&#prefix#!=#null#)#{#throw#new#BuildException#(#"Prefix is only valid when loading from "#+#"a url, file or resource"#,#getLocation#(#)#)#;#}#if#(#name#!=#null#&&#untypedValue#!=#null#)#{#if#(#relative#)#{#try#{#File#from#=#untypedValue#instanceof#File#?#(#File#)#untypedValue#:#new#File#(#untypedValue#.#toString#(#)#)#;#File#to#=#basedir#!=#null#?#basedir#:#getProject#(#)#.#getBaseDir#(#)#;#String#relPath#=#FileUtils#.#getFileUtils#(#)#.#getRelativePath#(#to#,#from#)#;#relPath#=#relPath#.#replace#(#'/'#,#File#.#separatorChar#)#;#addProperty#(#name#,#relPath#)#;#}#catch#(#Exception#e#)#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#}#else#{#addProperty#(#name#,#untypedValue#)#;#}#}#if#(#file#!=#null#)#{#loadFile#(#file#)#;#}#if#(#url#!=#null#)#{#loadUrl#(#url#)#;#}#if#(#resource#!=#null#)#{#loadResource#(#resource#)#;#}#if#(#env#!=#null#)#{#loadEnvironment#(#env#)#;#}#if#(#(#name#!=#null#)#&&#(#ref#!=#null#)#)#{#try#{#addProperty#(#name#,#ref#.#getReferencedObject#(#getProject#(#)#)#.#toString#(#)#)#;#}#catch#(#BuildException#be#)#{#if#(#fallback#!=#null#)#{#addProperty#(#name#,#ref#.#getReferencedObject#(#fallback#)#.#toString#(#)#)#;#}#else#{#throw#be#;#}#}#}#}##void#loadUrl#(#URL#url#)#throws#BuildException#{#Properties#props#=#new#Properties#(#)#;#log#(#"Loading "#+#url#,#Project#.#MSG_VERBOSE#)#;#try#{#InputStream#is#=#url#.#openStream#(#)#;#try#{#loadProperties#(#props#,#is#,#url#.#getFile#(#)#.#endsWith#(#".xml"#)#)#;#}#finally#{#if#(#is#!=#null#)#{#is#.#close#(#)#;#}#}#addProperties#(#props#)#;#}#catch#(#IOException#ex#)#{#throw#new#BuildException#(#ex#,#getLocation#(#)#)#;#}#}##void#loadProperties#(#Properties#props#,#InputStream#is#,#boolean#isXml#)#throws#IOException#{#if#(#isXml#)#{#// load the xml based property definition#// use reflection because of bwc to Java 1.3#try#{#Method#loadXmlMethod#=#props#.#getClass#(#)#.#getMethod#(#"loadFromXML"#,#new#Class#[#]#{#InputStream#.#class#}#)#;#loadXmlMethod#.#invoke#(#props#,#new#Object#[#]#{#is#}#)#;#}#catch#(#NoSuchMethodException#e#)#{#e#.#printStackTrace#(#)#;#log#(#"Can not load xml based property definition on Java < 5"#)#;#}#catch#(#Exception#e#)#{#// no-op#e#.#printStackTrace#(#)#;#}#}#else#{#// load ".properties" format#props#.#load#(#is#)#;#}#}##void#loadFile#(#File#file#)#throws#BuildException#{#Properties#props#=#new#Properties#(#)#;#log#(#"Loading "#+#file#.#getAbsolutePath#(#)#,#Project#.#MSG_VERBOSE#)#;#try#{#if#(#file#.#exists#(#)#)#{#FileInputStream#fis#=#null#;#try#{#fis#=#new#FileInputStream#(#file#)#;#loadProperties#(#props#,#fis#,#file#.#getName#(#)#.#endsWith#(#".xml"#)#)#;#}#finally#{#FileUtils#.#close#(#fis#)#;#}#addProperties#(#props#)#;#}#else#{#log#(#"Unable to find property file: "#+#file#.#getAbsolutePath#(#)#,#Project#.#MSG_VERBOSE#)#;#}#}#catch#(#IOException#ex#)#{#throw#new#BuildException#(#ex#,#getLocation#(#)#)#;#}#}##void#loadResource#(#String#name#)#{#Properties#props#=#new#Properties#(#)#;#log#(#"Resource Loading "#+#name#,#Project#.#MSG_VERBOSE#)#;#InputStream#is#=#null#;#ClassLoader#cL#=#null#;#boolean#cleanup#=#false#;#try#{#if#(#classpath#!=#null#)#{#cleanup#=#true#;#cL#=#getProject#(#)#.#createClassLoader#(#classpath#)#;#}#else#{#cL#=#this#.#getClass#(#)#.#getClassLoader#(#)#;#}#if#(#cL#==#null#)#{#is#=#ClassLoader#.#getSystemResourceAsStream#(#name#)#;#}#else#{#is#=#cL#.#getResourceAsStream#(#name#)#;#}#if#(#is#!=#null#)#{#loadProperties#(#props#,#is#,#name#.#endsWith#(#".xml"#)#)#;#addProperties#(#props#)#;#}#else#{#log#(#"Unable to find resource "#+#name#,#Project#.#MSG_WARN#)#;#}#}#catch#(#IOException#ex#)#{#throw#new#BuildException#(#ex#,#getLocation#(#)#)#;#}#finally#{#if#(#is#!=#null#)#{#try#{#is#.#close#(#)#;#}#catch#(#IOException#e#)#{#// ignore#}#}#if#(#cleanup#&&#cL#!=#null#)#{#(#(#AntClassLoader#)#cL#)#.#cleanup#(#)#;#}#}#}##void#loadEnvironment#(#String#prefix#)#{#Properties#props#=#new#Properties#(#)#;#if#(#!#prefix#.#endsWith#(#"."#)#)#{#prefix#+=#"."#;#}#log#(#"Loading Environment "#+#prefix#,#Project#.#MSG_VERBOSE#)#;#Vector#osEnv#=#Execute#.#getProcEnvironment#(#)#;#for#(#Enumeration#e#=#osEnv#.#elements#(#)#;#e#.#hasMoreElements#(#)#;#)#{#String#entry#=#(#String#)#e#.#nextElement#(#)#;#int#pos#=#entry#.#indexOf#(#'='#)#;#if#(#pos#==#-#1#)#{#log#(#"Ignoring: "#+#entry#,#Project#.#MSG_WARN#)#;#}#else#{#props#.#put#(#prefix#+#entry#.#substring#(#0#,#pos#)#,#entry#.#substring#(#pos#+#1#)#)#;#}#}#addProperties#(#props#)#;#}##void#addProperties#(#Properties#props#)#{#HashMap#m#=#new#HashMap#(#props#)#;#resolveAllProperties#(#m#)#;#for#(#Iterator#it#=#m#.#keySet#(#)#.#iterator#(#)#;#it#.#hasNext#(#)#;#)#{#Object#k#=#it#.#next#(#)#;#if#(#k#instanceof#String#)#{#String#propertyName#=#(#String#)#k#;#if#(#prefix#!=#null#)#{#propertyName#=#prefix#+#propertyName#;#}#addProperty#(#propertyName#,#m#.#get#(#k#)#)#;#}#}#}##void#addProperty#(#String#n#,#String#v#)#{#addProperty#(#n#,#(#Object#)#v#)#;#}##void#addProperty#(#String#n#,#Object#v#)#{#PropertyHelper#ph#=#PropertyHelper#.#getPropertyHelper#(#getProject#(#)#)#;#if#(#userProperty#)#{#if#(#ph#.#getUserProperty#(#n#)#==#null#)#{#ph#.#setInheritedProperty#(#n#,#v#)#;#}#else#{#log#(#"Override ignored for "#+#n#,#Project#.#MSG_VERBOSE#)#;#}#}#else#{#ph#.#setNewProperty#(#n#,#v#)#;#}#}##void#resolveAllProperties#(#Map#props#)#throws#BuildException#{#PropertyHelper#propertyHelper#=#(#PropertyHelper#)#PropertyHelper#.#getPropertyHelper#(#getProject#(#)#)#;#new#ResolvePropertyMap#(#getProject#(#)#,#propertyHelper#,#propertyHelper#.#getExpanders#(#)#)#.#resolveAllProperties#(#props#)#;#}##