String#getRefid#(#)#{#return#refid#;#}##void#setRefid#(#String#refid#)#{#this#.#refid#=#refid#;#}##PropertyHelper#.#Delegate#resolve#(#)#{#if#(#refid#==#null#)#{#throw#new#BuildException#(#"refid required for generic delegate"#)#;#}#return#(#PropertyHelper#.#Delegate#)#getProject#(#)#.#getReference#(#refid#)#;#}##void#addConfigured#(#PropertyHelper#propertyHelper#)#{#if#(#this#.#propertyHelper#!=#null#)#{#throw#new#BuildException#(#"Only one PropertyHelper can be installed"#)#;#}#this#.#propertyHelper#=#propertyHelper#;#}##void#addConfigured#(#PropertyHelper#.#Delegate#delegate#)#{#getAddDelegateList#(#)#.#add#(#delegate#)#;#}##DelegateElement#createDelegate#(#)#{#DelegateElement#result#=#new#DelegateElement#(#)#;#getAddDelegateList#(#)#.#add#(#result#)#;#return#result#;#}##void#execute#(#)#throws#BuildException#{#if#(#getProject#(#)#==#null#)#{#throw#new#BuildException#(#"Project instance not set"#)#;#}#if#(#propertyHelper#==#null#&&#delegates#==#null#)#{#throw#new#BuildException#(#"Either a new PropertyHelper"#+#" or one or more PropertyHelper delegates are required"#)#;#}#PropertyHelper#ph#=#propertyHelper#;#if#(#ph#==#null#)#{#ph#=#PropertyHelper#.#getPropertyHelper#(#getProject#(#)#)#;#}#else#{#ph#=#propertyHelper#;#}#synchronized#(#ph#)#{#if#(#delegates#!=#null#)#{#for#(#Iterator#iter#=#delegates#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#Object#o#=#iter#.#next#(#)#;#PropertyHelper#.#Delegate#delegate#=#o#instanceof#DelegateElement#?#(#(#DelegateElement#)#o#)#.#resolve#(#)#:#(#PropertyHelper#.#Delegate#)#o#;#log#(#"Adding PropertyHelper delegate "#+#delegate#,#Project#.#MSG_DEBUG#)#;#ph#.#add#(#delegate#)#;#}#}#}#if#(#propertyHelper#!=#null#)#{#log#(#"Installing PropertyHelper "#+#propertyHelper#,#Project#.#MSG_DEBUG#)#;#// TODO copy existing properties to new PH?#getProject#(#)#.#addReference#(#MagicNames#.#REFID_PROPERTY_HELPER#,#propertyHelper#)#;#}#}##List#getAddDelegateList#(#)#{#if#(#delegates#==#null#)#{#delegates#=#new#ArrayList#(#)#;#}#return#delegates#;#}##