void#setUp#(#)#throws#Exception#{#// make sure the cache is cleared.#JDBCTask#.#getLoaderMap#(#)#.#clear#(#)#;#}##void#testDriverCaching#(#)#{#SQLExec#sql#=#createTask#(#getProperties#(#NULL#)#)#;#assertTrue#(#!#SQLExec#.#getLoaderMap#(#)#.#containsKey#(#NULL_DRIVER#)#)#;#try#{#sql#.#execute#(#)#;#}#catch#(#BuildException#e#)#{#assertTrue#(#e#.#getCause#(#)#.#getMessage#(#)#.#indexOf#(#"No suitable Driver"#)#!=#-#1#)#;#}#assertTrue#(#SQLExec#.#getLoaderMap#(#)#.#containsKey#(#NULL_DRIVER#)#)#;#assertSame#(#sql#.#getLoader#(#)#,#JDBCTask#.#getLoaderMap#(#)#.#get#(#NULL_DRIVER#)#)#;#ClassLoader#loader1#=#sql#.#getLoader#(#)#;#// 2nd run..#sql#=#createTask#(#getProperties#(#NULL#)#)#;#// the driver must still be cached.#assertTrue#(#JDBCTask#.#getLoaderMap#(#)#.#containsKey#(#NULL_DRIVER#)#)#;#try#{#sql#.#execute#(#)#;#}#catch#(#BuildException#e#)#{#assertTrue#(#e#.#getCause#(#)#.#getMessage#(#)#.#indexOf#(#"No suitable Driver"#)#!=#-#1#)#;#}#assertTrue#(#JDBCTask#.#getLoaderMap#(#)#.#containsKey#(#NULL_DRIVER#)#)#;#assertSame#(#sql#.#getLoader#(#)#,#JDBCTask#.#getLoaderMap#(#)#.#get#(#NULL_DRIVER#)#)#;#assertSame#(#loader1#,#sql#.#getLoader#(#)#)#;#}##void#testNull#(#)#throws#Exception#{#doMultipleCalls#(#1000#,#NULL#,#true#,#true#)#;#}##void#doMultipleCalls#(#int#calls#,#int#database#,#boolean#caching#,#boolean#catchexception#)#{#Properties#props#=#getProperties#(#database#)#;#for#(#int#i#=#0#;#i#<#calls#;#i#++#)#{#SQLExec#sql#=#createTask#(#props#)#;#sql#.#setCaching#(#caching#)#;#try#{#sql#.#execute#(#)#;#}#catch#(#BuildException#e#)#{#if#(#!#catchexception#)#{#throw#e#;#}#}#}#}##SQLExec#createTask#(#Properties#props#)#{#SQLExec#sql#=#new#SQLExec#(#)#;#sql#.#setProject#(#new#Project#(#)#)#;#sql#.#setDriver#(#props#.#getProperty#(#DRIVER#)#)#;#sql#.#setUserid#(#props#.#getProperty#(#USER#)#)#;#sql#.#setPassword#(#props#.#getProperty#(#PASSWORD#)#)#;#sql#.#setUrl#(#props#.#getProperty#(#URL#)#)#;#sql#.#createClasspath#(#)#.#setLocation#(#new#File#(#props#.#getProperty#(#PATH#)#)#)#;#sql#.#addText#(#props#.#getProperty#(#SQL#)#)#;#return#sql#;#}##String#findResourcePath#(#String#resource#)#{#resource#=#resource#.#replace#(#'.'#,#'/'#)#+#".class"#;#URL#url#=#getClass#(#)#.#getClassLoader#(#)#.#getResource#(#resource#)#;#if#(#url#==#null#)#{#return#null#;#}#String#u#=#url#.#toString#(#)#;#if#(#u#.#startsWith#(#"jar:file:"#)#)#{#int#pling#=#u#.#indexOf#(#"!"#)#;#return#u#.#substring#(#"jar:file:"#.#length#(#)#,#pling#)#;#}#else#if#(#u#.#startsWith#(#"file:"#)#)#{#int#tail#=#u#.#indexOf#(#resource#)#;#return#u#.#substring#(#"file:"#.#length#(#)#,#tail#)#;#}#return#null#;#}##Properties#getProperties#(#int#database#)#{#Properties#props#=#null#;#switch#(#database#)#{#case#ORACLE#:#props#=#getProperties#(#"oracle.jdbc.driver.OracleDriver"#,#"test"#,#"test"#,#"jdbc:oracle:thin:@127.0.0.1:1521:orcl"#)#;#break#;#case#MYSQL#:#props#=#getProperties#(#"org.gjt.mm.mysql.Driver"#,#"test"#,#"test"#,#"jdbc:mysql://127.0.0.1:3306/test"#)#;#break#;#case#NULL#:#default#:#props#=#getProperties#(#NULL_DRIVER#,#"test"#,#"test"#,#"jdbc:database://hostname:port/name"#)#;#}#// look for the driver path...#String#path#=#findResourcePath#(#props#.#getProperty#(#DRIVER#)#)#;#props#.#put#(#PATH#,#path#)#;#props#.#put#(#SQL#,#"create table OOME_TEST(X INTEGER NOT NULL);\ndrop table if exists OOME_TEST;"#)#;#return#props#;#}##Properties#getProperties#(#String#driver#,#String#user#,#String#pwd#,#String#url#)#{#Properties#props#=#new#Properties#(#)#;#props#.#put#(#DRIVER#,#driver#)#;#props#.#put#(#USER#,#user#)#;#props#.#put#(#PASSWORD#,#pwd#)#;#props#.#put#(#URL#,#url#)#;#return#props#;#}##Connection#connect#(#String#url#,#Properties#info#)#throws#SQLException#{#return#null#;#}##boolean#acceptsURL#(#String#url#)#throws#SQLException#{#return#false#;#}##DriverPropertyInfo#[#]#getPropertyInfo#(#String#url#,#Properties#info#)#throws#SQLException#{#return#new#DriverPropertyInfo#[#0#]#;#}##int#getMajorVersion#(#)#{#return#0#;#}##int#getMinorVersion#(#)#{#return#0#;#}##boolean#jdbcCompliant#(#)#{#return#false#;#}##void#testLastDelimiterPositionNormalModeStrict#(#)#{#SQLExec#s#=#new#SQLExec#(#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#)#,#null#)#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"GO"#)#,#null#)#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"; "#)#,#null#)#)#;#assertEquals#(#2#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"ab;"#)#,#null#)#)#;#s#.#setDelimiter#(#"GO"#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"GO "#)#,#null#)#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"go"#)#,#null#)#)#;#assertEquals#(#0#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"GO"#)#,#null#)#)#;#}##void#testLastDelimiterPositionNormalModeNonStrict#(#)#{#SQLExec#s#=#new#SQLExec#(#)#;#s#.#setStrictDelimiterMatching#(#false#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#)#,#null#)#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"GO"#)#,#null#)#)#;#assertEquals#(#0#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"; "#)#,#null#)#)#;#assertEquals#(#2#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"ab;"#)#,#null#)#)#;#s#.#setDelimiter#(#"GO"#)#;#assertEquals#(#0#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"GO "#)#,#null#)#)#;#assertEquals#(#0#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"go"#)#,#null#)#)#;#assertEquals#(#0#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"GO"#)#,#null#)#)#;#}##void#testLastDelimiterPositionRowModeStrict#(#)#{#SQLExec#s#=#new#SQLExec#(#)#;#SQLExec#.#DelimiterType#t#=#new#SQLExec#.#DelimiterType#(#)#;#t#.#setValue#(#"row"#)#;#s#.#setDelimiterType#(#t#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#null#,#""#)#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#null#,#"GO"#)#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#null#,#"; "#)#)#;#assertEquals#(#1#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"ab"#)#,#";"#)#)#;#s#.#setDelimiter#(#"GO"#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#null#,#"GO "#)#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#null#,#"go"#)#)#;#assertEquals#(#0#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"ab"#)#,#"GO"#)#)#;#}##void#testLastDelimiterPositionRowModeNonStrict#(#)#{#SQLExec#s#=#new#SQLExec#(#)#;#SQLExec#.#DelimiterType#t#=#new#SQLExec#.#DelimiterType#(#)#;#t#.#setValue#(#"row"#)#;#s#.#setDelimiterType#(#t#)#;#s#.#setStrictDelimiterMatching#(#false#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#null#,#""#)#)#;#assertEquals#(#-#1#,#s#.#lastDelimiterPosition#(#null#,#"GO"#)#)#;#assertEquals#(#0#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"; "#)#,#"; "#)#)#;#assertEquals#(#1#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"ab"#)#,#";"#)#)#;#s#.#setDelimiter#(#"GO"#)#;#assertEquals#(#1#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"abcd"#)#,#"GO "#)#)#;#assertEquals#(#0#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"go"#)#,#"go"#)#)#;#assertEquals#(#0#,#s#.#lastDelimiterPosition#(#new#StringBuffer#(#"ab"#)#,#"GO"#)#)#;#}##