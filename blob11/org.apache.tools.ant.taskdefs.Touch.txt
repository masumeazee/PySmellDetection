DateFormat#getPrimaryFormat#(#)#{#return#DateFormat#.#getDateTimeInstance#(#DateFormat#.#SHORT#,#DateFormat#.#SHORT#,#Locale#.#US#)#;#}##DateFormat#getFallbackFormat#(#)#{#return#DateFormat#.#getDateTimeInstance#(#DateFormat#.#SHORT#,#DateFormat#.#MEDIUM#,#Locale#.#US#)#;#}##void#setFile#(#File#file#)#{#this#.#file#=#file#;#}##void#setMillis#(#long#millis#)#{#this#.#millis#=#millis#;#}##void#setDatetime#(#String#dateTime#)#{#if#(#this#.#dateTime#!=#null#)#{#log#(#"Resetting datetime attribute to "#+#dateTime#,#Project#.#MSG_VERBOSE#)#;#}#this#.#dateTime#=#dateTime#;#dateTimeConfigured#=#false#;#}##void#setMkdirs#(#boolean#mkdirs#)#{#this#.#mkdirs#=#mkdirs#;#}##void#setVerbose#(#boolean#verbose#)#{#this#.#verbose#=#verbose#;#}##void#setPattern#(#final#String#pattern#)#{#dfFactory#=#new#DateFormatFactory#(#)#{#public#DateFormat#getPrimaryFormat#(#)#{#return#new#SimpleDateFormat#(#pattern#)#;#}#public#DateFormat#getFallbackFormat#(#)#{#return#null#;#}#}#;#}##DateFormat#getPrimaryFormat#(#)#{#return#new#SimpleDateFormat#(#pattern#)#;#}##DateFormat#getFallbackFormat#(#)#{#return#null#;#}##void#addConfiguredMapper#(#Mapper#mapper#)#{#add#(#mapper#.#getImplementation#(#)#)#;#}##void#add#(#FileNameMapper#fileNameMapper#)#throws#BuildException#{#if#(#this#.#fileNameMapper#!=#null#)#{#throw#new#BuildException#(#"Only one mapper may be added to the "#+#getTaskName#(#)#+#" task."#)#;#}#this#.#fileNameMapper#=#fileNameMapper#;#}##void#addFileset#(#FileSet#set#)#{#filesets#.#add#(#set#)#;#add#(#set#)#;#}##void#addFilelist#(#FileList#list#)#{#add#(#list#)#;#}##void#add#(#ResourceCollection#rc#)#{#resources#=#resources#==#null#?#new#Union#(#)#:#resources#;#resources#.#add#(#rc#)#;#}##void#checkConfiguration#(#)#throws#BuildException#{#if#(#file#==#null#&&#resources#==#null#)#{#throw#new#BuildException#(#"Specify at least one source"#+#"--a file or resource collection."#)#;#}#if#(#file#!=#null#&&#file#.#exists#(#)#&&#file#.#isDirectory#(#)#)#{#throw#new#BuildException#(#"Use a resource collection to touch directories."#)#;#}#if#(#dateTime#!=#null#&&#!#dateTimeConfigured#)#{#long#workmillis#=#millis#;#if#(#"now"#.#equalsIgnoreCase#(#dateTime#)#)#{#workmillis#=#System#.#currentTimeMillis#(#)#;#}#else#{#DateFormat#df#=#dfFactory#.#getPrimaryFormat#(#)#;#ParseException#pe#=#null#;#try#{#workmillis#=#df#.#parse#(#dateTime#)#.#getTime#(#)#;#}#catch#(#ParseException#peOne#)#{#df#=#dfFactory#.#getFallbackFormat#(#)#;#if#(#df#==#null#)#{#pe#=#peOne#;#}#else#{#try#{#workmillis#=#df#.#parse#(#dateTime#)#.#getTime#(#)#;#}#catch#(#ParseException#peTwo#)#{#pe#=#peTwo#;#}#}#}#if#(#pe#!=#null#)#{#throw#new#BuildException#(#pe#.#getMessage#(#)#,#pe#,#getLocation#(#)#)#;#}#if#(#workmillis#<#0#)#{#throw#new#BuildException#(#"Date of "#+#dateTime#+#" results in negative "#+#"milliseconds value "#+#"relative to epoch "#+#"(January 1, 1970, "#+#"00:00:00 GMT)."#)#;#}#}#log#(#"Setting millis to "#+#workmillis#+#" from datetime attribute"#,#(#(#millis#<#0#)#?#Project#.#MSG_DEBUG#:#Project#.#MSG_VERBOSE#)#)#;#setMillis#(#workmillis#)#;#// only set if successful to this point:#dateTimeConfigured#=#true#;#}#}##void#execute#(#)#throws#BuildException#{#checkConfiguration#(#)#;#touch#(#)#;#}##void#touch#(#)#throws#BuildException#{#long#defaultTimestamp#=#getTimestamp#(#)#;#if#(#file#!=#null#)#{#touch#(#new#FileResource#(#file#.#getParentFile#(#)#,#file#.#getName#(#)#)#,#defaultTimestamp#)#;#}#if#(#resources#==#null#)#{#return#;#}#// deal with the resource collections#Iterator#iter#=#resources#.#iterator#(#)#;#while#(#iter#.#hasNext#(#)#)#{#Resource#r#=#(#Resource#)#iter#.#next#(#)#;#Touchable#t#=#(#Touchable#)#r#.#as#(#Touchable#.#class#)#;#if#(#t#==#null#)#{#throw#new#BuildException#(#"Can't touch "#+#r#)#;#}#touch#(#r#,#defaultTimestamp#)#;#}#// deal with filesets in a special way since the task#// originally also used the directories and Union won't return#// them.#for#(#int#i#=#0#;#i#<#filesets#.#size#(#)#;#i#++#)#{#FileSet#fs#=#(#FileSet#)#filesets#.#elementAt#(#i#)#;#DirectoryScanner#ds#=#fs#.#getDirectoryScanner#(#getProject#(#)#)#;#File#fromDir#=#fs#.#getDir#(#getProject#(#)#)#;#String#[#]#srcDirs#=#ds#.#getIncludedDirectories#(#)#;#for#(#int#j#=#0#;#j#<#srcDirs#.#length#;#j#++#)#{#touch#(#new#FileResource#(#fromDir#,#srcDirs#[#j#]#)#,#defaultTimestamp#)#;#}#}#}##void#touch#(#File#file#)#{#touch#(#file#,#getTimestamp#(#)#)#;#}##long#getTimestamp#(#)#{#return#(#millis#<#0#)#?#System#.#currentTimeMillis#(#)#:#millis#;#}##void#touch#(#Resource#r#,#long#defaultTimestamp#)#{#if#(#fileNameMapper#==#null#)#{#FileProvider#fp#=#(#FileProvider#)#r#.#as#(#FileProvider#.#class#)#;#if#(#fp#!=#null#)#{#// use this to create file and deal with non-writable files#touch#(#fp#.#getFile#(#)#,#defaultTimestamp#)#;#}#else#{#(#(#Touchable#)#r#.#as#(#Touchable#.#class#)#)#.#touch#(#defaultTimestamp#)#;#}#}#else#{#String#[#]#mapped#=#fileNameMapper#.#mapFileName#(#r#.#getName#(#)#)#;#if#(#mapped#!=#null#&&#mapped#.#length#>#0#)#{#long#modTime#=#defaultTimestamp#;#if#(#millis#<#0#&&#r#.#isExists#(#)#)#{#modTime#=#r#.#getLastModified#(#)#;#}#for#(#int#i#=#0#;#i#<#mapped#.#length#;#i#++#)#{#touch#(#getProject#(#)#.#resolveFile#(#mapped#[#i#]#)#,#modTime#)#;#}#}#}#}##void#touch#(#File#file#,#long#modTime#)#{#if#(#!#file#.#exists#(#)#)#{#log#(#"Creating "#+#file#,#(#(#verbose#)#?#Project#.#MSG_INFO#:#Project#.#MSG_VERBOSE#)#)#;#try#{#FILE_UTILS#.#createNewFile#(#file#,#mkdirs#)#;#}#catch#(#IOException#ioe#)#{#throw#new#BuildException#(#"Could not create "#+#file#,#ioe#,#getLocation#(#)#)#;#}#}#if#(#!#file#.#canWrite#(#)#)#{#throw#new#BuildException#(#"Can not change modification date of "#+#"read-only file "#+#file#)#;#}#FILE_UTILS#.#setFileLastModified#(#file#,#modTime#)#;#}##