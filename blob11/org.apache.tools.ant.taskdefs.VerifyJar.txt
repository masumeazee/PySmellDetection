void#setCertificates#(#boolean#certificates#)#{#this#.#certificates#=#certificates#;#}##void#execute#(#)#throws#BuildException#{#//validation logic#final#boolean#hasJar#=#jar#!=#null#;#if#(#!#hasJar#&&#!#hasResources#(#)#)#{#throw#new#BuildException#(#ERROR_NO_SOURCE#)#;#}#beginExecution#(#)#;#//patch the redirector to save output to a file#RedirectorElement#redirector#=#getRedirector#(#)#;#redirector#.#setAlwaysLog#(#true#)#;#FilterChain#outputFilterChain#=#redirector#.#createOutputFilterChain#(#)#;#outputFilterChain#.#add#(#outputCache#)#;#try#{#Path#sources#=#createUnifiedSourcePath#(#)#;#Iterator#iter#=#sources#.#iterator#(#)#;#while#(#iter#.#hasNext#(#)#)#{#Resource#r#=#(#Resource#)#iter#.#next#(#)#;#FileProvider#fr#=#(#FileProvider#)#r#.#as#(#FileProvider#.#class#)#;#verifyOneJar#(#fr#.#getFile#(#)#)#;#}#}#finally#{#endExecution#(#)#;#}#}##void#verifyOneJar#(#File#jar#)#{#if#(#!#jar#.#exists#(#)#)#{#throw#new#BuildException#(#ERROR_NO_FILE#+#jar#)#;#}#final#ExecTask#cmd#=#createJarSigner#(#)#;#setCommonOptions#(#cmd#)#;#bindToKeystore#(#cmd#)#;#//verify special operations#addValue#(#cmd#,#"-verify"#)#;#if#(#certificates#)#{#addValue#(#cmd#,#"-certs"#)#;#}#//JAR  is required#addValue#(#cmd#,#jar#.#getPath#(#)#)#;#log#(#"Verifying JAR: "#+#jar#.#getAbsolutePath#(#)#)#;#outputCache#.#clear#(#)#;#BuildException#ex#=#null#;#try#{#cmd#.#execute#(#)#;#}#catch#(#BuildException#e#)#{#ex#=#e#;#}#String#results#=#outputCache#.#toString#(#)#;#//deal with jdk1.4.2 bug:#if#(#ex#!=#null#)#{#if#(#results#.#indexOf#(#"zip file closed"#)#>=#0#)#{#log#(#"You are running "#+#JARSIGNER_COMMAND#+#" against a JVM with"#+#" a known bug that manifests as an IllegalStateException."#,#Project#.#MSG_WARN#)#;#}#else#{#throw#ex#;#}#}#if#(#results#.#indexOf#(#VERIFIED_TEXT#)#<#0#)#{#throw#new#BuildException#(#ERROR_NO_VERIFY#+#jar#)#;#}#}##Reader#chain#(#Reader#rdr#)#{#buffer#=#new#BufferingOutputFilterReader#(#rdr#)#;#return#buffer#;#}##String#toString#(#)#{#return#buffer#.#toString#(#)#;#}##void#clear#(#)#{#if#(#buffer#!=#null#)#{#buffer#.#clear#(#)#;#}#}##int#read#(#char#[#]#cbuf#,#int#off#,#int#len#)#throws#IOException#{#//hand down#int#result#=#next#.#read#(#cbuf#,#off#,#len#)#;#//cache#buffer#.#append#(#cbuf#,#off#,#len#)#;#//return#return#result#;#}##void#close#(#)#throws#IOException#{#next#.#close#(#)#;#}##String#toString#(#)#{#return#buffer#.#toString#(#)#;#}##void#clear#(#)#{#buffer#=#new#StringBuffer#(#)#;#}##