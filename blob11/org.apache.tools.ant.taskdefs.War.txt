void#setWarfile#(#File#warFile#)#{#setDestFile#(#warFile#)#;#}##void#setWebxml#(#File#descr#)#{#deploymentDescriptor#=#descr#;#if#(#!#deploymentDescriptor#.#exists#(#)#)#{#throw#new#BuildException#(#"Deployment descriptor: "#+#deploymentDescriptor#+#" does not exist."#)#;#}#// Create a ZipFileSet for this file, and pass it up.#ZipFileSet#fs#=#new#ZipFileSet#(#)#;#fs#.#setFile#(#deploymentDescriptor#)#;#fs#.#setFullpath#(#XML_DESCRIPTOR_PATH#)#;#super#.#addFileset#(#fs#)#;#}##void#setNeedxmlfile#(#boolean#needxmlfile#)#{#this#.#needxmlfile#=#needxmlfile#;#}##void#addLib#(#ZipFileSet#fs#)#{#// We just set the prefix for this fileset, and pass it up.#fs#.#setPrefix#(#"WEB-INF/lib/"#)#;#super#.#addFileset#(#fs#)#;#}##void#addClasses#(#ZipFileSet#fs#)#{#// We just set the prefix for this fileset, and pass it up.#fs#.#setPrefix#(#"WEB-INF/classes/"#)#;#super#.#addFileset#(#fs#)#;#}##void#addWebinf#(#ZipFileSet#fs#)#{#// We just set the prefix for this fileset, and pass it up.#fs#.#setPrefix#(#"WEB-INF/"#)#;#super#.#addFileset#(#fs#)#;#}##void#initZipOutputStream#(#ZipOutputStream#zOut#)#throws#IOException#,#BuildException#{#super#.#initZipOutputStream#(#zOut#)#;#}##void#zipFile#(#File#file#,#ZipOutputStream#zOut#,#String#vPath#,#int#mode#)#throws#IOException#{#// If the file being added is WEB-INF/web.xml, we warn if it's#// not the one specified in the "webxml" attribute - or if#// it's being added twice, meaning the same file is specified#// by the "webxml" attribute and in a <fileset> element.#String#vPathLowerCase#=#vPath#.#toLowerCase#(#Locale#.#ENGLISH#)#;#//by default, we add the file.#boolean#addFile#=#true#;#if#(#XML_DESCRIPTOR_PATH_LC#.#equals#(#vPathLowerCase#)#)#{#//a web.xml file was found. See if it is a duplicate or not#if#(#addedWebXmlFile#!=#null#)#{#//a second web.xml file, so skip it#addFile#=#false#;#//check to see if we warn or not#if#(#!#FILE_UTILS#.#fileNameEquals#(#addedWebXmlFile#,#file#)#)#{#logWhenWriting#(#"Warning: selected "#+#archiveType#+#" files include a second "#+#XML_DESCRIPTOR_PATH#+#" which will be ignored.\n"#+#"The duplicate entry is at "#+#file#+#'\n'#+#"The file that will be used is "#+#addedWebXmlFile#,#Project#.#MSG_WARN#)#;#}#}#else#{#//no added file, yet#addedWebXmlFile#=#file#;#//there is no web.xml file, so add it#addFile#=#true#;#//and remember that we did#deploymentDescriptor#=#file#;#}#}#if#(#addFile#)#{#super#.#zipFile#(#file#,#zOut#,#vPath#,#mode#)#;#}#}##void#cleanUp#(#)#{#if#(#addedWebXmlFile#==#null#&&#deploymentDescriptor#==#null#&&#needxmlfile#&&#!#isInUpdateMode#(#)#&&#hasUpdatedFile#(#)#)#{#throw#new#BuildException#(#"No WEB-INF/web.xml file was added.\n"#+#"If this is your intent, set needxmlfile='false' "#)#;#}#addedWebXmlFile#=#null#;#super#.#cleanUp#(#)#;#}##