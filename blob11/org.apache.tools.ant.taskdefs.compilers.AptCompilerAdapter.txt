Apt#getApt#(#)#{#return#(#Apt#)#getJavac#(#)#;#}##void#setAptCommandlineSwitches#(#Apt#apt#,#Commandline#cmd#)#{#if#(#!#apt#.#isCompile#(#)#)#{#cmd#.#createArgument#(#)#.#setValue#(#"-nocompile"#)#;#}#// Process the factory class#String#factory#=#apt#.#getFactory#(#)#;#if#(#factory#!=#null#)#{#cmd#.#createArgument#(#)#.#setValue#(#"-factory"#)#;#cmd#.#createArgument#(#)#.#setValue#(#factory#)#;#}#// Process the factory path#Path#factoryPath#=#apt#.#getFactoryPath#(#)#;#if#(#factoryPath#!=#null#)#{#cmd#.#createArgument#(#)#.#setValue#(#"-factorypath"#)#;#cmd#.#createArgument#(#)#.#setPath#(#factoryPath#)#;#}#File#preprocessDir#=#apt#.#getPreprocessDir#(#)#;#if#(#preprocessDir#!=#null#)#{#cmd#.#createArgument#(#)#.#setValue#(#"-s"#)#;#cmd#.#createArgument#(#)#.#setFile#(#preprocessDir#)#;#}#// Process the processor options#Vector#options#=#apt#.#getOptions#(#)#;#Enumeration#elements#=#options#.#elements#(#)#;#Apt#.#Option#opt#;#StringBuffer#arg#=#null#;#while#(#elements#.#hasMoreElements#(#)#)#{#opt#=#(#Apt#.#Option#)#elements#.#nextElement#(#)#;#arg#=#new#StringBuffer#(#)#;#arg#.#append#(#"-A"#)#.#append#(#opt#.#getName#(#)#)#;#if#(#opt#.#getValue#(#)#!=#null#)#{#arg#.#append#(#"="#)#.#append#(#opt#.#getValue#(#)#)#;#}#cmd#.#createArgument#(#)#.#setValue#(#arg#.#toString#(#)#)#;#}#}##void#setAptCommandlineSwitches#(#Commandline#cmd#)#{#Apt#apt#=#getApt#(#)#;#setAptCommandlineSwitches#(#apt#,#cmd#)#;#}##boolean#execute#(#)#throws#BuildException#{#attributes#.#log#(#"Using apt compiler"#,#Project#.#MSG_VERBOSE#)#;#//set up the javac options#Commandline#cmd#=#setupModernJavacCommand#(#)#;#//then add the Apt options#setAptCommandlineSwitches#(#cmd#)#;#//finally invoke APT#// Use reflection to be able to build on all JDKs:#try#{#Class#c#=#Class#.#forName#(#APT_ENTRY_POINT#)#;#Object#compiler#=#c#.#newInstance#(#)#;#Method#compile#=#c#.#getMethod#(#APT_METHOD_NAME#,#new#Class#[#]#{#(#new#String#[#]#{#}#)#.#getClass#(#)#}#)#;#int#result#=#(#(#Integer#)#compile#.#invoke#(#compiler#,#new#Object#[#]#{#cmd#.#getArguments#(#)#}#)#)#.#intValue#(#)#;#return#(#result#==#APT_COMPILER_SUCCESS#)#;#}#catch#(#BuildException#be#)#{#//rethrow build exceptions#throw#be#;#}#catch#(#Exception#ex#)#{#//cast everything else to a build exception#throw#new#BuildException#(#"Error starting apt compiler"#,#ex#,#location#)#;#}#}##