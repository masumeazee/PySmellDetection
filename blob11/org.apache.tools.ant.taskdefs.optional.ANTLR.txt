void#setTarget#(#File#target#)#{#log#(#"Setting target to: "#+#target#.#toString#(#)#,#Project#.#MSG_VERBOSE#)#;#this#.#targetFile#=#target#;#}##void#setOutputdirectory#(#File#outputDirectory#)#{#log#(#"Setting output directory to: "#+#outputDirectory#.#toString#(#)#,#Project#.#MSG_VERBOSE#)#;#this#.#outputDirectory#=#outputDirectory#;#}##void#setGlib#(#String#superGrammar#)#{#String#sg#=#null#;#if#(#Os#.#isFamily#(#"dos"#)#)#{#sg#=#superGrammar#.#replace#(#'\\'#,#'/'#)#;#}#else#{#sg#=#superGrammar#;#}#setGlib#(#FILE_UTILS#.#resolveFile#(#getProject#(#)#.#getBaseDir#(#)#,#sg#)#)#;#}##void#setGlib#(#File#superGrammar#)#{#this#.#superGrammar#=#superGrammar#;#}##void#setDebug#(#boolean#enable#)#{#this#.#debug#=#enable#;#}##void#setHtml#(#boolean#enable#)#{#html#=#enable#;#}##void#setDiagnostic#(#boolean#enable#)#{#diagnostic#=#enable#;#}##void#setTrace#(#boolean#enable#)#{#trace#=#enable#;#}##void#setTraceParser#(#boolean#enable#)#{#traceParser#=#enable#;#}##void#setTraceLexer#(#boolean#enable#)#{#traceLexer#=#enable#;#}##void#setTraceTreeWalker#(#boolean#enable#)#{#traceTreeWalker#=#enable#;#}##void#setFork#(#boolean#s#)#{#//this.fork = s;#}##void#setDir#(#File#d#)#{#this#.#workingdir#=#d#;#}##Path#createClasspath#(#)#{#return#commandline#.#createClasspath#(#getProject#(#)#)#.#createPath#(#)#;#}##Commandline#.#Argument#createJvmarg#(#)#{#return#commandline#.#createVmArgument#(#)#;#}##void#init#(#)#throws#BuildException#{#addClasspathEntry#(#"/antlr/ANTLRGrammarParseBehavior.class"#)#;#}##void#addClasspathEntry#(#String#resource#)#{#/*
         * pre Ant 1.6 this method used to call getClass().getResource
         * while Ant 1.6 will call ClassLoader.getResource().
         *
         * The difference is that Class.getResource expects a leading
         * slash for "absolute" resources and will strip it before
         * delegating to ClassLoader.getResource - so we now have to
         * emulate Class's behavior.
         */#if#(#resource#.#startsWith#(#"/"#)#)#{#resource#=#resource#.#substring#(#1#)#;#}#else#{#resource#=#"org/apache/tools/ant/taskdefs/optional/"#+#resource#;#}#File#f#=#LoaderUtils#.#getResourceSource#(#getClass#(#)#.#getClassLoader#(#)#,#resource#)#;#if#(#f#!=#null#)#{#log#(#"Found "#+#f#.#getAbsolutePath#(#)#,#Project#.#MSG_DEBUG#)#;#createClasspath#(#)#.#setLocation#(#f#)#;#}#else#{#log#(#"Couldn\'t find "#+#resource#,#Project#.#MSG_VERBOSE#)#;#}#}##void#execute#(#)#throws#BuildException#{#validateAttributes#(#)#;#//TODO: use ANTLR to parse the grammar file to do this.#File#generatedFile#=#getGeneratedFile#(#)#;#boolean#targetIsOutOfDate#=#targetFile#.#lastModified#(#)#>#generatedFile#.#lastModified#(#)#;#boolean#superGrammarIsOutOfDate#=#superGrammar#!=#null#&&#(#superGrammar#.#lastModified#(#)#>#generatedFile#.#lastModified#(#)#)#;#if#(#targetIsOutOfDate#||#superGrammarIsOutOfDate#)#{#if#(#targetIsOutOfDate#)#{#log#(#"Compiling "#+#targetFile#+#" as it is newer than "#+#generatedFile#,#Project#.#MSG_VERBOSE#)#;#}#else#{#log#(#"Compiling "#+#targetFile#+#" as "#+#superGrammar#+#" is newer than "#+#generatedFile#,#Project#.#MSG_VERBOSE#)#;#}#populateAttributes#(#)#;#commandline#.#createArgument#(#)#.#setValue#(#targetFile#.#toString#(#)#)#;#log#(#commandline#.#describeCommand#(#)#,#Project#.#MSG_VERBOSE#)#;#int#err#=#run#(#commandline#.#getCommandline#(#)#)#;#if#(#err#!=#0#)#{#throw#new#BuildException#(#"ANTLR returned: "#+#err#,#getLocation#(#)#)#;#}#else#{#String#output#=#bos#.#toString#(#)#;#if#(#output#.#indexOf#(#"error:"#)#>#-#1#)#{#throw#new#BuildException#(#"ANTLR signaled an error: "#+#output#,#getLocation#(#)#)#;#}#}#}#else#{#log#(#"Skipped grammar file. Generated file "#+#generatedFile#+#" is newer."#,#Project#.#MSG_VERBOSE#)#;#}#}##void#populateAttributes#(#)#{#commandline#.#createArgument#(#)#.#setValue#(#"-o"#)#;#commandline#.#createArgument#(#)#.#setValue#(#outputDirectory#.#toString#(#)#)#;#if#(#superGrammar#!=#null#)#{#commandline#.#createArgument#(#)#.#setValue#(#"-glib"#)#;#commandline#.#createArgument#(#)#.#setValue#(#superGrammar#.#toString#(#)#)#;#}#if#(#html#)#{#commandline#.#createArgument#(#)#.#setValue#(#"-html"#)#;#}#if#(#diagnostic#)#{#commandline#.#createArgument#(#)#.#setValue#(#"-diagnostic"#)#;#}#if#(#trace#)#{#commandline#.#createArgument#(#)#.#setValue#(#"-trace"#)#;#}#if#(#traceParser#)#{#commandline#.#createArgument#(#)#.#setValue#(#"-traceParser"#)#;#}#if#(#traceLexer#)#{#commandline#.#createArgument#(#)#.#setValue#(#"-traceLexer"#)#;#}#if#(#traceTreeWalker#)#{#if#(#is272#(#)#)#{#commandline#.#createArgument#(#)#.#setValue#(#"-traceTreeParser"#)#;#}#else#{#commandline#.#createArgument#(#)#.#setValue#(#"-traceTreeWalker"#)#;#}#}#if#(#debug#)#{#commandline#.#createArgument#(#)#.#setValue#(#"-debug"#)#;#}#}##void#validateAttributes#(#)#throws#BuildException#{#if#(#targetFile#==#null#||#!#targetFile#.#isFile#(#)#)#{#throw#new#BuildException#(#"Invalid target: "#+#targetFile#)#;#}#// if no output directory is specified, used the target's directory#if#(#outputDirectory#==#null#)#{#setOutputdirectory#(#new#File#(#targetFile#.#getParent#(#)#)#)#;#}#if#(#!#outputDirectory#.#isDirectory#(#)#)#{#throw#new#BuildException#(#"Invalid output directory: "#+#outputDirectory#)#;#}#}##File#getGeneratedFile#(#)#throws#BuildException#{#String#generatedFileName#=#null#;#try#{#BufferedReader#in#=#new#BufferedReader#(#new#FileReader#(#targetFile#)#)#;#String#line#;#while#(#(#line#=#in#.#readLine#(#)#)#!=#null#)#{#int#extendsIndex#=#line#.#indexOf#(#" extends "#)#;#if#(#line#.#startsWith#(#"class "#)#&&#extendsIndex#>#-#1#)#{#generatedFileName#=#line#.#substring#(#"class "#.#length#(#)#,#extendsIndex#)#.#trim#(#)#;#break#;#}#}#in#.#close#(#)#;#}#catch#(#Exception#e#)#{#throw#new#BuildException#(#"Unable to determine generated class"#,#e#)#;#}#if#(#generatedFileName#==#null#)#{#throw#new#BuildException#(#"Unable to determine generated class"#)#;#}#return#new#File#(#outputDirectory#,#generatedFileName#+#(#html#?#".html"#:#".java"#)#)#;#}##int#run#(#String#[#]#command#)#throws#BuildException#{#PumpStreamHandler#psh#=#new#PumpStreamHandler#(#new#LogOutputStream#(#this#,#Project#.#MSG_INFO#)#,#new#TeeOutputStream#(#new#LogOutputStream#(#this#,#Project#.#MSG_WARN#)#,#bos#)#)#;#Execute#exe#=#new#Execute#(#psh#,#null#)#;#exe#.#setAntRun#(#getProject#(#)#)#;#if#(#workingdir#!=#null#)#{#exe#.#setWorkingDirectory#(#workingdir#)#;#}#exe#.#setCommandline#(#command#)#;#try#{#return#exe#.#execute#(#)#;#}#catch#(#IOException#e#)#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#finally#{#FileUtils#.#close#(#bos#)#;#}#}##boolean#is272#(#)#{#AntClassLoader#l#=#null#;#try#{#l#=#getProject#(#)#.#createClassLoader#(#commandline#.#getClasspath#(#)#)#;#l#.#loadClass#(#"antlr.Version"#)#;#return#true#;#}#catch#(#ClassNotFoundException#e#)#{#return#false#;#}#finally#{#if#(#l#!=#null#)#{#l#.#cleanup#(#)#;#}#}#}##