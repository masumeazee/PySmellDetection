void#setOutput#(#OutputStream#out#)#{#this#.#out#=#out#;#output#=#new#BufferedWriter#(#new#java#.#io#.#OutputStreamWriter#(#out#)#)#;#}##void#setSystemOutput#(#String#out#)#{#systemOutput#=#out#;#}##void#setSystemError#(#String#err#)#{#systemError#=#err#;#}##void#startTestSuite#(#JUnitTest#suite#)#{#if#(#output#==#null#)#{#return#;#// Quick return - no output do nothing.#}#StringBuffer#sb#=#new#StringBuffer#(#"Testsuite: "#)#;#sb#.#append#(#suite#.#getName#(#)#)#;#sb#.#append#(#StringUtils#.#LINE_SEP#)#;#try#{#output#.#write#(#sb#.#toString#(#)#)#;#output#.#flush#(#)#;#}#catch#(#IOException#ex#)#{#throw#new#BuildException#(#ex#)#;#}#}##void#endTestSuite#(#JUnitTest#suite#)#{#StringBuffer#sb#=#new#StringBuffer#(#"Tests run: "#)#;#sb#.#append#(#suite#.#runCount#(#)#)#;#sb#.#append#(#", Failures: "#)#;#sb#.#append#(#suite#.#failureCount#(#)#)#;#sb#.#append#(#", Errors: "#)#;#sb#.#append#(#suite#.#errorCount#(#)#)#;#sb#.#append#(#", Time elapsed: "#)#;#sb#.#append#(#numberFormat#.#format#(#suite#.#getRunTime#(#)#/#ONE_SECOND#)#)#;#sb#.#append#(#" sec"#)#;#sb#.#append#(#StringUtils#.#LINE_SEP#)#;#sb#.#append#(#StringUtils#.#LINE_SEP#)#;#// append the err and output streams to the log#if#(#systemOutput#!=#null#&&#systemOutput#.#length#(#)#>#0#)#{#sb#.#append#(#"------------- Standard Output ---------------"#)#.#append#(#StringUtils#.#LINE_SEP#)#.#append#(#systemOutput#)#.#append#(#"------------- ---------------- ---------------"#)#.#append#(#StringUtils#.#LINE_SEP#)#;#}#if#(#systemError#!=#null#&&#systemError#.#length#(#)#>#0#)#{#sb#.#append#(#"------------- Standard Error -----------------"#)#.#append#(#StringUtils#.#LINE_SEP#)#.#append#(#systemError#)#.#append#(#"------------- ---------------- ---------------"#)#.#append#(#StringUtils#.#LINE_SEP#)#;#}#if#(#output#!=#null#)#{#try#{#output#.#write#(#sb#.#toString#(#)#)#;#resultWriter#.#close#(#)#;#output#.#write#(#results#.#toString#(#)#)#;#}#catch#(#IOException#ex#)#{#throw#new#BuildException#(#ex#)#;#}#finally#{#try#{#output#.#flush#(#)#;#}#catch#(#IOException#ex#)#{#// swallow, there has likely been an exception before this#}#if#(#out#!=#System#.#out#&&#out#!=#System#.#err#)#{#FileUtils#.#close#(#out#)#;#}#}#}#}##void#startTest#(#Test#test#)#{#}##void#endTest#(#Test#test#)#{#}##void#addFailure#(#Test#test#,#Throwable#t#)#{#formatError#(#"\tFAILED"#,#test#,#t#)#;#}##void#addFailure#(#Test#test#,#AssertionFailedError#t#)#{#addFailure#(#test#,#(#Throwable#)#t#)#;#}##void#addError#(#Test#test#,#Throwable#error#)#{#formatError#(#"\tCaused an ERROR"#,#test#,#error#)#;#}##String#formatTest#(#Test#test#)#{#if#(#test#==#null#)#{#return#"Null Test: "#;#}#else#{#return#"Testcase: "#+#test#.#toString#(#)#+#":"#;#}#}##void#formatError#(#String#type#,#Test#test#,#Throwable#error#)#{#if#(#test#!=#null#)#{#endTest#(#test#)#;#}#try#{#resultWriter#.#write#(#formatTest#(#test#)#+#type#)#;#resultWriter#.#newLine#(#)#;#resultWriter#.#write#(#String#.#valueOf#(#error#.#getMessage#(#)#)#)#;#resultWriter#.#newLine#(#)#;#String#strace#=#JUnitTestRunner#.#getFilteredTrace#(#error#)#;#resultWriter#.#write#(#strace#)#;#resultWriter#.#newLine#(#)#;#resultWriter#.#newLine#(#)#;#}#catch#(#IOException#ex#)#{#throw#new#BuildException#(#ex#)#;#}#}##