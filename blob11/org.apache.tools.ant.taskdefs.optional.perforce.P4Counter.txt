void#setName#(#String#counter#)#{#this#.#counter#=#counter#;#}##void#setValue#(#int#value#)#{#this#.#value#=#value#;#shouldSetValue#=#true#;#}##void#setProperty#(#String#property#)#{#this#.#property#=#property#;#shouldSetProperty#=#true#;#}##void#execute#(#)#throws#BuildException#{#if#(#(#counter#==#null#)#||#counter#.#length#(#)#==#0#)#{#throw#new#BuildException#(#"No counter specified to retrieve"#)#;#}#if#(#shouldSetValue#&&#shouldSetProperty#)#{#throw#new#BuildException#(#"Cannot both set the value of the property and retrieve the "#+#"value of the property."#)#;#}#String#command#=#"counter "#+#P4CmdOpts#+#" "#+#counter#;#if#(#!#shouldSetProperty#)#{#// NOTE kirk@radik.com 04-April-2001 -- If you put in the -s, you#// have to start running through regular expressions here. Much easier#// to just not include the scripting information than to try to add it#// and strip it later.#command#=#"-s "#+#command#;#}#if#(#shouldSetValue#)#{#command#+=#" "#+#value#;#}#if#(#shouldSetProperty#)#{#final#Project#myProj#=#getProject#(#)#;#P4Handler#handler#=#new#P4HandlerAdapter#(#)#{#public#void#process#(#String#line#)#{#log#(#"P4Counter retrieved line \""#+#line#+#"\""#,#Project#.#MSG_VERBOSE#)#;#try#{#value#=#Integer#.#parseInt#(#line#)#;#myProj#.#setProperty#(#property#,#""#+#value#)#;#}#catch#(#NumberFormatException#nfe#)#{#throw#new#BuildException#(#"Perforce error. "#+#"Could not retrieve counter value."#)#;#}#}#}#;#execP4Command#(#command#,#handler#)#;#}#else#{#execP4Command#(#command#,#new#SimpleP4OutputHandler#(#this#)#)#;#}#}##void#process#(#String#line#)#{#log#(#"P4Counter retrieved line \""#+#line#+#"\""#,#Project#.#MSG_VERBOSE#)#;#try#{#value#=#Integer#.#parseInt#(#line#)#;#myProj#.#setProperty#(#property#,#""#+#value#)#;#}#catch#(#NumberFormatException#nfe#)#{#throw#new#BuildException#(#"Perforce error. "#+#"Could not retrieve counter value."#)#;#}#}##