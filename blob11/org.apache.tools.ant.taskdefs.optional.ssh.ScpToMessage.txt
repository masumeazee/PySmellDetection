void#execute#(#)#throws#IOException#,#JSchException#{#if#(#directoryList#!=#null#)#{#doMultipleTransfer#(#)#;#}#if#(#localFile#!=#null#)#{#doSingleTransfer#(#)#;#}#log#(#"done.\n"#)#;#}##void#doSingleTransfer#(#)#throws#IOException#,#JSchException#{#String#cmd#=#"scp -t "#+#remotePath#;#Channel#channel#=#openExecChannel#(#cmd#)#;#try#{#OutputStream#out#=#channel#.#getOutputStream#(#)#;#InputStream#in#=#channel#.#getInputStream#(#)#;#channel#.#connect#(#)#;#waitForAck#(#in#)#;#sendFileToRemote#(#localFile#,#in#,#out#)#;#}#finally#{#if#(#channel#!=#null#)#{#channel#.#disconnect#(#)#;#}#}#}##void#doMultipleTransfer#(#)#throws#IOException#,#JSchException#{#Channel#channel#=#openExecChannel#(#"scp -r -d -t "#+#remotePath#)#;#try#{#OutputStream#out#=#channel#.#getOutputStream#(#)#;#InputStream#in#=#channel#.#getInputStream#(#)#;#channel#.#connect#(#)#;#waitForAck#(#in#)#;#for#(#Iterator#i#=#directoryList#.#iterator#(#)#;#i#.#hasNext#(#)#;#)#{#Directory#current#=#(#Directory#)#i#.#next#(#)#;#sendDirectory#(#current#,#in#,#out#)#;#}#}#finally#{#if#(#channel#!=#null#)#{#channel#.#disconnect#(#)#;#}#}#}##void#sendDirectory#(#Directory#current#,#InputStream#in#,#OutputStream#out#)#throws#IOException#{#for#(#Iterator#fileIt#=#current#.#filesIterator#(#)#;#fileIt#.#hasNext#(#)#;#)#{#sendFileToRemote#(#(#File#)#fileIt#.#next#(#)#,#in#,#out#)#;#}#for#(#Iterator#dirIt#=#current#.#directoryIterator#(#)#;#dirIt#.#hasNext#(#)#;#)#{#Directory#dir#=#(#Directory#)#dirIt#.#next#(#)#;#sendDirectoryToRemote#(#dir#,#in#,#out#)#;#}#}##void#sendDirectoryToRemote#(#Directory#directory#,#InputStream#in#,#OutputStream#out#)#throws#IOException#{#String#command#=#"D0755 0 "#;#command#+=#directory#.#getDirectory#(#)#.#getName#(#)#;#command#+=#"\n"#;#out#.#write#(#command#.#getBytes#(#)#)#;#out#.#flush#(#)#;#waitForAck#(#in#)#;#sendDirectory#(#directory#,#in#,#out#)#;#out#.#write#(#"E\n"#.#getBytes#(#)#)#;#out#.#flush#(#)#;#waitForAck#(#in#)#;#}##void#sendFileToRemote#(#File#localFile#,#InputStream#in#,#OutputStream#out#)#throws#IOException#{#// send "C0644 filesize filename", where filename should not include '/'#long#filesize#=#localFile#.#length#(#)#;#String#command#=#"C0644 "#+#filesize#+#" "#;#command#+=#localFile#.#getName#(#)#;#command#+=#"\n"#;#out#.#write#(#command#.#getBytes#(#)#)#;#out#.#flush#(#)#;#waitForAck#(#in#)#;#// send a content of lfile#FileInputStream#fis#=#new#FileInputStream#(#localFile#)#;#byte#[#]#buf#=#new#byte#[#BUFFER_SIZE#]#;#long#startTime#=#System#.#currentTimeMillis#(#)#;#long#totalLength#=#0#;#// only track progress for files larger than 100kb in verbose mode#boolean#trackProgress#=#getVerbose#(#)#&&#filesize#>#HUNDRED_KILOBYTES#;#// since filesize keeps on decreasing we have to store the#// initial filesize#long#initFilesize#=#filesize#;#int#percentTransmitted#=#0#;#try#{#if#(#this#.#getVerbose#(#)#)#{#log#(#"Sending: "#+#localFile#.#getName#(#)#+#" : "#+#localFile#.#length#(#)#)#;#}#while#(#true#)#{#int#len#=#fis#.#read#(#buf#,#0#,#buf#.#length#)#;#if#(#len#<=#0#)#{#break#;#}#out#.#write#(#buf#,#0#,#len#)#;#totalLength#+=#len#;#if#(#trackProgress#)#{#percentTransmitted#=#trackProgress#(#initFilesize#,#totalLength#,#percentTransmitted#)#;#}#}#out#.#flush#(#)#;#sendAck#(#out#)#;#waitForAck#(#in#)#;#}#finally#{#if#(#this#.#getVerbose#(#)#)#{#long#endTime#=#System#.#currentTimeMillis#(#)#;#logStats#(#startTime#,#endTime#,#totalLength#)#;#}#fis#.#close#(#)#;#}#}##File#getLocalFile#(#)#{#return#localFile#;#}##String#getRemotePath#(#)#{#return#remotePath#;#}##