void#setName#(#String#name#)#{#assertValid#(#"name"#,#name#)#;#this#.#name#=#name#;#}##void#setRegex#(#String#regex#)#{#assertValid#(#"regex"#,#regex#)#;#this#.#regex#=#regex#;#}##void#setPrefix#(#String#prefix#)#{#assertValid#(#"prefix"#,#prefix#)#;#this#.#prefix#=#prefix#;#}##void#setBuiltin#(#BuiltinPropertySetName#b#)#{#String#pBuiltIn#=#b#.#getValue#(#)#;#assertValid#(#"builtin"#,#pBuiltIn#)#;#this#.#builtin#=#pBuiltIn#;#}##void#assertValid#(#String#attr#,#String#value#)#{#if#(#value#==#null#||#value#.#length#(#)#<#1#)#{#throw#new#BuildException#(#"Invalid attribute: "#+#attr#)#;#}#if#(#++#count#!=#1#)#{#throw#new#BuildException#(#"Attributes name, regex, and "#+#"prefix are mutually exclusive"#)#;#}#}##String#toString#(#)#{#return#"name="#+#name#+#", regex="#+#regex#+#", prefix="#+#prefix#+#", builtin="#+#builtin#;#}##void#appendName#(#String#name#)#{#PropertyRef#r#=#new#PropertyRef#(#)#;#r#.#setName#(#name#)#;#addPropertyref#(#r#)#;#}##void#appendRegex#(#String#regex#)#{#PropertyRef#r#=#new#PropertyRef#(#)#;#r#.#setRegex#(#regex#)#;#addPropertyref#(#r#)#;#}##void#appendPrefix#(#String#prefix#)#{#PropertyRef#r#=#new#PropertyRef#(#)#;#r#.#setPrefix#(#prefix#)#;#addPropertyref#(#r#)#;#}##void#appendBuiltin#(#BuiltinPropertySetName#b#)#{#PropertyRef#r#=#new#PropertyRef#(#)#;#r#.#setBuiltin#(#b#)#;#addPropertyref#(#r#)#;#}##void#setMapper#(#String#type#,#String#from#,#String#to#)#{#Mapper#m#=#createMapper#(#)#;#Mapper#.#MapperType#mapperType#=#new#Mapper#.#MapperType#(#)#;#mapperType#.#setValue#(#type#)#;#m#.#setType#(#mapperType#)#;#m#.#setFrom#(#from#)#;#m#.#setTo#(#to#)#;#}##void#addPropertyref#(#PropertyRef#ref#)#{#assertNotReference#(#)#;#setChecked#(#false#)#;#ptyRefs#.#addElement#(#ref#)#;#}##void#addPropertyset#(#PropertySet#ref#)#{#assertNotReference#(#)#;#setChecked#(#false#)#;#setRefs#.#addElement#(#ref#)#;#}##Mapper#createMapper#(#)#{#assertNotReference#(#)#;#if#(#mapper#!=#null#)#{#throw#new#BuildException#(#"Too many <mapper>s!"#)#;#}#mapper#=#new#Mapper#(#getProject#(#)#)#;#setChecked#(#false#)#;#return#mapper#;#}##void#add#(#FileNameMapper#fileNameMapper#)#{#createMapper#(#)#.#add#(#fileNameMapper#)#;#}##void#setDynamic#(#boolean#dynamic#)#{#assertNotReference#(#)#;#this#.#dynamic#=#dynamic#;#}##void#setNegate#(#boolean#negate#)#{#assertNotReference#(#)#;#this#.#negate#=#negate#;#}##boolean#getDynamic#(#)#{#if#(#isReference#(#)#)#{#return#getRef#(#)#.#dynamic#;#}#dieOnCircularReference#(#)#;#return#dynamic#;#}##Mapper#getMapper#(#)#{#if#(#isReference#(#)#)#{#return#getRef#(#)#.#mapper#;#}#dieOnCircularReference#(#)#;#return#mapper#;#}##Hashtable#getAllSystemProperties#(#)#{#Hashtable#ret#=#new#Hashtable#(#)#;#for#(#Enumeration#e#=#System#.#getProperties#(#)#.#propertyNames#(#)#;#e#.#hasMoreElements#(#)#;#)#{#String#name#=#(#String#)#e#.#nextElement#(#)#;#ret#.#put#(#name#,#System#.#getProperties#(#)#.#getProperty#(#name#)#)#;#}#return#ret#;#}##Properties#getProperties#(#)#{#if#(#isReference#(#)#)#{#return#getRef#(#)#.#getProperties#(#)#;#}#dieOnCircularReference#(#)#;#Set#names#=#null#;#Project#prj#=#getProject#(#)#;#Hashtable#props#=#prj#==#null#?#getAllSystemProperties#(#)#:#prj#.#getProperties#(#)#;#//quick & dirty, to make nested mapped p-sets work:#for#(#Enumeration#e#=#setRefs#.#elements#(#)#;#e#.#hasMoreElements#(#)#;#)#{#PropertySet#set#=#(#PropertySet#)#e#.#nextElement#(#)#;#props#.#putAll#(#set#.#getProperties#(#)#)#;#}#if#(#getDynamic#(#)#||#cachedNames#==#null#)#{#names#=#new#HashSet#(#)#;#addPropertyNames#(#names#,#props#)#;#// Add this PropertySet's nested PropertySets' property names.#for#(#Enumeration#e#=#setRefs#.#elements#(#)#;#e#.#hasMoreElements#(#)#;#)#{#PropertySet#set#=#(#PropertySet#)#e#.#nextElement#(#)#;#names#.#addAll#(#set#.#getProperties#(#)#.#keySet#(#)#)#;#}#if#(#negate#)#{#//make a copy...#HashSet#complement#=#new#HashSet#(#props#.#keySet#(#)#)#;#complement#.#removeAll#(#names#)#;#names#=#complement#;#}#if#(#!#getDynamic#(#)#)#{#cachedNames#=#names#;#}#}#else#{#names#=#cachedNames#;#}#FileNameMapper#m#=#null#;#Mapper#myMapper#=#getMapper#(#)#;#if#(#myMapper#!=#null#)#{#m#=#myMapper#.#getImplementation#(#)#;#}#Properties#properties#=#new#Properties#(#)#;#//iterate through the names, get the matching values#for#(#Iterator#iter#=#names#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#String#name#=#(#String#)#iter#.#next#(#)#;#String#value#=#(#String#)#props#.#get#(#name#)#;#if#(#value#!=#null#)#{#// may be null if a system property has been added#// after the project instance has been initialized#if#(#m#!=#null#)#{#//map the names#String#[#]#newname#=#m#.#mapFileName#(#name#)#;#if#(#newname#!=#null#)#{#name#=#newname#[#0#]#;#}#}#properties#.#setProperty#(#name#,#value#)#;#}#}#return#properties#;#}##void#addPropertyNames#(#Set#names#,#Hashtable#properties#)#{#if#(#isReference#(#)#)#{#getRef#(#)#.#addPropertyNames#(#names#,#properties#)#;#}#dieOnCircularReference#(#)#;#// Add this PropertySet's property names.#for#(#Enumeration#e#=#ptyRefs#.#elements#(#)#;#e#.#hasMoreElements#(#)#;#)#{#PropertyRef#r#=#(#PropertyRef#)#e#.#nextElement#(#)#;#if#(#r#.#name#!=#null#)#{#if#(#properties#.#get#(#r#.#name#)#!=#null#)#{#names#.#add#(#r#.#name#)#;#}#}#else#if#(#r#.#prefix#!=#null#)#{#for#(#Enumeration#p#=#properties#.#keys#(#)#;#p#.#hasMoreElements#(#)#;#)#{#String#name#=#(#String#)#p#.#nextElement#(#)#;#if#(#name#.#startsWith#(#r#.#prefix#)#)#{#names#.#add#(#name#)#;#}#}#}#else#if#(#r#.#regex#!=#null#)#{#RegexpMatcherFactory#matchMaker#=#new#RegexpMatcherFactory#(#)#;#RegexpMatcher#matcher#=#matchMaker#.#newRegexpMatcher#(#)#;#matcher#.#setPattern#(#r#.#regex#)#;#for#(#Enumeration#p#=#properties#.#keys#(#)#;#p#.#hasMoreElements#(#)#;#)#{#String#name#=#(#String#)#p#.#nextElement#(#)#;#if#(#matcher#.#matches#(#name#)#)#{#names#.#add#(#name#)#;#}#}#}#else#if#(#r#.#builtin#!=#null#)#{#if#(#r#.#builtin#.#equals#(#BuiltinPropertySetName#.#ALL#)#)#{#names#.#addAll#(#properties#.#keySet#(#)#)#;#}#else#if#(#r#.#builtin#.#equals#(#BuiltinPropertySetName#.#SYSTEM#)#)#{#names#.#addAll#(#System#.#getProperties#(#)#.#keySet#(#)#)#;#}#else#if#(#r#.#builtin#.#equals#(#BuiltinPropertySetName#.#COMMANDLINE#)#)#{#names#.#addAll#(#getProject#(#)#.#getUserProperties#(#)#.#keySet#(#)#)#;#}#else#{#throw#new#BuildException#(#"Impossible: Invalid builtin "#+#"attribute!"#)#;#}#}#else#{#throw#new#BuildException#(#"Impossible: Invalid PropertyRef!"#)#;#}#}#}##PropertySet#getRef#(#)#{#return#(#PropertySet#)#getCheckedRef#(#PropertySet#.#class#,#"propertyset"#)#;#}##void#setRefid#(#Reference#r#)#{#if#(#!#noAttributeSet#)#{#throw#tooManyAttributes#(#)#;#}#super#.#setRefid#(#r#)#;#}##void#assertNotReference#(#)#{#if#(#isReference#(#)#)#{#throw#tooManyAttributes#(#)#;#}#noAttributeSet#=#false#;#}##String#[#]#getValues#(#)#{#return#new#String#[#]#{#ALL#,#SYSTEM#,#COMMANDLINE#}#;#}##String#toString#(#)#{#if#(#isReference#(#)#)#{#return#getRef#(#)#.#toString#(#)#;#}#dieOnCircularReference#(#)#;#StringBuffer#b#=#new#StringBuffer#(#)#;#TreeMap#sorted#=#new#TreeMap#(#getProperties#(#)#)#;#for#(#Iterator#i#=#sorted#.#entrySet#(#)#.#iterator#(#)#;#i#.#hasNext#(#)#;#)#{#Map#.#Entry#e#=#(#Map#.#Entry#)#i#.#next#(#)#;#if#(#b#.#length#(#)#!=#0#)#{#b#.#append#(#", "#)#;#}#b#.#append#(#e#.#getKey#(#)#.#toString#(#)#)#;#b#.#append#(#"="#)#;#b#.#append#(#e#.#getValue#(#)#.#toString#(#)#)#;#}#return#b#.#toString#(#)#;#}##Iterator#iterator#(#)#{#if#(#isReference#(#)#)#{#return#getRef#(#)#.#iterator#(#)#;#}#dieOnCircularReference#(#)#;#final#Enumeration#e#=#getProperties#(#)#.#propertyNames#(#)#;#return#new#Iterator#(#)#{#public#boolean#hasNext#(#)#{#return#e#.#hasMoreElements#(#)#;#}#public#Object#next#(#)#{#return#new#PropertyResource#(#getProject#(#)#,#(#String#)#e#.#nextElement#(#)#)#;#}#public#void#remove#(#)#{#throw#new#UnsupportedOperationException#(#)#;#}#}#;#}##boolean#hasNext#(#)#{#return#e#.#hasMoreElements#(#)#;#}##Object#next#(#)#{#return#new#PropertyResource#(#getProject#(#)#,#(#String#)#e#.#nextElement#(#)#)#;#}##void#remove#(#)#{#throw#new#UnsupportedOperationException#(#)#;#}##int#size#(#)#{#return#isReference#(#)#?#getRef#(#)#.#size#(#)#:#getProperties#(#)#.#size#(#)#;#}##boolean#isFilesystemOnly#(#)#{#if#(#isReference#(#)#)#{#return#getRef#(#)#.#isFilesystemOnly#(#)#;#}#dieOnCircularReference#(#)#;#return#false#;#}##void#dieOnCircularReference#(#Stack#stk#,#Project#p#)#throws#BuildException#{#if#(#isChecked#(#)#)#{#return#;#}#if#(#isReference#(#)#)#{#super#.#dieOnCircularReference#(#stk#,#p#)#;#}#else#{#if#(#mapper#!=#null#)#{#pushAndInvokeCircularReferenceCheck#(#mapper#,#stk#,#p#)#;#}#for#(#Iterator#i#=#setRefs#.#iterator#(#)#;#i#.#hasNext#(#)#;#)#{#pushAndInvokeCircularReferenceCheck#(#(#PropertySet#)#i#.#next#(#)#,#stk#,#p#)#;#}#setChecked#(#true#)#;#}#}##