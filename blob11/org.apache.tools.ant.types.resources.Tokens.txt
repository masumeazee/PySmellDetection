Collection#getCollection#(#)#{#ResourceCollection#rc#=#getResourceCollection#(#)#;#if#(#rc#.#size#(#)#==#0#)#{#return#Collections#.#EMPTY_SET#;#}#if#(#tokenizer#==#null#)#{#tokenizer#=#new#LineTokenizer#(#)#;#}#ConcatResourceInputStream#cat#=#new#ConcatResourceInputStream#(#rc#)#;#cat#.#setManagingComponent#(#this#)#;#InputStreamReader#rdr#=#null#;#if#(#encoding#==#null#)#{#rdr#=#new#InputStreamReader#(#cat#)#;#}#else#{#try#{#rdr#=#new#InputStreamReader#(#cat#,#encoding#)#;#}#catch#(#UnsupportedEncodingException#e#)#{#throw#new#BuildException#(#e#)#;#}#}#ArrayList#result#=#new#ArrayList#(#)#;#try#{#for#(#String#s#=#tokenizer#.#getToken#(#rdr#)#;#s#!=#null#;#s#=#tokenizer#.#getToken#(#rdr#)#)#{#StringResource#resource#=#new#StringResource#(#s#)#;#resource#.#setProject#(#getProject#(#)#)#;#result#.#add#(#resource#)#;#}#}#catch#(#IOException#e#)#{#throw#new#BuildException#(#"Error reading tokens"#,#e#)#;#}#return#result#;#}##void#setEncoding#(#String#encoding#)#{#this#.#encoding#=#encoding#;#}##void#add#(#Tokenizer#tokenizer#)#{#if#(#isReference#(#)#)#{#throw#noChildrenAllowed#(#)#;#}#if#(#this#.#tokenizer#!=#null#)#{#throw#new#BuildException#(#"Only one nested tokenizer allowed."#)#;#}#this#.#tokenizer#=#tokenizer#;#setChecked#(#false#)#;#}##void#dieOnCircularReference#(#Stack#stk#,#Project#p#)#throws#BuildException#{#if#(#isChecked#(#)#)#{#return#;#}#// check nested collection#super#.#dieOnCircularReference#(#stk#,#p#)#;#if#(#!#isReference#(#)#)#{#if#(#tokenizer#instanceof#DataType#)#{#pushAndInvokeCircularReferenceCheck#(#(#DataType#)#tokenizer#,#stk#,#p#)#;#}#setChecked#(#true#)#;#}#}##