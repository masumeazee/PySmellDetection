void#setClassname#(#String#classname#)#{#this#.#classname#=#classname#;#}##void#selectorCreate#(#)#{#if#(#classname#!=#null#&&#classname#.#length#(#)#>#0#)#{#try#{#Class#c#=#null#;#if#(#classpath#==#null#)#{#c#=#Class#.#forName#(#classname#)#;#}#else#{#// Memory-Leak in line below#AntClassLoader#al#=#getProject#(#)#.#createClassLoader#(#classpath#)#;#c#=#Class#.#forName#(#classname#,#true#,#al#)#;#}#dynselector#=#(#FileSelector#)#c#.#newInstance#(#)#;#final#Project#p#=#getProject#(#)#;#if#(#p#!=#null#)#{#p#.#setProjectReference#(#dynselector#)#;#}#}#catch#(#ClassNotFoundException#cnfexcept#)#{#setError#(#"Selector "#+#classname#+#" not initialized, no such class"#)#;#}#catch#(#InstantiationException#iexcept#)#{#setError#(#"Selector "#+#classname#+#" not initialized, could not create class"#)#;#}#catch#(#IllegalAccessException#iaexcept#)#{#setError#(#"Selector "#+#classname#+#" not initialized, class not accessible"#)#;#}#}#else#{#setError#(#"There is no classname specified"#)#;#}#}##void#addParam#(#Parameter#p#)#{#paramVec#.#addElement#(#p#)#;#}##void#setClasspath#(#Path#classpath#)#{#if#(#isReference#(#)#)#{#throw#tooManyAttributes#(#)#;#}#if#(#this#.#classpath#==#null#)#{#this#.#classpath#=#classpath#;#}#else#{#this#.#classpath#.#append#(#classpath#)#;#}#}##Path#createClasspath#(#)#{#if#(#isReference#(#)#)#{#throw#noChildrenAllowed#(#)#;#}#if#(#this#.#classpath#==#null#)#{#this#.#classpath#=#new#Path#(#getProject#(#)#)#;#}#return#this#.#classpath#.#createPath#(#)#;#}##Path#getClasspath#(#)#{#return#classpath#;#}##void#setClasspathref#(#Reference#r#)#{#if#(#isReference#(#)#)#{#throw#tooManyAttributes#(#)#;#}#createClasspath#(#)#.#setRefid#(#r#)#;#}##void#verifySettings#(#)#{#// Creation is done here rather than in isSelected() because some#// containers may do a validation pass before running isSelected(),#// but we need to check for the existence of the created class.#if#(#dynselector#==#null#)#{#selectorCreate#(#)#;#}#if#(#classname#==#null#||#classname#.#length#(#)#<#1#)#{#setError#(#"The classname attribute is required"#)#;#}#else#if#(#dynselector#==#null#)#{#setError#(#"Internal Error: The custom selector was not created"#)#;#}#else#if#(#!#(#dynselector#instanceof#ExtendFileSelector#)#&&#(#paramVec#.#size#(#)#>#0#)#)#{#setError#(#"Cannot set parameters on custom selector that does not "#+#"implement ExtendFileSelector"#)#;#}#}##boolean#isSelected#(#File#basedir#,#String#filename#,#File#file#)#throws#BuildException#{#validate#(#)#;#if#(#paramVec#.#size#(#)#>#0#&&#dynselector#instanceof#ExtendFileSelector#)#{#Parameter#[#]#paramArray#=#new#Parameter#[#paramVec#.#size#(#)#]#;#paramVec#.#copyInto#(#paramArray#)#;#// We know that dynselector must be non-null if no error message#(#(#ExtendFileSelector#)#dynselector#)#.#setParameters#(#paramArray#)#;#}#return#dynselector#.#isSelected#(#basedir#,#filename#,#file#)#;#}##