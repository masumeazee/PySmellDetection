ClassLoader#getClassLoaderForPath#(#Project#p#,#Reference#ref#)#{#return#getClassLoaderForPath#(#p#,#ref#,#false#)#;#}##ClassLoader#getClassLoaderForPath#(#Project#p#,#Reference#ref#,#boolean#reverseLoader#)#{#String#pathId#=#ref#.#getRefId#(#)#;#Object#path#=#p#.#getReference#(#pathId#)#;#if#(#!#(#path#instanceof#Path#)#)#{#throw#new#BuildException#(#"The specified classpathref "#+#pathId#+#" does not reference a Path."#)#;#}#String#loaderId#=#MagicNames#.#REFID_CLASSPATH_LOADER_PREFIX#+#pathId#;#return#getClassLoaderForPath#(#p#,#(#Path#)#path#,#loaderId#,#reverseLoader#)#;#}##ClassLoader#getClassLoaderForPath#(#Project#p#,#Path#path#,#String#loaderId#)#{#return#getClassLoaderForPath#(#p#,#path#,#loaderId#,#false#)#;#}##ClassLoader#getClassLoaderForPath#(#Project#p#,#Path#path#,#String#loaderId#,#boolean#reverseLoader#)#{#return#getClassLoaderForPath#(#p#,#path#,#loaderId#,#reverseLoader#,#isMagicPropertySet#(#p#)#)#;#}##ClassLoader#getClassLoaderForPath#(#Project#p#,#Path#path#,#String#loaderId#,#boolean#reverseLoader#,#boolean#reuseLoader#)#{#ClassLoader#cl#=#null#;#// magic property#if#(#loaderId#!=#null#&&#reuseLoader#)#{#Object#reusedLoader#=#p#.#getReference#(#loaderId#)#;#if#(#reusedLoader#!=#null#&&#!#(#reusedLoader#instanceof#ClassLoader#)#)#{#throw#new#BuildException#(#"The specified loader id "#+#loaderId#+#" does not reference a class loader"#)#;#}#cl#=#(#ClassLoader#)#reusedLoader#;#}#if#(#cl#==#null#)#{#cl#=#getUniqueClassLoaderForPath#(#p#,#path#,#reverseLoader#)#;#if#(#loaderId#!=#null#&&#reuseLoader#)#{#p#.#addReference#(#loaderId#,#cl#)#;#}#}#return#cl#;#}##ClassLoader#getUniqueClassLoaderForPath#(#Project#p#,#Path#path#,#boolean#reverseLoader#)#{#AntClassLoader#acl#=#p#.#createClassLoader#(#path#)#;#if#(#reverseLoader#)#{#acl#.#setParentFirst#(#false#)#;#acl#.#addJavaLibraries#(#)#;#}#return#acl#;#}##Object#newInstance#(#String#className#,#ClassLoader#userDefinedLoader#)#{#return#newInstance#(#className#,#userDefinedLoader#,#Object#.#class#)#;#}##Object#newInstance#(#String#className#,#ClassLoader#userDefinedLoader#,#Class#expectedType#)#{#try#{#Class#clazz#=#Class#.#forName#(#className#,#true#,#userDefinedLoader#)#;#Object#o#=#clazz#.#newInstance#(#)#;#if#(#!#expectedType#.#isInstance#(#o#)#)#{#throw#new#BuildException#(#"Class of unexpected Type: "#+#className#+#" expected :"#+#expectedType#)#;#}#return#o#;#}#catch#(#ClassNotFoundException#e#)#{#throw#new#BuildException#(#"Class not found: "#+#className#,#e#)#;#}#catch#(#InstantiationException#e#)#{#throw#new#BuildException#(#"Could not instantiate "#+#className#+#". Specified class should have a no "#+#"argument constructor."#,#e#)#;#}#catch#(#IllegalAccessException#e#)#{#throw#new#BuildException#(#"Could not instantiate "#+#className#+#". Specified class should have a "#+#"public constructor."#,#e#)#;#}#catch#(#LinkageError#e#)#{#throw#new#BuildException#(#"Class "#+#className#+#" could not be loaded because of an invalid dependency."#,#e#)#;#}#}##Delegate#getDelegate#(#ProjectComponent#component#)#{#return#new#Delegate#(#component#)#;#}##boolean#isMagicPropertySet#(#Project#p#)#{#return#p#.#getProperty#(#REUSE_LOADER_REF#)#!=#null#;#}##void#setClasspath#(#Path#classpath#)#{#if#(#this#.#classpath#==#null#)#{#this#.#classpath#=#classpath#;#}#else#{#this#.#classpath#.#append#(#classpath#)#;#}#}##Path#createClasspath#(#)#{#if#(#this#.#classpath#==#null#)#{#this#.#classpath#=#new#Path#(#component#.#getProject#(#)#)#;#}#return#this#.#classpath#.#createPath#(#)#;#}##void#setClassname#(#String#fcqn#)#{#this#.#className#=#fcqn#;#}##void#setClasspathref#(#Reference#r#)#{#this#.#classpathId#=#r#.#getRefId#(#)#;#createClasspath#(#)#.#setRefid#(#r#)#;#}##void#setReverseLoader#(#boolean#reverseLoader#)#{#this#.#reverseLoader#=#reverseLoader#;#}##void#setLoaderRef#(#Reference#r#)#{#this#.#loaderId#=#r#.#getRefId#(#)#;#}##ClassLoader#getClassLoader#(#)#{#return#getClassLoaderForPath#(#getContextProject#(#)#,#classpath#,#getClassLoadId#(#)#,#reverseLoader#,#loaderId#!=#null#||#isMagicPropertySet#(#getContextProject#(#)#)#)#;#}##Project#getContextProject#(#)#{#return#component#.#getProject#(#)#;#}##String#getClassLoadId#(#)#{#if#(#loaderId#==#null#&&#classpathId#!=#null#)#{#return#MagicNames#.#REFID_CLASSPATH_LOADER_PREFIX#+#classpathId#;#}#else#{#return#loaderId#;#}#}##Object#newInstance#(#)#{#return#ClasspathUtils#.#newInstance#(#this#.#className#,#getClassLoader#(#)#)#;#}##Path#getClasspath#(#)#{#return#classpath#;#}##boolean#isReverseLoader#(#)#{#return#reverseLoader#;#}##