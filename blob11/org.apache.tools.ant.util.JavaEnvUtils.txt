String#getJavaVersion#(#)#{#return#javaVersion#;#}##int#getJavaVersionNumber#(#)#{#return#javaVersionNumber#;#}##boolean#isJavaVersion#(#String#version#)#{#return#javaVersion#.#equals#(#version#)#;#}##boolean#isAtLeastJavaVersion#(#String#version#)#{#return#javaVersion#.#compareTo#(#version#)#>=#0#;#}##boolean#isKaffe#(#)#{#return#kaffeDetected#;#}##String#getJreExecutable#(#String#command#)#{#if#(#IS_NETWARE#)#{#// Extrapolating from:#// "NetWare may have a "java" in that directory, but 99% of#// the time, you don't want to execute it" -- Jeff Tulley#// <JTULLEY@novell.com>#return#command#;#}#File#jExecutable#=#null#;#if#(#IS_AIX#)#{#// On IBM's JDK 1.2 the directory layout is different, 1.3 follows#// Sun's layout.#jExecutable#=#findInDir#(#JAVA_HOME#+#"/sh"#,#command#)#;#}#if#(#jExecutable#==#null#)#{#jExecutable#=#findInDir#(#JAVA_HOME#+#"/bin"#,#command#)#;#}#if#(#jExecutable#!=#null#)#{#return#jExecutable#.#getAbsolutePath#(#)#;#}#else#{#// Unfortunately on Windows java.home doesn't always refer#// to the correct location, so we need to fall back to#// assuming java is somewhere on the PATH.#return#addExtension#(#command#)#;#}#}##String#getJdkExecutable#(#String#command#)#{#if#(#IS_NETWARE#)#{#// Extrapolating from:#// "NetWare may have a "java" in that directory, but 99% of#// the time, you don't want to execute it" -- Jeff Tulley#// <JTULLEY@novell.com>#return#command#;#}#File#jExecutable#=#null#;#if#(#IS_AIX#)#{#// On IBM's JDK 1.2 the directory layout is different, 1.3 follows#// Sun's layout.#jExecutable#=#findInDir#(#JAVA_HOME#+#"/../sh"#,#command#)#;#}#if#(#jExecutable#==#null#)#{#jExecutable#=#findInDir#(#JAVA_HOME#+#"/../bin"#,#command#)#;#}#if#(#jExecutable#!=#null#)#{#return#jExecutable#.#getAbsolutePath#(#)#;#}#else#{#// fall back to JRE bin directory, also catches JDK 1.0 and 1.1#// where java.home points to the root of the JDK and Mac OS X where#// the whole directory layout is different from Sun's#return#getJreExecutable#(#command#)#;#}#}##String#addExtension#(#String#command#)#{#// This is the most common extension case - exe for windows and OS/2,#// nothing for *nix.#return#command#+#(#IS_DOS#?#".exe"#:#""#)#;#}##File#findInDir#(#String#dirName#,#String#commandName#)#{#File#dir#=#FILE_UTILS#.#normalize#(#dirName#)#;#File#executable#=#null#;#if#(#dir#.#exists#(#)#)#{#executable#=#new#File#(#dir#,#addExtension#(#commandName#)#)#;#if#(#!#executable#.#exists#(#)#)#{#executable#=#null#;#}#}#return#executable#;#}##void#buildJrePackages#(#)#{#jrePackages#=#new#Vector#(#)#;#switch#(#javaVersionNumber#)#{#case#VERSION_1_6#:#case#VERSION_1_5#:#//In Java1.5, the apache stuff moved.#jrePackages#.#addElement#(#"com.sun.org.apache"#)#;#//fall through.#case#VERSION_1_4#:#if#(#javaVersionNumber#==#VERSION_1_4#)#{#jrePackages#.#addElement#(#"org.apache.crimson"#)#;#jrePackages#.#addElement#(#"org.apache.xalan"#)#;#jrePackages#.#addElement#(#"org.apache.xml"#)#;#jrePackages#.#addElement#(#"org.apache.xpath"#)#;#}#jrePackages#.#addElement#(#"org.ietf.jgss"#)#;#jrePackages#.#addElement#(#"org.w3c.dom"#)#;#jrePackages#.#addElement#(#"org.xml.sax"#)#;#// fall through#case#VERSION_1_3#:#jrePackages#.#addElement#(#"org.omg"#)#;#jrePackages#.#addElement#(#"com.sun.corba"#)#;#jrePackages#.#addElement#(#"com.sun.jndi"#)#;#jrePackages#.#addElement#(#"com.sun.media"#)#;#jrePackages#.#addElement#(#"com.sun.naming"#)#;#jrePackages#.#addElement#(#"com.sun.org.omg"#)#;#jrePackages#.#addElement#(#"com.sun.rmi"#)#;#jrePackages#.#addElement#(#"sunw.io"#)#;#jrePackages#.#addElement#(#"sunw.util"#)#;#// fall through#case#VERSION_1_2#:#jrePackages#.#addElement#(#"com.sun.java"#)#;#jrePackages#.#addElement#(#"com.sun.image"#)#;#// are there any here that we forgot?#// fall through#case#VERSION_1_1#:#default#:#//things like sun.reflection, sun.misc, sun.net#jrePackages#.#addElement#(#"sun"#)#;#jrePackages#.#addElement#(#"java"#)#;#jrePackages#.#addElement#(#"javax"#)#;#break#;#}#}##Vector#getJrePackageTestCases#(#)#{#Vector#tests#=#new#Vector#(#)#;#tests#.#addElement#(#"java.lang.Object"#)#;#switch#(#javaVersionNumber#)#{#case#VERSION_1_6#:#case#VERSION_1_5#:#tests#.#addElement#(#"com.sun.org.apache.xerces.internal.jaxp.datatype.DatatypeFactoryImpl "#)#;#// Fall tru#case#VERSION_1_4#:#tests#.#addElement#(#"sun.audio.AudioPlayer"#)#;#if#(#javaVersionNumber#==#VERSION_1_4#)#{#tests#.#addElement#(#"org.apache.crimson.parser.ContentModel"#)#;#tests#.#addElement#(#"org.apache.xalan.processor.ProcessorImport"#)#;#tests#.#addElement#(#"org.apache.xml.utils.URI"#)#;#tests#.#addElement#(#"org.apache.xpath.XPathFactory"#)#;#}#tests#.#addElement#(#"org.ietf.jgss.Oid"#)#;#tests#.#addElement#(#"org.w3c.dom.Attr"#)#;#tests#.#addElement#(#"org.xml.sax.XMLReader"#)#;#// fall through#case#VERSION_1_3#:#tests#.#addElement#(#"org.omg.CORBA.Any"#)#;#tests#.#addElement#(#"com.sun.corba.se.internal.corba.AnyImpl"#)#;#tests#.#addElement#(#"com.sun.jndi.ldap.LdapURL"#)#;#tests#.#addElement#(#"com.sun.media.sound.Printer"#)#;#tests#.#addElement#(#"com.sun.naming.internal.VersionHelper"#)#;#tests#.#addElement#(#"com.sun.org.omg.CORBA.Initializer"#)#;#tests#.#addElement#(#"sunw.io.Serializable"#)#;#tests#.#addElement#(#"sunw.util.EventListener"#)#;#// fall through#case#VERSION_1_2#:#tests#.#addElement#(#"javax.accessibility.Accessible"#)#;#tests#.#addElement#(#"sun.misc.BASE64Encoder"#)#;#tests#.#addElement#(#"com.sun.image.codec.jpeg.JPEGCodec"#)#;#// fall through#case#VERSION_1_1#:#default#:#//things like sun.reflection, sun.misc, sun.net#tests#.#addElement#(#"sun.reflect.SerializationConstructorAccessorImpl"#)#;#tests#.#addElement#(#"sun.net.www.http.HttpClient"#)#;#tests#.#addElement#(#"sun.audio.AudioPlayer"#)#;#break#;#}#return#tests#;#}##Vector#getJrePackages#(#)#{#if#(#jrePackages#==#null#)#{#buildJrePackages#(#)#;#}#return#jrePackages#;#}##File#createVmsJavaOptionFile#(#String#[#]#cmd#)#throws#IOException#{#File#script#=#FILE_UTILS#.#createTempFile#(#"ANT"#,#".JAVA_OPTS"#,#null#,#false#,#true#)#;#BufferedWriter#out#=#null#;#try#{#out#=#new#BufferedWriter#(#new#FileWriter#(#script#)#)#;#for#(#int#i#=#0#;#i#<#cmd#.#length#;#i#++#)#{#out#.#write#(#cmd#[#i#]#)#;#out#.#newLine#(#)#;#}#}#finally#{#FileUtils#.#close#(#out#)#;#}#return#script#;#}##String#getJavaHome#(#)#{#return#JAVA_HOME#;#}##