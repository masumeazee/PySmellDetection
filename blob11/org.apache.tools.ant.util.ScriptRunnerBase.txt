void#addBeans#(#Map#dictionary#)#{#for#(#Iterator#i#=#dictionary#.#keySet#(#)#.#iterator#(#)#;#i#.#hasNext#(#)#;#)#{#String#key#=#(#String#)#i#.#next#(#)#;#try#{#Object#val#=#dictionary#.#get#(#key#)#;#addBean#(#key#,#val#)#;#}#catch#(#BuildException#ex#)#{#// The key is in the dictionary but cannot be retrieved#// This is usually due references that refer to tasks#// that have not been taskdefed in the current run.#// Ignore#}#}#}##void#addBean#(#String#key#,#Object#bean#)#{#boolean#isValid#=#key#.#length#(#)#>#0#&&#Character#.#isJavaIdentifierStart#(#key#.#charAt#(#0#)#)#;#for#(#int#i#=#1#;#isValid#&&#i#<#key#.#length#(#)#;#i#++#)#{#isValid#=#Character#.#isJavaIdentifierPart#(#key#.#charAt#(#i#)#)#;#}#if#(#isValid#)#{#beans#.#put#(#key#,#bean#)#;#}#}##Map#getBeans#(#)#{#return#beans#;#}##void#executeScript#(#String#execName#)#;##Object#evaluateScript#(#String#execName#)#;##boolean#supportsLanguage#(#)#;##String#getManagerName#(#)#;##void#setLanguage#(#String#language#)#{#this#.#language#=#language#;#}##String#getLanguage#(#)#{#return#language#;#}##void#setScriptClassLoader#(#ClassLoader#classLoader#)#{#this#.#scriptLoader#=#classLoader#;#}##ClassLoader#getScriptClassLoader#(#)#{#return#scriptLoader#;#}##void#setKeepEngine#(#boolean#keepEngine#)#{#this#.#keepEngine#=#keepEngine#;#}##boolean#getKeepEngine#(#)#{#return#keepEngine#;#}##void#setSrc#(#File#file#)#{#String#filename#=#file#.#getPath#(#)#;#if#(#!#file#.#exists#(#)#)#{#throw#new#BuildException#(#"file "#+#filename#+#" not found."#)#;#}#try#{#readSource#(#new#FileReader#(#file#)#,#filename#)#;#}#catch#(#FileNotFoundException#e#)#{#//this can only happen if the file got deleted a short moment ago#throw#new#BuildException#(#"file "#+#filename#+#" not found."#)#;#}#}##void#readSource#(#Reader#reader#,#String#name#)#{#BufferedReader#in#=#null#;#try#{#in#=#new#BufferedReader#(#reader#)#;#script#+=#FileUtils#.#safeReadFully#(#in#)#;#}#catch#(#IOException#ex#)#{#throw#new#BuildException#(#"Failed to read "#+#name#,#ex#)#;#}#finally#{#FileUtils#.#close#(#in#)#;#}#}##void#loadResource#(#Resource#sourceResource#)#{#String#name#=#sourceResource#.#toLongString#(#)#;#InputStream#in#=#null#;#try#{#in#=#sourceResource#.#getInputStream#(#)#;#}#catch#(#IOException#e#)#{#throw#new#BuildException#(#"Failed to open "#+#name#,#e#)#;#}#catch#(#UnsupportedOperationException#e#)#{#throw#new#BuildException#(#"Failed to open "#+#name#+#" -it is not readable"#,#e#)#;#}#readSource#(#new#InputStreamReader#(#in#)#,#name#)#;#}##void#loadResources#(#ResourceCollection#collection#)#{#Iterator#resources#=#collection#.#iterator#(#)#;#while#(#resources#.#hasNext#(#)#)#{#Resource#resource#=#(#Resource#)#resources#.#next#(#)#;#loadResource#(#resource#)#;#}#}##void#addText#(#String#text#)#{#script#+=#text#;#}##String#getScript#(#)#{#return#script#;#}##void#clearScript#(#)#{#this#.#script#=#""#;#}##void#setProject#(#Project#project#)#{#this#.#project#=#project#;#}##Project#getProject#(#)#{#return#project#;#}##void#bindToComponent#(#ProjectComponent#component#)#{#project#=#component#.#getProject#(#)#;#addBeans#(#project#.#getProperties#(#)#)#;#addBeans#(#project#.#getUserProperties#(#)#)#;#addBeans#(#project#.#getTargets#(#)#)#;#addBeans#(#project#.#getReferences#(#)#)#;#addBean#(#"project"#,#project#)#;#addBean#(#"self"#,#component#)#;#}##void#bindToComponentMinimum#(#ProjectComponent#component#)#{#project#=#component#.#getProject#(#)#;#addBean#(#"project"#,#project#)#;#addBean#(#"self"#,#component#)#;#}##void#checkLanguage#(#)#{#if#(#language#==#null#)#{#throw#new#BuildException#(#"script language must be specified"#)#;#}#}##ClassLoader#replaceContextLoader#(#)#{#ClassLoader#origContextClassLoader#=#Thread#.#currentThread#(#)#.#getContextClassLoader#(#)#;#if#(#getScriptClassLoader#(#)#==#null#)#{#setScriptClassLoader#(#getClass#(#)#.#getClassLoader#(#)#)#;#}#Thread#.#currentThread#(#)#.#setContextClassLoader#(#getScriptClassLoader#(#)#)#;#return#origContextClassLoader#;#}##void#restoreContextLoader#(#ClassLoader#origLoader#)#{#Thread#.#currentThread#(#)#.#setContextClassLoader#(#origLoader#)#;#}##