String#getManagerName#(#)#{#return#"bsf"#;#}##boolean#supportsLanguage#(#)#{#Hashtable#table#=#(#Hashtable#)#ReflectUtil#.#getField#(#new#BSFManager#(#)#,#"registeredEngines"#)#;#String#engineClassName#=#(#String#)#table#.#get#(#getLanguage#(#)#)#;#if#(#engineClassName#==#null#)#{#getProject#(#)#.#log#(#"This is no BSF engine class for language '"#+#getLanguage#(#)#+#"'"#,#Project#.#MSG_VERBOSE#)#;#return#false#;#}#try#{#getScriptClassLoader#(#)#.#loadClass#(#engineClassName#)#;#return#true#;#}#catch#(#Throwable#ex#)#{#getProject#(#)#.#log#(#"unable to create BSF engine class for language '"#+#getLanguage#(#)#+#"'"#,#ex#,#Project#.#MSG_VERBOSE#)#;#return#false#;#}#}##void#executeScript#(#String#execName#)#throws#BuildException#{#checkLanguage#(#)#;#ClassLoader#origLoader#=#replaceContextLoader#(#)#;#try#{#BSFManager#m#=#createManager#(#)#;#declareBeans#(#m#)#;#// execute the script#if#(#engine#==#null#)#{#m#.#exec#(#getLanguage#(#)#,#execName#,#0#,#0#,#getScript#(#)#)#;#}#else#{#engine#.#exec#(#execName#,#0#,#0#,#getScript#(#)#)#;#}#}#catch#(#BSFException#be#)#{#throw#getBuildException#(#be#)#;#}#finally#{#restoreContextLoader#(#origLoader#)#;#}#}##Object#evaluateScript#(#String#execName#)#throws#BuildException#{#checkLanguage#(#)#;#ClassLoader#origLoader#=#replaceContextLoader#(#)#;#try#{#BSFManager#m#=#createManager#(#)#;#declareBeans#(#m#)#;#// execute the script#if#(#engine#==#null#)#{#return#m#.#eval#(#getLanguage#(#)#,#execName#,#0#,#0#,#getScript#(#)#)#;#}#return#engine#.#eval#(#execName#,#0#,#0#,#getScript#(#)#)#;#}#catch#(#BSFException#be#)#{#throw#getBuildException#(#be#)#;#}#finally#{#restoreContextLoader#(#origLoader#)#;#}#}##BuildException#getBuildException#(#BSFException#be#)#{#Throwable#t#=#be#;#Throwable#te#=#be#.#getTargetException#(#)#;#if#(#te#instanceof#BuildException#)#{#return#(#BuildException#)#te#;#}#return#new#BuildException#(#te#==#null#?#t#:#te#)#;#}##void#declareBeans#(#BSFManager#m#)#throws#BSFException#{#for#(#Iterator#i#=#getBeans#(#)#.#keySet#(#)#.#iterator#(#)#;#i#.#hasNext#(#)#;#)#{#String#key#=#(#String#)#i#.#next#(#)#;#Object#value#=#getBeans#(#)#.#get#(#key#)#;#if#(#value#!=#null#)#{#m#.#declareBean#(#key#,#value#,#value#.#getClass#(#)#)#;#}#else#{#// BSF uses a hashtable to store values#// so cannot declareBean with a null value#// So need to remove any bean of this name as#// that bean should not be visible#m#.#undeclareBean#(#key#)#;#}#}#}##BSFManager#createManager#(#)#throws#BSFException#{#if#(#manager#!=#null#)#{#return#manager#;#}#BSFManager#m#=#new#BSFManager#(#)#;#m#.#setClassLoader#(#getScriptClassLoader#(#)#)#;#if#(#getKeepEngine#(#)#)#{#BSFEngine#e#=#manager#.#loadScriptingEngine#(#getLanguage#(#)#)#;#this#.#manager#=#m#;#this#.#engine#=#e#;#}#return#m#;#}##