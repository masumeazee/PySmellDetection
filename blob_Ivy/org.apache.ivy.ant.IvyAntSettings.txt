String#getPasswd#(#)#{#return#this#.#passwd#;#}##void#setPasswd#(#String#passwd#)#{#this#.#passwd#=#passwd#;#}##String#getRealm#(#)#{#return#this#.#realm#;#}##void#setRealm#(#String#realm#)#{#this#.#realm#=#format#(#realm#)#;#}##String#getHost#(#)#{#return#this#.#host#;#}##void#setHost#(#String#host#)#{#this#.#host#=#format#(#host#)#;#}##String#getUsername#(#)#{#return#this#.#username#;#}##void#setUsername#(#String#userName#)#{#this#.#username#=#format#(#userName#)#;#}##IvyAntSettings#getDefaultInstance#(#Task#task#)#{#Project#project#=#task#.#getProject#(#)#;#Object#defaultInstanceObj#=#project#.#getReference#(#"ivy.instance"#)#;#if#(#defaultInstanceObj#!=#null#&&#defaultInstanceObj#.#getClass#(#)#.#getClassLoader#(#)#!=#IvyAntSettings#.#class#.#getClassLoader#(#)#)#{#task#.#log#(#"ivy.instance reference an ivy:settings defined in an other classloader.  "#+#"An new default one will be used in this project."#,#Project#.#MSG_WARN#)#;#defaultInstanceObj#=#null#;#}#if#(#defaultInstanceObj#!=#null#&&#!#(#defaultInstanceObj#instanceof#IvyAntSettings#)#)#{#throw#new#BuildException#(#"ivy.instance reference a "#+#defaultInstanceObj#.#getClass#(#)#.#getName#(#)#+#" an not an IvyAntSettings.  Please don't use this reference id ()"#)#;#}#if#(#defaultInstanceObj#==#null#)#{#task#.#log#(#"No ivy:settings found for the default reference 'ivy.instance'.  "#+#"A default instance will be used"#,#Project#.#MSG_VERBOSE#)#;#IvyAntSettings#settings#=#new#IvyAntSettings#(#)#;#settings#.#setProject#(#project#)#;#project#.#addReference#(#"ivy.instance"#,#settings#)#;#settings#.#createIvyEngine#(#task#)#;#return#settings#;#}#else#{#return#(#IvyAntSettings#)#defaultInstanceObj#;#}#}##File#getFile#(#)#{#return#file#;#}##URL#getUrl#(#)#{#return#url#;#}##String#getPasswd#(#)#{#return#passwd#;#}##void#setPasswd#(#String#aPasswd#)#{#passwd#=#aPasswd#;#}##String#getRealm#(#)#{#return#realm#;#}##void#setRealm#(#String#aRealm#)#{#realm#=#format#(#aRealm#)#;#}##String#getHost#(#)#{#return#host#;#}##void#setHost#(#String#aHost#)#{#host#=#format#(#aHost#)#;#}##String#getUsername#(#)#{#return#userName#;#}##void#setUsername#(#String#aUserName#)#{#userName#=#format#(#aUserName#)#;#}##void#setProject#(#Project#p#)#{#super#.#setProject#(#p#)#;#if#(#"ivy.instance"#.#equals#(#id#)#&&#!#getProject#(#)#.#getReferences#(#)#.#containsKey#(#id#)#)#{#// register ourselfs as default settings, just in case the id attribute is not set#getProject#(#)#.#addReference#(#"ivy.instance"#,#this#)#;#autoRegistered#=#true#;#}#}##String#format#(#String#str#)#{#return#str#==#null#?#str#:#(#str#.#trim#(#)#.#length#(#)#==#0#?#null#:#str#.#trim#(#)#)#;#}##void#addConfiguredCredentials#(#Credentials#c#)#{#CredentialsStore#.#INSTANCE#.#addCredentials#(#c#.#getRealm#(#)#,#c#.#getHost#(#)#,#c#.#getUsername#(#)#,#c#.#getPasswd#(#)#)#;#}##void#setFile#(#File#file#)#{#this#.#file#=#file#;#}##void#setUrl#(#String#confUrl#)#throws#MalformedURLException#{#this#.#url#=#new#URL#(#confUrl#)#;#}##void#setUrl#(#URL#url#)#{#this#.#url#=#url#;#}##void#setId#(#String#id#)#{#if#(#autoRegistered#&&#getProject#(#)#.#getReference#(#this#.#id#)#==#this#)#{#getProject#(#)#.#getReferences#(#)#.#remove#(#this#.#id#)#;#autoRegistered#=#false#;#}#this#.#id#=#id#;#if#(#getProject#(#)#!=#null#)#{#getProject#(#)#.#addReference#(#this#.#id#,#this#)#;#}#}##String#getId#(#)#{#return#id#;#}##Ivy#getConfiguredIvyInstance#(#Task#task#)#{#if#(#ivyEngine#==#null#)#{#createIvyEngine#(#task#)#;#}#return#ivyEngine#;#}##void#createIvyEngine#(#final#Task#task#)#{#Project#project#=#task#.#getProject#(#)#;#Property#prop#=#new#Property#(#)#{#public#void#execute#(#)#throws#BuildException#{#addProperties#(#getDefaultProperties#(#task#)#)#;#}#}#;#prop#.#setProject#(#project#)#;#prop#.#init#(#)#;#prop#.#execute#(#)#;#IvyAntVariableContainer#ivyAntVariableContainer#=#new#IvyAntVariableContainer#(#project#)#;#IvySettings#settings#=#new#IvySettings#(#ivyAntVariableContainer#)#;#settings#.#setBaseDir#(#project#.#getBaseDir#(#)#)#;#if#(#file#==#null#&&#url#==#null#)#{#defineDefaultSettingFile#(#ivyAntVariableContainer#,#task#)#;#}#Ivy#ivy#=#Ivy#.#newInstance#(#settings#)#;#ivy#.#getLoggerEngine#(#)#.#pushLogger#(#new#AntMessageLogger#(#task#)#)#;#Message#.#showInfo#(#)#;#try#{#configureURLHandler#(#)#;#if#(#file#!=#null#)#{#if#(#!#file#.#exists#(#)#)#{#throw#new#BuildException#(#"settings file does not exist: "#+#file#)#;#}#ivy#.#configure#(#file#)#;#}#else#{#if#(#url#==#null#)#{#throw#new#AssertionError#(#"ivy setting should have either a file, either an url,"#+#" and if not defineDefaultSettingFile must set it."#)#;#}#ivy#.#configure#(#url#)#;#}#ivyAntVariableContainer#.#updateProject#(#id#)#;#ivyEngine#=#ivy#;#}#catch#(#ParseException#e#)#{#throw#new#BuildException#(#"impossible to configure ivy:settings with given "#+#(#file#!=#null#?#"file: "#+#file#:#"url: "#+#url#)#+#" : "#+#e#,#e#)#;#}#catch#(#IOException#e#)#{#throw#new#BuildException#(#"impossible to configure ivy:settings with given "#+#(#file#!=#null#?#"file: "#+#file#:#"url: "#+#url#)#+#" : "#+#e#,#e#)#;#}#finally#{#ivy#.#getLoggerEngine#(#)#.#popLogger#(#)#;#}#}##void#execute#(#)#throws#BuildException#{#addProperties#(#getDefaultProperties#(#task#)#)#;#}##Properties#getDefaultProperties#(#Task#task#)#{#URL#url#=#IvySettings#.#getDefaultPropertiesURL#(#)#;#// this is copy of loadURL code from ant Property task (not available in 1.5.1)#Properties#props#=#new#Properties#(#)#;#task#.#log#(#"Loading "#+#url#,#Project#.#MSG_VERBOSE#)#;#try#{#InputStream#is#=#url#.#openStream#(#)#;#try#{#props#.#load#(#is#)#;#}#finally#{#if#(#is#!=#null#)#{#is#.#close#(#)#;#}#}#}#catch#(#IOException#ex#)#{#throw#new#BuildException#(#ex#)#;#}#return#props#;#}##void#defineDefaultSettingFile#(#IvyVariableContainer#variableContainer#,#Task#task#)#{#String#settingsFileName#=#variableContainer#.#getVariable#(#"ivy.conf.file"#)#;#if#(#settingsFileName#!=#null#&&#!#settingsFileName#.#equals#(#variableContainer#.#getVariable#(#"ivy.settings.file"#)#)#)#{#task#.#log#(#"DEPRECATED: 'ivy.conf.file' is deprecated, use 'ivy.settings.file' instead"#,#Project#.#MSG_INFO#)#;#}#else#{#settingsFileName#=#variableContainer#.#getVariable#(#"ivy.settings.file"#)#;#}#File#[#]#settingsLocations#=#new#File#[#]#{#new#File#(#getProject#(#)#.#getBaseDir#(#)#,#settingsFileName#)#,#new#File#(#getProject#(#)#.#getBaseDir#(#)#,#"ivyconf.xml"#)#,#new#File#(#settingsFileName#)#,#new#File#(#"ivyconf.xml"#)#}#;#for#(#int#i#=#0#;#i#<#settingsLocations#.#length#;#i#++#)#{#file#=#settingsLocations#[#i#]#;#task#.#log#(#"searching settings file: trying "#+#file#,#Project#.#MSG_VERBOSE#)#;#if#(#file#.#exists#(#)#)#{#break#;#}#}#if#(#!#file#.#exists#(#)#)#{#if#(#Boolean#.#valueOf#(#getProject#(#)#.#getProperty#(#"ivy.14.compatible"#)#)#.#booleanValue#(#)#)#{#task#.#log#(#"no settings file found, using Ivy 1.4 default..."#,#Project#.#MSG_VERBOSE#)#;#file#=#null#;#url#=#IvySettings#.#getDefault14SettingsURL#(#)#;#}#else#{#task#.#log#(#"no settings file found, using default..."#,#Project#.#MSG_VERBOSE#)#;#file#=#null#;#url#=#IvySettings#.#getDefaultSettingsURL#(#)#;#}#}#}##void#configureURLHandler#(#)#{#// TODO : the credentialStore should also be scoped#CredentialsStore#.#INSTANCE#.#addCredentials#(#getRealm#(#)#,#getHost#(#)#,#getUsername#(#)#,#getPasswd#(#)#)#;#URLHandlerDispatcher#dispatcher#=#new#URLHandlerDispatcher#(#)#;#URLHandler#httpHandler#=#URLHandlerRegistry#.#getHttp#(#)#;#dispatcher#.#setDownloader#(#"http"#,#httpHandler#)#;#dispatcher#.#setDownloader#(#"https"#,#httpHandler#)#;#URLHandlerRegistry#.#setDefault#(#dispatcher#)#;#}##