Resource#getResource#(#String#source#)#throws#IOException#{#Resource#res#=#(#Resource#)#resourcesCache#.#get#(#source#)#;#if#(#res#==#null#)#{#res#=#new#URLResource#(#new#URL#(#source#)#)#;#resourcesCache#.#put#(#source#,#res#)#;#}#return#res#;#}##void#get#(#String#source#,#File#destination#)#throws#IOException#{#fireTransferInitiated#(#getResource#(#source#)#,#TransferEvent#.#REQUEST_GET#)#;#try#{#Resource#res#=#getResource#(#source#)#;#long#totalLength#=#res#.#getContentLength#(#)#;#if#(#totalLength#>#0#)#{#progress#.#setTotalLength#(#new#Long#(#totalLength#)#)#;#}#FileUtil#.#copy#(#new#URL#(#source#)#,#destination#,#progress#)#;#}#catch#(#IOException#ex#)#{#fireTransferError#(#ex#)#;#throw#ex#;#}#catch#(#RuntimeException#ex#)#{#fireTransferError#(#ex#)#;#throw#ex#;#}#finally#{#progress#.#setTotalLength#(#null#)#;#}#}##void#put#(#File#source#,#String#destination#,#boolean#overwrite#)#throws#IOException#{#if#(#!#overwrite#&&#getResource#(#destination#)#.#exists#(#)#)#{#throw#new#IOException#(#"destination file exists and overwrite == false"#)#;#}#fireTransferInitiated#(#getResource#(#destination#)#,#TransferEvent#.#REQUEST_PUT#)#;#try#{#long#totalLength#=#source#.#length#(#)#;#if#(#totalLength#>#0#)#{#progress#.#setTotalLength#(#new#Long#(#totalLength#)#)#;#}#FileUtil#.#copy#(#source#,#new#URL#(#destination#)#,#progress#)#;#}#catch#(#IOException#ex#)#{#fireTransferError#(#ex#)#;#throw#ex#;#}#catch#(#RuntimeException#ex#)#{#fireTransferError#(#ex#)#;#throw#ex#;#}#finally#{#progress#.#setTotalLength#(#null#)#;#}#}##List#list#(#String#parent#)#throws#IOException#{#if#(#parent#.#startsWith#(#"http"#)#)#{#List#urls#=#lister#.#listAll#(#new#URL#(#parent#)#)#;#if#(#urls#!=#null#)#{#List#ret#=#new#ArrayList#(#urls#.#size#(#)#)#;#for#(#ListIterator#iter#=#urls#.#listIterator#(#)#;#iter#.#hasNext#(#)#;#)#{#URL#url#=#(#URL#)#iter#.#next#(#)#;#ret#.#add#(#url#.#toExternalForm#(#)#)#;#}#return#ret#;#}#}#else#if#(#parent#.#startsWith#(#"file"#)#)#{#String#path#;#try#{#path#=#new#URI#(#parent#)#.#getPath#(#)#;#}#catch#(#URISyntaxException#e#)#{#IOException#ioe#=#new#IOException#(#"Couldn't list content of '"#+#parent#+#"'"#)#;#ioe#.#initCause#(#e#)#;#throw#ioe#;#}#File#file#=#new#File#(#path#)#;#if#(#file#.#exists#(#)#&&#file#.#isDirectory#(#)#)#{#String#[#]#files#=#file#.#list#(#)#;#List#ret#=#new#ArrayList#(#files#.#length#)#;#URL#context#=#path#.#endsWith#(#"/"#)#?#new#URL#(#parent#)#:#new#URL#(#parent#+#"/"#)#;#for#(#int#i#=#0#;#i#<#files#.#length#;#i#++#)#{#ret#.#add#(#new#URL#(#context#,#files#[#i#]#)#.#toExternalForm#(#)#)#;#}#return#ret#;#}#else#{#return#Collections#.#EMPTY_LIST#;#}#}#return#null#;#}##