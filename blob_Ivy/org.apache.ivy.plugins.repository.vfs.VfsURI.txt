VfsURI#vfsURIFactory#(#String#scheme#,#String#resource#,#Ivy#ivy#)#{#VfsURI#vfsURI#=#null#;#if#(#scheme#.#equals#(#SCHEME_CIFS#)#)#{#vfsURI#=#new#VfsURI#(#SCHEME_CIFS#,#ivy#.#getVariable#(#VfsTestHelper#.#PROP_VFS_USER_ID#)#,#ivy#.#getVariable#(#VfsTestHelper#.#PROP_VFS_USER_PASSWD#)#,#ivy#.#getVariable#(#VfsTestHelper#.#PROP_VFS_HOST#)#,#ivy#.#getVariable#(#VfsTestHelper#.#PROP_VFS_SAMBA_REPO#)#+#"/"#+#resource#)#;#}#else#if#(#scheme#.#equals#(#SCHEME_FILE#)#)#{#vfsURI#=#new#VfsURI#(#SCHEME_FILE#,#null#,#null#,#null#,#VfsTestHelper#.#CWD#+#"/"#+#VfsTestHelper#.#TEST_REPO_DIR#+#"/"#+#resource#)#;#}#else#if#(#scheme#.#equals#(#SCHEME_FTP#)#)#{#vfsURI#=#new#VfsURI#(#SCHEME_FTP#,#ivy#.#getVariable#(#VfsTestHelper#.#PROP_VFS_USER_ID#)#,#ivy#.#getVariable#(#VfsTestHelper#.#PROP_VFS_USER_PASSWD#)#,#ivy#.#getVariable#(#VfsTestHelper#.#PROP_VFS_HOST#)#,#VfsTestHelper#.#CWD#+#"/"#+#VfsTestHelper#.#TEST_REPO_DIR#+#"/"#+#resource#)#;#}#else#if#(#scheme#.#equals#(#SCHEME_SFTP#)#)#{#vfsURI#=#new#VfsURI#(#SCHEME_SFTP#,#ivy#.#getVariable#(#VfsTestHelper#.#PROP_VFS_USER_ID#)#,#ivy#.#getVariable#(#VfsTestHelper#.#PROP_VFS_USER_PASSWD#)#,#ivy#.#getVariable#(#VfsTestHelper#.#PROP_VFS_HOST#)#,#VfsTestHelper#.#CWD#+#"/"#+#VfsTestHelper#.#TEST_REPO_DIR#+#"/"#+#resource#)#;#}#return#vfsURI#;#}##String#getVfsURI#(#)#{#StringBuffer#uri#=#new#StringBuffer#(#)#;#uri#.#append#(#this#.#scheme#+#"://"#)#;#// not all resource identifiers include user/passwd specifiers#if#(#user#!=#null#&&#user#.#trim#(#)#.#length#(#)#>#0#)#{#uri#.#append#(#this#.#user#+#":"#)#;#if#(#passwd#!=#null#&&#passwd#.#trim#(#)#.#length#(#)#>#0#)#{#this#.#passwd#=#passwd#.#trim#(#)#;#}#else#{#this#.#passwd#=#""#;#}#uri#.#append#(#this#.#passwd#+#"@"#)#;#}#// not all resource identifiers include a host specifier#if#(#host#!=#null#&&#host#.#trim#(#)#.#length#(#)#>#0#)#{#this#.#host#=#host#.#trim#(#)#;#uri#.#append#(#this#.#host#)#;#}#uri#.#append#(#this#.#path#)#;#return#uri#.#toString#(#)#;#}##String#normalizePath#(#String#path#)#{#// all backslashes replaced with forward slashes#String#normalizedPath#=#path#.#replaceAll#(#"\\\\"#,#"/"#)#;#// collapse multiple instance of forward slashes to single slashes#normalizedPath#=#normalizedPath#.#replaceAll#(#"//+"#,#"/"#)#;#// ensure that our path starts with a forward slash#if#(#!#normalizedPath#.#startsWith#(#"/"#)#)#{#normalizedPath#=#"/"#+#normalizedPath#;#}#return#normalizedPath#.#trim#(#)#;#}##String#toString#(#)#{#return#getVfsURI#(#)#;#}##String#getScheme#(#)#{#return#scheme#;#}##