Credentials#promptCredentials#(#Credentials#c#,#File#passfile#)#{#c#=#loadPassfile#(#c#,#passfile#)#;#if#(#c#.#getUserName#(#)#!=#null#&&#c#.#getPasswd#(#)#!=#null#)#{#return#c#;#}#CredentialPanel#credentialPanel#=#new#CredentialPanel#(#c#,#passfile#)#;#if#(#JOptionPane#.#showOptionDialog#(#null#,#credentialPanel#,#c#.#getHost#(#)#+#" credentials"#,#JOptionPane#.#OK_CANCEL_OPTION#,#0#,#new#ImageIcon#(#Ivy#.#class#.#getResource#(#"logo.png"#)#)#,#null#,#new#Integer#(#JOptionPane#.#OK_OPTION#)#)#==#JOptionPane#.#OK_OPTION#)#{#String#username#=#credentialPanel#.#userNameField#.#getText#(#)#;#String#passwd#=#credentialPanel#.#passwordField#.#getText#(#)#;#if#(#credentialPanel#.#rememberDataCB#.#isSelected#(#)#)#{#Properties#props#=#new#EncrytedProperties#(#)#;#props#.#setProperty#(#"username"#,#username#)#;#props#.#setProperty#(#"passwd"#,#passwd#)#;#FileOutputStream#fos#=#null#;#try#{#fos#=#new#FileOutputStream#(#passfile#)#;#props#.#store#(#fos#,#""#)#;#}#catch#(#Exception#e#)#{#Message#.#warn#(#"error occured while saving password file "#+#passfile#+#": "#+#e#)#;#}#finally#{#if#(#fos#!=#null#)#{#try#{#fos#.#close#(#)#;#}#catch#(#Exception#e#)#{#// ignored#}#}#}#}#c#=#new#Credentials#(#c#.#getRealm#(#)#,#c#.#getHost#(#)#,#username#,#passwd#)#;#}#return#c#;#}##Credentials#loadPassfile#(#Credentials#c#,#File#passfile#)#{#if#(#passfile#!=#null#&&#passfile#.#exists#(#)#)#{#Properties#props#=#new#EncrytedProperties#(#)#;#FileInputStream#fis#=#null#;#try#{#fis#=#new#FileInputStream#(#passfile#)#;#props#.#load#(#fis#)#;#String#username#=#c#.#getUserName#(#)#;#String#passwd#=#c#.#getPasswd#(#)#;#if#(#username#==#null#)#{#username#=#props#.#getProperty#(#"username"#)#;#}#if#(#passwd#==#null#)#{#passwd#=#props#.#getProperty#(#"passwd"#)#;#}#return#new#Credentials#(#c#.#getRealm#(#)#,#c#.#getHost#(#)#,#username#,#passwd#)#;#}#catch#(#IOException#e#)#{#Message#.#warn#(#"error occured while loading password file "#+#passfile#+#": "#+#e#)#;#}#finally#{#if#(#fis#!=#null#)#{#try#{#fis#.#close#(#)#;#}#catch#(#IOException#e#)#{#// ignored#}#}#}#}#return#c#;#}##