void#copyReference#(#String#oldKey#,#String#newKey#)#{#Object#orig#=#getProject#(#)#.#getReference#(#oldKey#)#;##if#(#orig#==#null#)#{#log#(#"No object referenced by "#+#oldKey#+#". Can't copy to "#+#newKey#,#Project#.#MSG_WARN#)#;##return#;#}##Class#c#=#orig#.#getClass#(#)#;#Object#copy#=#orig#;##try#{#Method#cloneM#=#c#.#getMethod#(#"clone"#,#new#Class#[#0#]#)#;##if#(#cloneM#!=#null#)#{#copy#=#cloneM#.#invoke#(#orig#,#new#Object#[#0#]#)#;#log#(#"Adding clone of reference "#+#oldKey#,#Project#.#MSG_DEBUG#)#;#}#}##catch#(#Exception#e#)#{##// not Clonable#}##if#(#copy#instanceof#ProjectComponent#)#{#(#(#ProjectComponent#)#copy#)#.#setProject#(#newProject#)#;#}#else#{#try#{#Method#setProjectM#=#c#.#getMethod#(#"setProject"#,#new#Class#[#]#{#Project#.#class#}#)#;##if#(#setProjectM#!=#null#)#{#setProjectM#.#invoke#(#copy#,#new#Object#[#]#{#newProject#}#)#;#}#}##catch#(#NoSuchMethodException#e#)#{##// ignore this if the class being referenced does not have##// a set project method.#}##catch#(#Exception#e2#)#{#String#msg#=#"Error setting new project instance for "#+#"reference with id "#+#oldKey#;#throw#new#BuildException#(#msg#,#e2#,#getLocation#(#)#)#;#}#}##newProject#.#addReference#(#newKey#,#copy#)#;#}