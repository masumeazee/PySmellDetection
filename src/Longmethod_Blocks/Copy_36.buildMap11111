Map#buildMap#(#Resource#[#]#fromResources#,#final#File#toDir#,#FileNameMapper#mapper#)#{#HashMap#map#=#new#HashMap#(#)#;#Resource#[#]#toCopy#=#null#;##if#(#forceOverwrite#)#{#Vector#v#=#new#Vector#(#)#;##for#(#int#i#=#0#;##i#<#fromResources#.#length#;#i#++#)#{##if#(#mapper#.#mapFileName#(#fromResources#[#i#]#.#getName#(#)#)#!=#null#)#{#v#.#addElement#(#fromResources#[#i#]#)#;#}#}##toCopy#=#new#Resource#[#v#.#size#(#)#]#;#v#.#copyInto#(#toCopy#)#;#}#else#{#toCopy#=#ResourceUtils#.#selectOutOfDateSources#(#this#,#fromResources#,#mapper#,#new#ResourceFactory#(#)#{#public#Resource#getResource#(#String#name#)#{##return#new#FileResource#(#toDir#,#name#)#;#}#}##,#granularity#)#;#}##for#(#int#i#=#0#;##i#<#toCopy#.#length#;#i#++#)#{#String#[#]#mappedFiles#=#mapper#.#mapFileName#(#toCopy#[#i#]#.#getName#(#)#)#;##for#(#int#j#=#0#;##j#<#mappedFiles#.#length#;#j#++#)#{##if#(#mappedFiles#[#j#]#==#null#)#{#throw#new#BuildException#(#"Can't copy a resource without a"#+#" name if the mapper doesn't"#+#" provide one."#)#;#}#}##if#(#!#enableMultipleMappings#)#{#map#.#put#(#toCopy#[#i#]#,#new#String#[#]#{#new#File#(#toDir#,#mappedFiles#[#0#]#)#.#getAbsolutePath#(#)#}#)#;#}#else#{##// reuse the array created by the mapper#for#(#int#k#=#0#;##k#<#mappedFiles#.#length#;#k#++#)#{#mappedFiles#[#k#]#=#new#File#(#toDir#,#mappedFiles#[#k#]#)#.#getAbsolutePath#(#)#;#}##map#.#put#(#toCopy#[#i#]#,#mappedFiles#)#;#}#}##return#map#;#}