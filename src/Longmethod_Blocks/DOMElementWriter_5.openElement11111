void#openElement#(#Element#element#,#Writer#out#,#int#indent#,#String#indentWith#,#boolean#hasChildren#)#throws#IOException#{##// Write indent characters#for#(#int#i#=#0#;##i#<#indent#;#i#++#)#{#out#.#write#(#indentWith#)#;#}##// Write element#out#.#write#(#"<"#)#;##if#(#namespacePolicy#.#qualifyElements#)#{#String#uri#=#getNamespaceURI#(#element#)#;#String#prefix#=#(#String#)#nsPrefixMap#.#get#(#uri#)#;##if#(#prefix#==#null#)#{##if#(#nsPrefixMap#.#isEmpty#(#)#)#{##// steal default namespace#prefix#=#""#;#}#else#{#prefix#=#NS#+#(#nextPrefix#++#)#;#}##nsPrefixMap#.#put#(#uri#,#prefix#)#;#addNSDefinition#(#element#,#uri#)#;#}##if#(#!#""#.#equals#(#prefix#)#)#{#out#.#write#(#prefix#)#;#out#.#write#(#":"#)#;#}#}##out#.#write#(#element#.#getTagName#(#)#)#;##// Write attributes#NamedNodeMap#attrs#=#element#.#getAttributes#(#)#;##for#(#int#i#=#0#;##i#<#attrs#.#getLength#(#)#;#i#++#)#{#Attr#attr#=#(#Attr#)#attrs#.#item#(#i#)#;#out#.#write#(#" "#)#;##if#(#namespacePolicy#.#qualifyAttributes#)#{#String#uri#=#getNamespaceURI#(#attr#)#;#String#prefix#=#(#String#)#nsPrefixMap#.#get#(#uri#)#;##if#(#prefix#==#null#)#{#prefix#=#NS#+#(#nextPrefix#++#)#;#nsPrefixMap#.#put#(#uri#,#prefix#)#;#addNSDefinition#(#element#,#uri#)#;#}##out#.#write#(#prefix#)#;#out#.#write#(#":"#)#;#}##out#.#write#(#attr#.#getName#(#)#)#;#out#.#write#(#"=\""#)#;#out#.#write#(#encode#(#attr#.#getValue#(#)#)#)#;#out#.#write#(#"\""#)#;#}##// write namespace declarations#ArrayList#al#=#(#ArrayList#)#nsURIByElement#.#get#(#element#)#;##if#(#al#!=#null#)#{#Iterator#iter#=#al#.#iterator#(#)#;##while#(#iter#.#hasNext#(#)#)#{#String#uri#=#(#String#)#iter#.#next#(#)#;#String#prefix#=#(#String#)#nsPrefixMap#.#get#(#uri#)#;#out#.#write#(#" xmlns"#)#;##if#(#!#""#.#equals#(#prefix#)#)#{#out#.#write#(#":"#)#;#out#.#write#(#prefix#)#;#}##out#.#write#(#"=\""#)#;#out#.#write#(#uri#)#;#out#.#write#(#"\""#)#;#}#}##if#(#hasChildren#)#{#out#.#write#(#">"#)#;#}#else#{#removeNSDefinitions#(#element#)#;#out#.#write#(#" />"#)#;#out#.#write#(#lSep#)#;#out#.#flush#(#)#;#}#}