void#write#(#byte#[#]#b#,#int#off#,#int#len#)#throws#IOException#{##// find the line breaks and pass other chars through in blocks#int#offset#=#off#;#int#blockStartOffset#=#offset#;#int#remaining#=#len#;#BufferInfo#bufferInfo#=#getBufferInfo#(#)#;##while#(#remaining#>#0#)#{#while#(#remaining#>#0#&&#b#[#offset#]#!=#LF#&&#b#[#offset#]#!=#CR#)#{#offset#++#;#remaining#--#;#}##// either end of buffer or a line separator char#int#blockLength#=#offset#-#blockStartOffset#;##if#(#blockLength#>#0#)#{#bufferInfo#.#buffer#.#write#(#b#,#blockStartOffset#,#blockLength#)#;#}##while#(#remaining#>#0#&&#(#b#[#offset#]#==#LF#||#b#[#offset#]#==#CR#)#)#{#write#(#b#[#offset#]#)#;#offset#++#;#remaining#--#;#}##blockStartOffset#=#offset#;#}#}