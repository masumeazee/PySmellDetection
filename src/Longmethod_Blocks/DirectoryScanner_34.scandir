void#scandir#(#File#dir#,#TokenizedPath#path#,#boolean#fast#,#String#[#]#newfiles#,#LinkedList#directoryNamesFollowed#)#{#String#vpath#=#path#.#toString#(#)#;##if#(#vpath#.#length#(#)#>#0#&&#!#vpath#.#endsWith#(#File#.#separator#)#)#{#vpath#+=#File#.#separator#;#}##// avoid double scanning of directories, can only happen in fast mode##if#(#fast#&&#hasBeenScanned#(#vpath#)#)#{##return#;#}##if#(#!#followSymlinks#)#{#ArrayList#noLinks#=#new#ArrayList#(#)#;##for#(#int#i#=#0#;##i#<#newfiles#.#length#;#i#++#)#{#try#{##if#(#SYMLINK_UTILS#.#isSymbolicLink#(#dir#,#newfiles#[#i#]#)#)#{#String#name#=#vpath#+#newfiles#[#i#]#;#File#file#=#new#File#(#dir#,#newfiles#[#i#]#)#;#(#file#.#isDirectory#(#)#?#dirsExcluded#:#filesExcluded#)#.#addElement#(#name#)#;##if#(#!#isExcluded#(#name#)#)#{#notFollowedSymlinks#.#add#(#file#.#getAbsolutePath#(#)#)#;#}#}#else#{#noLinks#.#add#(#newfiles#[#i#]#)#;#}#}##catch#(#IOException#ioe#)#{#String#msg#=#"IOException caught while checking "#+#"for links, couldn't get canonical path!"#;##// will be caught and redirected to Ant's logging system#System#.#err#.#println#(#msg#)#;#noLinks#.#add#(#newfiles#[#i#]#)#;#}#}##newfiles#=#(#String#[#]#)#(#noLinks#.#toArray#(#new#String#[#noLinks#.#size#(#)#]#)#)#;#}#else#{#directoryNamesFollowed#.#addFirst#(#dir#.#getName#(#)#)#;#}##for#(#int#i#=#0#;##i#<#newfiles#.#length#;#i#++#)#{#String#name#=#vpath#+#newfiles#[#i#]#;#TokenizedPath#newPath#=#new#TokenizedPath#(#path#,#newfiles#[#i#]#)#;#File#file#=#new#File#(#dir#,#newfiles#[#i#]#)#;#String#[#]#children#=#file#.#list#(#)#;##if#(#children#==#null#)#{##// probably file##if#(#isIncluded#(#newPath#)#)#{#accountForIncludedFile#(#newPath#,#file#)#;#}#else#{#everythingIncluded#=#false#;#filesNotIncluded#.#addElement#(#name#)#;#}#}#else#{##// dir##if#(#followSymlinks#&&#causesIllegalSymlinkLoop#(#newfiles#[#i#]#,#dir#,#directoryNamesFollowed#)#)#{##// will be caught and redirected to Ant's logging system#System#.#err#.#println#(#"skipping symbolic link "#+#file#.#getAbsolutePath#(#)#+#" -- too many levels of symbolic"#+#" links."#)#;#notFollowedSymlinks#.#add#(#file#.#getAbsolutePath#(#)#)#;#continue#;#}##if#(#isIncluded#(#newPath#)#)#{#accountForIncludedDir#(#newPath#,#file#,#fast#,#children#,#directoryNamesFollowed#)#;#}#else#{#everythingIncluded#=#false#;#dirsNotIncluded#.#addElement#(#name#)#;##if#(#fast#&&#couldHoldIncluded#(#newPath#)#)#{#scandir#(#file#,#newPath#,#fast#,#children#,#directoryNamesFollowed#)#;#}#}##if#(#!#fast#)#{#scandir#(#file#,#newPath#,#fast#,#children#,#directoryNamesFollowed#)#;#}#}#}##if#(#followSymlinks#)#{#directoryNamesFollowed#.#removeFirst#(#)#;#}#}