void#runExec#(#Execute#exe#)#throws#BuildException#{#int#totalFiles#=#0#;#int#totalDirs#=#0#;#boolean#haveExecuted#=#false#;##try#{#Vector#fileNames#=#new#Vector#(#)#;#Vector#baseDirs#=#new#Vector#(#)#;##for#(#int#i#=#0#;##i#<#filesets#.#size#(#)#;#i#++#)#{#String#currentType#=#type#;#AbstractFileSet#fs#=#(#AbstractFileSet#)#filesets#.#elementAt#(#i#)#;##if#(#fs#instanceof#DirSet#)#{##if#(#!#FileDirBoth#.#DIR#.#equals#(#type#)#)#{#log#(#"Found a nested dirset but type is "#+#type#+#". "#+#"Temporarily switching to type=\"dir\" on the"#+#" assumption that you really did mean"#+#" <dirset> not <fileset>."#,#Project#.#MSG_DEBUG#)#;#currentType#=#FileDirBoth#.#DIR#;#}#}##File#base#=#fs#.#getDir#(#getProject#(#)#)#;#DirectoryScanner#ds#=#fs#.#getDirectoryScanner#(#getProject#(#)#)#;##if#(#!#FileDirBoth#.#DIR#.#equals#(#currentType#)#)#{#String#[#]#s#=#getFiles#(#base#,#ds#)#;##for#(#int#j#=#0#;##j#<#s#.#length#;#j#++#)#{#totalFiles#++#;#fileNames#.#addElement#(#s#[#j#]#)#;#baseDirs#.#addElement#(#base#)#;#}#}##if#(#!#FileDirBoth#.#FILE#.#equals#(#currentType#)#)#{#String#[#]#s#=#getDirs#(#base#,#ds#)#;##for#(#int#j#=#0#;##j#<#s#.#length#;#j#++#)#{#totalDirs#++#;#fileNames#.#addElement#(#s#[#j#]#)#;#baseDirs#.#addElement#(#base#)#;#}#}##if#(#fileNames#.#size#(#)#==#0#&&#skipEmpty#)#{#logSkippingFileset#(#currentType#,#ds#,#base#)#;#continue#;#}##if#(#!#parallel#)#{#String#[#]#s#=#new#String#[#fileNames#.#size#(#)#]#;#fileNames#.#copyInto#(#s#)#;##for#(#int#j#=#0#;##j#<#s#.#length#;#j#++#)#{#String#[#]#command#=#getCommandline#(#s#[#j#]#,#base#)#;#log#(#Commandline#.#describeCommand#(#command#)#,#Project#.#MSG_VERBOSE#)#;#exe#.#setCommandline#(#command#)#;##if#(#redirectorElement#!=#null#)#{#setupRedirector#(#)#;#redirectorElement#.#configure#(#redirector#,#s#[#j#]#)#;#}##if#(#redirectorElement#!=#null#||#haveExecuted#)#{##// need to reset the stream handler to restart##// reading of pipes;##// go ahead and do it always w/ nested redirectors#exe#.#setStreamHandler#(#redirector#.#createHandler#(#)#)#;#}##runExecute#(#exe#)#;#haveExecuted#=#true#;#}##fileNames#.#removeAllElements#(#)#;#baseDirs#.#removeAllElements#(#)#;#}#}##if#(#resources#!=#null#)#{#Iterator#iter#=#resources#.#iterator#(#)#;##while#(#iter#.#hasNext#(#)#)#{#Resource#res#=#(#Resource#)#iter#.#next#(#)#;##if#(#!#res#.#isExists#(#)#&&#ignoreMissing#)#{#continue#;#}##File#base#=#null#;#String#name#=#res#.#getName#(#)#;#FileProvider#fp#=#(#FileProvider#)#res#.#as#(#FileProvider#.#class#)#;##if#(#fp#!=#null#)#{#FileResource#fr#=#ResourceUtils#.#asFileResource#(#fp#)#;#base#=#fr#.#getBaseDir#(#)#;##if#(#base#==#null#)#{#name#=#fr#.#getFile#(#)#.#getAbsolutePath#(#)#;#}#}##if#(#restrict#(#new#String#[#]#{#name#}##,#base#)#.#length#==#0#)#{#continue#;#}##if#(#(#!#res#.#isDirectory#(#)#||#!#res#.#isExists#(#)#)#&&#!#FileDirBoth#.#DIR#.#equals#(#type#)#)#{#totalFiles#++#;#}#else##if#(#res#.#isDirectory#(#)#&&#!#FileDirBoth#.#FILE#.#equals#(#type#)#)#{#totalDirs#++#;#}#else#{#continue#;#}##baseDirs#.#add#(#base#)#;#fileNames#.#add#(#name#)#;##if#(#!#parallel#)#{#String#[#]#command#=#getCommandline#(#name#,#base#)#;#log#(#Commandline#.#describeCommand#(#command#)#,#Project#.#MSG_VERBOSE#)#;#exe#.#setCommandline#(#command#)#;##if#(#redirectorElement#!=#null#)#{#setupRedirector#(#)#;#redirectorElement#.#configure#(#redirector#,#name#)#;#}##if#(#redirectorElement#!=#null#||#haveExecuted#)#{##// need to reset the stream handler to restart##// reading of pipes;##// go ahead and do it always w/ nested redirectors#exe#.#setStreamHandler#(#redirector#.#createHandler#(#)#)#;#}##runExecute#(#exe#)#;#haveExecuted#=#true#;#fileNames#.#removeAllElements#(#)#;#baseDirs#.#removeAllElements#(#)#;#}#}#}##if#(#parallel#&&#(#fileNames#.#size#(#)#>#0#||#!#skipEmpty#)#)#{#runParallel#(#exe#,#fileNames#,#baseDirs#)#;#haveExecuted#=#true#;#}##if#(#haveExecuted#)#{#log#(#"Applied "#+#cmdl#.#getExecutable#(#)#+#" to "#+#totalFiles#+#" file"#+#(#totalFiles#!=#1#?#"s"#:#""#)#+#" and "#+#totalDirs#+#" director"#+#(#totalDirs#!=#1#?#"ies"#:#"y"#)#+#"."#,#verbose#?#Project#.#MSG_INFO#:#Project#.#MSG_VERBOSE#)#;#}#}##catch#(#IOException#e#)#{#throw#new#BuildException#(#"Execute failed: "#+#e#,#e#,#getLocation#(#)#)#;#}##finally#{##// close the output file if required#logFlush#(#)#;#redirector#.#setAppendProperties#(#false#)#;#redirector#.#setProperties#(#)#;#}#}