int#execute#(#)#throws#IOException#{##if#(#workingDirectory#!=#null#&&#!#workingDirectory#.#exists#(#)#)#{#throw#new#BuildException#(#workingDirectory#+#" doesn't exist."#)#;#}##final#Process#process#=#launch#(#project#,#getCommandline#(#)#,#getEnvironment#(#)#,#workingDirectory#,#useVMLauncher#)#;##try#{#streamHandler#.#setProcessInputStream#(#process#.#getOutputStream#(#)#)#;#streamHandler#.#setProcessOutputStream#(#process#.#getInputStream#(#)#)#;#streamHandler#.#setProcessErrorStream#(#process#.#getErrorStream#(#)#)#;#}##catch#(#IOException#e#)#{#process#.#destroy#(#)#;#throw#e#;#}##streamHandler#.#start#(#)#;##try#{##// add the process to the list of those to destroy if the VM exits##//#processDestroyer#.#add#(#process#)#;##if#(#watchdog#!=#null#)#{#watchdog#.#start#(#process#)#;#}##waitFor#(#process#)#;##if#(#watchdog#!=#null#)#{#watchdog#.#stop#(#)#;#}##streamHandler#.#stop#(#)#;#closeStreams#(#process#)#;##if#(#watchdog#!=#null#)#{#watchdog#.#checkException#(#)#;#}##return#getExitValue#(#)#;#}##catch#(#ThreadDeath#t#)#{##// #31928: forcibly kill it before continuing.#process#.#destroy#(#)#;#throw#t#;#}##finally#{##// remove the process to the list of those to destroy if##// the VM exits##//#processDestroyer#.#remove#(#process#)#;#}#}