void#logVmExit#(#FormatterElement#[#]#feArray#,#JUnitTest#test#,#String#message#,#String#testCase#)#{##if#(#delegate#==#null#)#{#setupJUnitDelegate#(#)#;#}##try#{#log#(#"Using System properties "#+#System#.#getProperties#(#)#,#Project#.#MSG_VERBOSE#)#;##if#(#splitJunit#)#{#classLoader#=#(#AntClassLoader#)#delegate#.#getClass#(#)#.#getClassLoader#(#)#;#}#else#{#createClassLoader#(#)#;#}##if#(#classLoader#!=#null#)#{#classLoader#.#setThreadContextLoader#(#)#;#}##test#.#setCounts#(#1#,#0#,#1#)#;#test#.#setProperties#(#getProject#(#)#.#getProperties#(#)#)#;##for#(#int#i#=#0#;##i#<#feArray#.#length#;#i#++#)#{#FormatterElement#fe#=#feArray#[#i#]#;##if#(#fe#.#shouldUse#(#this#)#)#{#JUnitTaskMirror#.#JUnitResultFormatterMirror#formatter#=#fe#.#createFormatter#(#classLoader#)#;##if#(#formatter#!=#null#)#{#OutputStream#out#=#null#;#File#outFile#=#getOutput#(#fe#,#test#)#;##if#(#outFile#!=#null#)#{#try#{#out#=#new#FileOutputStream#(#outFile#)#;#}##catch#(#IOException#e#)#{##// ignore#}#}##if#(#out#==#null#)#{#out#=#getDefaultOutput#(#)#;#}##delegate#.#addVmExit#(#test#,#formatter#,#out#,#message#,#testCase#)#;#}#}#}##if#(#summary#)#{#JUnitTaskMirror#.#SummaryJUnitResultFormatterMirror#f#=#delegate#.#newSummaryJUnitResultFormatter#(#)#;#f#.#setWithOutAndErr#(#"withoutanderr"#.#equalsIgnoreCase#(#summaryValue#)#)#;#delegate#.#addVmExit#(#test#,#f#,#getDefaultOutput#(#)#,#message#,#testCase#)#;#}#}##finally#{##if#(#classLoader#!=#null#)#{#classLoader#.#resetThreadContextLoader#(#)#;#}#}#}