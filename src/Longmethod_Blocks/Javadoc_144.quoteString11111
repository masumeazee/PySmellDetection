String#quoteString#(#final#String#str#,#final#char#delim#)#{#StringBuffer#buf#=#new#StringBuffer#(#str#.#length#(#)#*#2#)#;#buf#.#append#(#delim#)#;#final#int#len#=#str#.#length#(#)#;#boolean#lastCharWasCR#=#false#;##for#(#int#i#=#0#;##i#<#len#;#i#++#)#{#char#c#=#str#.#charAt#(#i#)#;##if#(#c#==#delim#)#{##// can't put the non-constant delim into a case#buf#.#append#(#'\\'#)#.#append#(#c#)#;#lastCharWasCR#=#false#;#}#else#{#switch#(#c#)#{#case#'\\'#:#buf#.#append#(#"\\\\"#)#;#lastCharWasCR#=#false#;#break#;#case#'\r'#:##// insert a line continuation marker#buf#.#append#(#"\\\r"#)#;#lastCharWasCR#=#true#;#break#;#case#'\n'#:##// insert a line continuation marker unless this##// is a \r\n sequence in which case \r already has##// created the marker##if#(#!#lastCharWasCR#)#{#buf#.#append#(#"\\\n"#)#;#}#else#{#buf#.#append#(#"\n"#)#;#}##lastCharWasCR#=#false#;#break#;#default#:#buf#.#append#(#c#)#;##lastCharWasCR#=#false#;#break#;#}#}#}##buf#.#append#(#delim#)#;##return#buf#.#toString#(#)#;#}