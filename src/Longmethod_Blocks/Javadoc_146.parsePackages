void#parsePackages#(#Vector#pn#,#Path#sp#)#{#Vector#addedPackages#=#new#Vector#(#)#;#Vector#dirSets#=#(#Vector#)#packageSets#.#clone#(#)#;##// for each sourcePath entry, add a directoryset with includes##// taken from packagenames attribute and nested package##// elements and excludes taken from excludepackages attribute##// and nested excludepackage elements##if#(#sourcePath#!=#null#)#{#PatternSet#ps#=#new#PatternSet#(#)#;#ps#.#setProject#(#getProject#(#)#)#;##if#(#packageNames#.#size#(#)#>#0#)#{#Enumeration#e#=#packageNames#.#elements#(#)#;##while#(#e#.#hasMoreElements#(#)#)#{#PackageName#p#=#(#PackageName#)#e#.#nextElement#(#)#;#String#pkg#=#p#.#getName#(#)#.#replace#(#'.'#,#'/'#)#;##if#(#pkg#.#endsWith#(#"*"#)#)#{#pkg#+=#"*"#;#}##ps#.#createInclude#(#)#.#setName#(#pkg#)#;#}#}#else#{#ps#.#createInclude#(#)#.#setName#(#"**"#)#;#}##Enumeration#e#=#excludePackageNames#.#elements#(#)#;##while#(#e#.#hasMoreElements#(#)#)#{#PackageName#p#=#(#PackageName#)#e#.#nextElement#(#)#;#String#pkg#=#p#.#getName#(#)#.#replace#(#'.'#,#'/'#)#;##if#(#pkg#.#endsWith#(#"*"#)#)#{#pkg#+=#"*"#;#}##ps#.#createExclude#(#)#.#setName#(#pkg#)#;#}##String#[#]#pathElements#=#sourcePath#.#list#(#)#;##for#(#int#i#=#0#;##i#<#pathElements#.#length#;#i#++#)#{#File#dir#=#new#File#(#pathElements#[#i#]#)#;##if#(#dir#.#isDirectory#(#)#)#{#DirSet#ds#=#new#DirSet#(#)#;#ds#.#setProject#(#getProject#(#)#)#;#ds#.#setDefaultexcludes#(#useDefaultExcludes#)#;#ds#.#setDir#(#dir#)#;#ds#.#createPatternSet#(#)#.#addConfiguredPatternset#(#ps#)#;#dirSets#.#addElement#(#ds#)#;#}#else#{#log#(#"Skipping "#+#pathElements#[#i#]#+#" since it is no directory."#,#Project#.#MSG_WARN#)#;#}#}#}##Enumeration#e#=#dirSets#.#elements#(#)#;##while#(#e#.#hasMoreElements#(#)#)#{#DirSet#ds#=#(#DirSet#)#e#.#nextElement#(#)#;#File#baseDir#=#ds#.#getDir#(#getProject#(#)#)#;#log#(#"scanning "#+#baseDir#+#" for packages."#,#Project#.#MSG_DEBUG#)#;#DirectoryScanner#dsc#=#ds#.#getDirectoryScanner#(#getProject#(#)#)#;#String#[#]#dirs#=#dsc#.#getIncludedDirectories#(#)#;#boolean#containsPackages#=#false#;##for#(#int#i#=#0#;##i#<#dirs#.#length#;#i#++#)#{##// are there any java files in this directory?#File#pd#=#new#File#(#baseDir#,#dirs#[#i#]#)#;#String#[#]#files#=#pd#.#list#(#new#FilenameFilter#(#)#{#public#boolean#accept#(#File#dir1#,#String#name#)#{##return#name#.#endsWith#(#".java"#)#||#(#includeNoSourcePackages#&&#name#.#equals#(#"package.html"#)#)#;#}#}#)#;##if#(#files#.#length#>#0#)#{##if#(#""#.#equals#(#dirs#[#i#]#)#)#{#log#(#baseDir#+#" contains source files in the default package,"#+#" you must specify them as source files"#+#" not packages."#,#Project#.#MSG_WARN#)#;#}#else#{#containsPackages#=#true#;#String#packageName#=#dirs#[#i#]#.#replace#(#File#.#separatorChar#,#'.'#)#;##if#(#!#addedPackages#.#contains#(#packageName#)#)#{#addedPackages#.#addElement#(#packageName#)#;#pn#.#addElement#(#packageName#)#;#}#}#}#}##if#(#containsPackages#)#{##// We don't need to care for duplicates here,##// Path.list does it for us.#sp#.#createPathElement#(#)#.#setLocation#(#baseDir#)#;#}#else#{#log#(#baseDir#+#" doesn\'t contain any packages, dropping it."#,#Project#.#MSG_VERBOSE#)#;#}#}#}