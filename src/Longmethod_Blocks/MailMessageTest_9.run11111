void#run#(#)#{#try#{#ssock#=#new#ServerSocket#(#TEST_PORT#)#;#sock#=#ssock#.#accept#(#)#;##// wait for connection#in#=#new#BufferedReader#(#new#InputStreamReader#(#sock#.#getInputStream#(#)#)#)#;#out#=#new#BufferedWriter#(#new#OutputStreamWriter#(#sock#.#getOutputStream#(#)#)#)#;#sb#=#new#StringBuffer#(#)#;#send#(#"220 test SMTP EmailTaskTest\r\n"#)#;#loop#=#true#;##while#(#loop#)#{#String#response#=#in#.#readLine#(#)#;##if#(#response#==#null#)#{#loop#=#false#;#break#;#}##sb#.#append#(#response#+#"\r\n"#)#;##if#(#!#data#&&#response#.#startsWith#(#"HELO"#)#)#{#send#(#"250 "#+#local#+#" Hello "#+#local#+#" "#+#"[127.0.0.1], pleased to meet you\r\n"#)#;#}#else##if#(#!#data#&&#response#.#startsWith#(#"MAIL"#)#)#{#send#(#"250\r\n"#)#;#}#else##if#(#!#data#&&#response#.#startsWith#(#"RCPT"#)#)#{#send#(#"250\r\n"#)#;#}#else##if#(#!#data#&&#response#.#startsWith#(#"DATA"#)#)#{#send#(#"354\r\n"#)#;#data#=#true#;#}#else##if#(#data#&&#response#.#equals#(#"."#)#)#{#send#(#"250\r\n"#)#;#data#=#false#;#}#else##if#(#!#data#&&#response#.#startsWith#(#"QUIT"#)#)#{#send#(#"221\r\n"#)#;#loop#=#false#;#}#else##if#(#!#data#)#{##//throw new IllegalStateException("Command unrecognized: "##//    + response);#send#(#"500 5.5.1 Command unrecognized: \""#+#response#+#"\"\r\n"#)#;#loop#=#false#;#}#else#{##// sb.append( response + "\r\n" );#}#}##// while#}##catch#(#IOException#ioe#)#{#fail#(#)#;#}##finally#{#disconnect#(#)#;#}#}