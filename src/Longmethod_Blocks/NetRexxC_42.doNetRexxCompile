void#doNetRexxCompile#(#)#throws#BuildException#{#log#(#"Using NetRexx compiler"#,#Project#.#MSG_VERBOSE#)#;#String#classpath#=#getCompileClasspath#(#)#;#StringBuffer#compileOptions#=#new#StringBuffer#(#)#;##// create an array of strings for input to the compiler: one array##// comes from the compile options, the other from the compileList#String#[#]#compileOptionsArray#=#getCompileOptionsAsArray#(#)#;#String#[#]#fileListArray#=#new#String#[#compileList#.#size#(#)#]#;#Enumeration#e#=#compileList#.#elements#(#)#;#int#j#=#0#;##while#(#e#.#hasMoreElements#(#)#)#{#fileListArray#[#j#]#=#(#String#)#e#.#nextElement#(#)#;#j#++#;#}##// create a single array of arguments for the compiler#String#[#]#compileArgs#=#new#String#[#compileOptionsArray#.#length#+#fileListArray#.#length#]#;##for#(#int#i#=#0#;##i#<#compileOptionsArray#.#length#;#i#++#)#{#compileArgs#[#i#]#=#compileOptionsArray#[#i#]#;#}##for#(#int#i#=#0#;##i#<#fileListArray#.#length#;#i#++#)#{#compileArgs#[#i#+#compileOptionsArray#.#length#]#=#fileListArray#[#i#]#;#}##// print nice output about what we are doing for the log#compileOptions#.#append#(#"Compilation args: "#)#;##for#(#int#i#=#0#;##i#<#compileOptionsArray#.#length#;#i#++#)#{#compileOptions#.#append#(#compileOptionsArray#[#i#]#)#;#compileOptions#.#append#(#" "#)#;#}##log#(#compileOptions#.#toString#(#)#,#Project#.#MSG_VERBOSE#)#;#String#eol#=#System#.#getProperty#(#"line.separator"#)#;#StringBuffer#niceSourceList#=#new#StringBuffer#(#"Files to be compiled:"#+#eol#)#;##for#(#int#i#=#0#;##i#<#compileList#.#size#(#)#;#i#++#)#{#niceSourceList#.#append#(#"    "#)#;#niceSourceList#.#append#(#compileList#.#elementAt#(#i#)#.#toString#(#)#)#;#niceSourceList#.#append#(#eol#)#;#}##log#(#niceSourceList#.#toString#(#)#,#Project#.#MSG_VERBOSE#)#;##// need to set java.class.path property and restore it later##// since the NetRexx compiler has no option for the classpath#String#currentClassPath#=#System#.#getProperty#(#"java.class.path"#)#;#Properties#currentProperties#=#System#.#getProperties#(#)#;#currentProperties#.#put#(#"java.class.path"#,#classpath#)#;##try#{#StringWriter#out#=#new#StringWriter#(#)#;#PrintWriter#w#=#null#;#int#rc#=#COM#.#ibm#.#netrexx#.#process#.#NetRexxC#.#main#(#new#Rexx#(#compileArgs#)#,#w#=#new#PrintWriter#(#out#)#)#;#String#sdir#=#srcDir#.#getAbsolutePath#(#)#;#String#ddir#=#destDir#.#getAbsolutePath#(#)#;#boolean#doReplace#=#!#(#sdir#.#equals#(#ddir#)#)#;#int#dlen#=#ddir#.#length#(#)#;#String#l#;#BufferedReader#in#=#new#BufferedReader#(#new#StringReader#(#out#.#toString#(#)#)#)#;#log#(#"replacing destdir '"#+#ddir#+#"' through sourcedir '"#+#sdir#+#"'"#,#Project#.#MSG_VERBOSE#)#;##while#(#(#l#=#in#.#readLine#(#)#)#!=#null#)#{#int#idx#;##while#(#doReplace#&&#(#(#idx#=#l#.#indexOf#(#ddir#)#)#!=#-#1#)#)#{##// path is mentioned in the message#l#=#(#new#StringBuffer#(#l#)#)#.#replace#(#idx#,#idx#+#dlen#,#sdir#)#.#toString#(#)#;#}##// verbose level logging for suppressed messages##if#(#suppressMethodArgumentNotUsed#&&#l#.#indexOf#(#MSG_METHOD_ARGUMENT_NOT_USED#)#!=#-#1#)#{#log#(#l#,#Project#.#MSG_VERBOSE#)#;#}#else##if#(#suppressPrivatePropertyNotUsed#&&#l#.#indexOf#(#MSG_PRIVATE_PROPERTY_NOT_USED#)#!=#-#1#)#{#log#(#l#,#Project#.#MSG_VERBOSE#)#;#}#else##if#(#suppressVariableNotUsed#&&#l#.#indexOf#(#MSG_VARIABLE_NOT_USED#)#!=#-#1#)#{#log#(#l#,#Project#.#MSG_VERBOSE#)#;#}#else##if#(#suppressExceptionNotSignalled#&&#l#.#indexOf#(#MSG_EXCEPTION_NOT_SIGNALLED#)#!=#-#1#)#{#log#(#l#,#Project#.#MSG_VERBOSE#)#;#}#else##if#(#suppressDeprecation#&&#l#.#indexOf#(#MSG_DEPRECATION#)#!=#-#1#)#{#log#(#l#,#Project#.#MSG_VERBOSE#)#;#}#else##if#(#l#.#indexOf#(#"Error:"#)#!=#-#1#)#{##// error level logging for compiler errors#log#(#l#,#Project#.#MSG_ERR#)#;#}#else##if#(#l#.#indexOf#(#"Warning:"#)#!=#-#1#)#{##// warning for all warning messages#log#(#l#,#Project#.#MSG_WARN#)#;#}#else#{#log#(#l#,#Project#.#MSG_INFO#)#;##// info level for the rest.#}#}##if#(#rc#>#1#)#{#throw#new#BuildException#(#"Compile failed, messages should "#+#"have been provided."#)#;#}##if#(#w#.#checkError#(#)#)#{#throw#new#IOException#(#"Encountered an error"#)#;#}#}##catch#(#IOException#ioe#)#{#throw#new#BuildException#(#"Unexpected IOException while "#+#"playing with Strings"#,#ioe#)#;#}##finally#{##// need to reset java.class.path property##// since the NetRexx compiler has no option for the classpath#currentProperties#=#System#.#getProperties#(#)#;#currentProperties#.#put#(#"java.class.path"#,#currentClassPath#)#;#}#}