Properties#getProperties#(#)#{##if#(#isReference#(#)#)#{##return#getRef#(#)#.#getProperties#(#)#;#}##dieOnCircularReference#(#)#;#Set#names#=#null#;#Project#prj#=#getProject#(#)#;#Hashtable#props#=#prj#==#null#?#getAllSystemProperties#(#)#:#prj#.#getProperties#(#)#;##//quick & dirty, to make nested mapped p-sets work:#for#(#Enumeration#e#=#setRefs#.#elements#(#)#;##e#.#hasMoreElements#(#)#;#)#{#PropertySet#set#=#(#PropertySet#)#e#.#nextElement#(#)#;#props#.#putAll#(#set#.#getProperties#(#)#)#;#}##if#(#getDynamic#(#)#||#cachedNames#==#null#)#{#names#=#new#HashSet#(#)#;#addPropertyNames#(#names#,#props#)#;##// Add this PropertySet's nested PropertySets' property names.#for#(#Enumeration#e#=#setRefs#.#elements#(#)#;##e#.#hasMoreElements#(#)#;#)#{#PropertySet#set#=#(#PropertySet#)#e#.#nextElement#(#)#;#names#.#addAll#(#set#.#getProperties#(#)#.#keySet#(#)#)#;#}##if#(#negate#)#{##//make a copy...#HashSet#complement#=#new#HashSet#(#props#.#keySet#(#)#)#;#complement#.#removeAll#(#names#)#;#names#=#complement#;#}##if#(#!#getDynamic#(#)#)#{#cachedNames#=#names#;#}#}#else#{#names#=#cachedNames#;#}##FileNameMapper#m#=#null#;#Mapper#myMapper#=#getMapper#(#)#;##if#(#myMapper#!=#null#)#{#m#=#myMapper#.#getImplementation#(#)#;#}##Properties#properties#=#new#Properties#(#)#;##//iterate through the names, get the matching values#for#(#Iterator#iter#=#names#.#iterator#(#)#;##iter#.#hasNext#(#)#;#)#{#String#name#=#(#String#)#iter#.#next#(#)#;#String#value#=#(#String#)#props#.#get#(#name#)#;##if#(#value#!=#null#)#{##// may be null if a system property has been added##// after the project instance has been initialized##if#(#m#!=#null#)#{##//map the names#String#[#]#newname#=#m#.#mapFileName#(#name#)#;##if#(#newname#!=#null#)#{#name#=#newname#[#0#]#;#}#}##properties#.#setProperty#(#name#,#value#)#;#}#}##return#properties#;#}