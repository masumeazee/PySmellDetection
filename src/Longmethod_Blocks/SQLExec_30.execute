void#execute#(#)#throws#BuildException#{#Vector#savedTransaction#=#(#Vector#)#transactions#.#clone#(#)#;#String#savedSqlCommand#=#sqlCommand#;#sqlCommand#=#sqlCommand#.#trim#(#)#;##try#{##if#(#srcFile#==#null#&&#sqlCommand#.#length#(#)#==#0#&&#resources#==#null#)#{##if#(#transactions#.#size#(#)#==#0#)#{#throw#new#BuildException#(#"Source file or resource collection, "#+#"transactions or sql statement "#+#"must be set!"#,#getLocation#(#)#)#;#}#}##if#(#srcFile#!=#null#&&#!#srcFile#.#isFile#(#)#)#{#throw#new#BuildException#(#"Source file "#+#srcFile#+#" is not a file!"#,#getLocation#(#)#)#;#}##if#(#resources#!=#null#)#{##// deal with the resources#Iterator#iter#=#resources#.#iterator#(#)#;##while#(#iter#.#hasNext#(#)#)#{#Resource#r#=#(#Resource#)#iter#.#next#(#)#;##// Make a transaction for each resource#Transaction#t#=#createTransaction#(#)#;#t#.#setSrcResource#(#r#)#;#}#}##// Make a transaction group for the outer command#Transaction#t#=#createTransaction#(#)#;#t#.#setSrc#(#srcFile#)#;#t#.#addText#(#sqlCommand#)#;##if#(#getConnection#(#)#==#null#)#{##// not a valid rdbms##return#;#}##try#{#PrintStream#out#=#KeepAliveOutputStream#.#wrapSystemOut#(#)#;##try#{##if#(#output#!=#null#)#{#log#(#"Opening PrintStream to output Resource "#+#output#,#Project#.#MSG_VERBOSE#)#;#OutputStream#os#=#null#;#FileProvider#fp#=#(#FileProvider#)#output#.#as#(#FileProvider#.#class#)#;##if#(#fp#!=#null#)#{#os#=#new#FileOutputStream#(#fp#.#getFile#(#)#,#append#)#;#}#else#{##if#(#append#)#{#Appendable#a#=#(#Appendable#)#output#.#as#(#Appendable#.#class#)#;##if#(#a#!=#null#)#{#os#=#a#.#getAppendOutputStream#(#)#;#}#}##if#(#os#==#null#)#{#os#=#output#.#getOutputStream#(#)#;##if#(#append#)#{#log#(#"Ignoring append=true for non-appendable"#+#" resource "#+#output#,#Project#.#MSG_WARN#)#;#}#}#}##out#=#new#PrintStream#(#new#BufferedOutputStream#(#os#)#)#;#}##// Process all transactions#for#(#Enumeration#e#=#transactions#.#elements#(#)#;##e#.#hasMoreElements#(#)#;#)#{#(#(#Transaction#)#e#.#nextElement#(#)#)#.#runTransaction#(#out#)#;##if#(#!#isAutocommit#(#)#)#{#log#(#"Committing transaction"#,#Project#.#MSG_VERBOSE#)#;#getConnection#(#)#.#commit#(#)#;#}#}#}##finally#{#FileUtils#.#close#(#out#)#;#}#}##catch#(#IOException#e#)#{#closeQuietly#(#)#;#setErrorProperty#(#)#;##if#(#onError#.#equals#(#"abort"#)#)#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#}##catch#(#SQLException#e#)#{#closeQuietly#(#)#;#setErrorProperty#(#)#;##if#(#onError#.#equals#(#"abort"#)#)#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#}##finally#{#try#{##if#(#getStatement#(#)#!=#null#)#{#getStatement#(#)#.#close#(#)#;#}#}##catch#(#SQLException#ex#)#{##// ignore#}##try#{##if#(#getConnection#(#)#!=#null#)#{#getConnection#(#)#.#close#(#)#;#}#}##catch#(#SQLException#ex#)#{##// ignore#}#}##log#(#goodSql#+#" of "#+#totalSql#+#" SQL statements executed successfully"#)#;#}##finally#{#transactions#=#savedTransaction#;#sqlCommand#=#savedSqlCommand#;#}#}