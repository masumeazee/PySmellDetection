void#startRemoteCpProtocol#(#InputStream#in#,#OutputStream#out#,#File#localFile#)#throws#IOException#,#JSchException#{#File#startFile#=#localFile#;##while#(#true#)#{##// C0644 filesize filename - header for a regular file##// T time 0 time 0\n - present if perserve time.##// D directory - this is the header for a directory.#ByteArrayOutputStream#stream#=#new#ByteArrayOutputStream#(#)#;##while#(#true#)#{#int#read#=#in#.#read#(#)#;##if#(#read#<#0#)#{##return#;#}##if#(#(#byte#)#read#==#LINE_FEED#)#{#break#;#}##stream#.#write#(#read#)#;#}##String#serverResponse#=#stream#.#toString#(#"UTF-8"#)#;##if#(#serverResponse#.#charAt#(#0#)#==#'C'#)#{#parseAndFetchFile#(#serverResponse#,#startFile#,#out#,#in#)#;#}#else##if#(#serverResponse#.#charAt#(#0#)#==#'D'#)#{#startFile#=#parseAndCreateDirectory#(#serverResponse#,#startFile#)#;#sendAck#(#out#)#;#}#else##if#(#serverResponse#.#charAt#(#0#)#==#'E'#)#{#startFile#=#startFile#.#getParentFile#(#)#;#sendAck#(#out#)#;#}#else##if#(#serverResponse#.#charAt#(#0#)#==#'\01'#||#serverResponse#.#charAt#(#0#)#==#'\02'#)#{##// this indicates an error.#throw#new#IOException#(#serverResponse#.#substring#(#1#)#)#;#}#}#}