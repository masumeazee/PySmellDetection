void#execute#(#)#{##if#(#name#==#null#)#{#throw#new#BuildException#(#"scriptdef requires a name attribute to "#+#"name the script"#)#;#}##if#(#helper#.#getLanguage#(#)#==#null#)#{#throw#new#BuildException#(#"<scriptdef> requires a language attribute "#+#"to specify the script language"#)#;#}##// Check if need to set the loader##if#(#getAntlibClassLoader#(#)#!=#null#||#hasCpDelegate#(#)#)#{#helper#.#setClassLoader#(#createLoader#(#)#)#;#}##attributeSet#=#new#HashSet#(#)#;##for#(#Iterator#i#=#attributes#.#iterator#(#)#;##i#.#hasNext#(#)#;#)#{#Attribute#attribute#=#(#Attribute#)#i#.#next#(#)#;##if#(#attribute#.#name#==#null#)#{#throw#new#BuildException#(#"scriptdef <attribute> elements "#+#"must specify an attribute name"#)#;#}##if#(#attributeSet#.#contains#(#attribute#.#name#)#)#{#throw#new#BuildException#(#"scriptdef <"#+#name#+#"> declares "#+#"the "#+#attribute#.#name#+#" attribute more than once"#)#;#}##attributeSet#.#add#(#attribute#.#name#)#;#}##nestedElementMap#=#new#HashMap#(#)#;##for#(#Iterator#i#=#nestedElements#.#iterator#(#)#;##i#.#hasNext#(#)#;#)#{#NestedElement#nestedElement#=#(#NestedElement#)#i#.#next#(#)#;##if#(#nestedElement#.#name#==#null#)#{#throw#new#BuildException#(#"scriptdef <element> elements "#+#"must specify an element name"#)#;#}##if#(#nestedElementMap#.#containsKey#(#nestedElement#.#name#)#)#{#throw#new#BuildException#(#"scriptdef <"#+#name#+#"> declares "#+#"the "#+#nestedElement#.#name#+#" nested element more "#+#"than once"#)#;#}##if#(#nestedElement#.#className#==#null#&&#nestedElement#.#type#==#null#)#{#throw#new#BuildException#(#"scriptdef <element> elements "#+#"must specify either a classname or type attribute"#)#;#}##if#(#nestedElement#.#className#!=#null#&&#nestedElement#.#type#!=#null#)#{#throw#new#BuildException#(#"scriptdef <element> elements "#+#"must specify only one of the classname and type "#+#"attributes"#)#;#}##nestedElementMap#.#put#(#nestedElement#.#name#,#nestedElement#)#;#}##// find the script repository - it is stored in the project#Map#scriptRepository#=#lookupScriptRepository#(#)#;#name#=#ProjectHelper#.#genComponentName#(#getURI#(#)#,#name#)#;#scriptRepository#.#put#(#name#,#this#)#;#AntTypeDefinition#def#=#new#AntTypeDefinition#(#)#;#def#.#setName#(#name#)#;#def#.#setClass#(#ScriptDefBase#.#class#)#;#ComponentHelper#.#getComponentHelper#(#getProject#(#)#)#.#addDataTypeDefinition#(#def#)#;#}