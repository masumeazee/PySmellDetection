void#signOneJar#(#File#jarSource#,#File#jarTarget#)#throws#BuildException#{#File#targetFile#=#jarTarget#;##if#(#targetFile#==#null#)#{#targetFile#=#jarSource#;#}##if#(#isUpToDate#(#jarSource#,#targetFile#)#)#{##return#;#}##long#lastModified#=#jarSource#.#lastModified#(#)#;#final#ExecTask#cmd#=#createJarSigner#(#)#;#setCommonOptions#(#cmd#)#;#bindToKeystore#(#cmd#)#;##if#(#null#!=#sigfile#)#{#addValue#(#cmd#,#"-sigfile"#)#;#String#value#=#this#.#sigfile#;#addValue#(#cmd#,#value#)#;#}##//DO NOT SET THE -signedjar OPTION if source==dest##//unless you like fielding hotspot crash reports##if#(#!#jarSource#.#equals#(#targetFile#)#)#{#addValue#(#cmd#,#"-signedjar"#)#;#addValue#(#cmd#,#targetFile#.#getPath#(#)#)#;#}##if#(#internalsf#)#{#addValue#(#cmd#,#"-internalsf"#)#;#}##if#(#sectionsonly#)#{#addValue#(#cmd#,#"-sectionsonly"#)#;#}##//add -tsa operations if declared#addTimestampAuthorityCommands#(#cmd#)#;##//JAR source is required#addValue#(#cmd#,#jarSource#.#getPath#(#)#)#;##//alias is required for signing#addValue#(#cmd#,#alias#)#;#log#(#"Signing JAR: "#+#jarSource#.#getAbsolutePath#(#)#+#" to "#+#targetFile#.#getAbsolutePath#(#)#+#" as "#+#alias#)#;#cmd#.#execute#(#)#;##// restore the lastModified attribute##if#(#preserveLastModified#)#{#targetFile#.#setLastModified#(#lastModified#)#;#}#}