void#tarResource#(#Resource#r#,#TarOutputStream#tOut#,#String#vPath#,#TarFileSet#tarFileSet#)#throws#IOException#{##if#(#!#r#.#isExists#(#)#)#{##return#;#}##boolean#preserveLeadingSlashes#=#false#;##if#(#tarFileSet#!=#null#)#{#String#fullpath#=#tarFileSet#.#getFullpath#(#this#.#getProject#(#)#)#;##if#(#fullpath#.#length#(#)#>#0#)#{#vPath#=#fullpath#;#}#else#{##// don't add "" to the archive##if#(#vPath#.#length#(#)#<=#0#)#{##return#;#}##String#prefix#=#tarFileSet#.#getPrefix#(#this#.#getProject#(#)#)#;##// '/' is appended for compatibility with the zip task.##if#(#prefix#.#length#(#)#>#0#&&#!#prefix#.#endsWith#(#"/"#)#)#{#prefix#=#prefix#+#"/"#;#}##vPath#=#prefix#+#vPath#;#}##preserveLeadingSlashes#=#tarFileSet#.#getPreserveLeadingSlashes#(#)#;##if#(#vPath#.#startsWith#(#"/"#)#&&#!#preserveLeadingSlashes#)#{#int#l#=#vPath#.#length#(#)#;##if#(#l#<=#1#)#{##// we would end up adding "" to the archive##return#;#}##vPath#=#vPath#.#substring#(#1#,#l#)#;#}#}##if#(#r#.#isDirectory#(#)#&&#!#vPath#.#endsWith#(#"/"#)#)#{#vPath#+=#"/"#;#}##if#(#vPath#.#length#(#)#>=#TarConstants#.#NAMELEN#)#{##if#(#longFileMode#.#isOmitMode#(#)#)#{#log#(#"Omitting: "#+#vPath#,#Project#.#MSG_INFO#)#;##return#;#}#else##if#(#longFileMode#.#isWarnMode#(#)#)#{#log#(#"Entry: "#+#vPath#+#" longer than "#+#TarConstants#.#NAMELEN#+#" characters."#,#Project#.#MSG_WARN#)#;##if#(#!#longWarningGiven#)#{#log#(#"Resulting tar file can only be processed "#+#"successfully by GNU compatible tar commands"#,#Project#.#MSG_WARN#)#;#longWarningGiven#=#true#;#}#}#else##if#(#longFileMode#.#isFailMode#(#)#)#{#throw#new#BuildException#(#"Entry: "#+#vPath#+#" longer than "#+#TarConstants#.#NAMELEN#+#"characters."#,#getLocation#(#)#)#;#}#}##TarEntry#te#=#new#TarEntry#(#vPath#,#preserveLeadingSlashes#)#;#te#.#setModTime#(#r#.#getLastModified#(#)#)#;##// preserve permissions##if#(#r#instanceof#ArchiveResource#)#{#ArchiveResource#ar#=#(#ArchiveResource#)#r#;#te#.#setMode#(#ar#.#getMode#(#)#)#;##if#(#r#instanceof#TarResource#)#{#TarResource#tr#=#(#TarResource#)#r#;#te#.#setUserName#(#tr#.#getUserName#(#)#)#;#te#.#setUserId#(#tr#.#getUid#(#)#)#;#te#.#setGroupName#(#tr#.#getGroup#(#)#)#;#te#.#setGroupId#(#tr#.#getGid#(#)#)#;#}#}##if#(#!#r#.#isDirectory#(#)#)#{##if#(#r#.#size#(#)#>#TarConstants#.#MAXSIZE#)#{#throw#new#BuildException#(#"Resource: "#+#r#+#" larger than "#+#TarConstants#.#MAXSIZE#+#" bytes."#)#;#}##te#.#setSize#(#r#.#getSize#(#)#)#;##// override permissions if set explicitly##if#(#tarFileSet#!=#null#&&#tarFileSet#.#hasFileModeBeenSet#(#)#)#{#te#.#setMode#(#tarFileSet#.#getMode#(#)#)#;#}#}#else##if#(#tarFileSet#!=#null#&&#tarFileSet#.#hasDirModeBeenSet#(#)#)#{##// override permissions if set explicitly#te#.#setMode#(#tarFileSet#.#getDirMode#(#this#.#getProject#(#)#)#)#;#}##if#(#tarFileSet#!=#null#)#{##// only override permissions if set explicitly##if#(#tarFileSet#.#hasUserNameBeenSet#(#)#)#{#te#.#setUserName#(#tarFileSet#.#getUserName#(#)#)#;#}##if#(#tarFileSet#.#hasGroupBeenSet#(#)#)#{#te#.#setGroupName#(#tarFileSet#.#getGroup#(#)#)#;#}##if#(#tarFileSet#.#hasUserIdBeenSet#(#)#)#{#te#.#setUserId#(#tarFileSet#.#getUid#(#)#)#;#}##if#(#tarFileSet#.#hasGroupIdBeenSet#(#)#)#{#te#.#setGroupId#(#tarFileSet#.#getGid#(#)#)#;#}#}##InputStream#in#=#null#;##try#{#tOut#.#putNextEntry#(#te#)#;##if#(#!#r#.#isDirectory#(#)#)#{#in#=#r#.#getInputStream#(#)#;#byte#[#]#buffer#=#new#byte#[#BUFFER_SIZE#]#;#int#count#=#0#;##do#{#tOut#.#write#(#buffer#,#0#,#count#)#;#count#=#in#.#read#(#buffer#,#0#,#buffer#.#length#)#;#}##while#(#count#!=#-#1#)#;#}##tOut#.#closeEntry#(#)#;#}##finally#{#FileUtils#.#close#(#in#)#;#}#}