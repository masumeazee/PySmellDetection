Source#resolve#(#String#href#,#String#base#)#throws#TransformerException#{##if#(#isReference#(#)#)#{##return#getRef#(#)#.#resolve#(#href#,#base#)#;#}##dieOnCircularReference#(#)#;#SAXSource#source#=#null#;#String#uri#=#removeFragment#(#href#)#;#log#(#"resolve: '"#+#uri#+#"' with base: '"#+#base#+#"'"#,#Project#.#MSG_DEBUG#)#;#source#=#(#SAXSource#)#getCatalogResolver#(#)#.#resolve#(#uri#,#base#)#;##if#(#source#==#null#)#{#log#(#"No matching catalog entry found, parser will use: '"#+#href#+#"'"#,#Project#.#MSG_DEBUG#)#;##//##// Cannot return a null source, because we have to call##// setEntityResolver (see setEntityResolver javadoc comment)##//#source#=#new#SAXSource#(#)#;#URL#baseURL#=#null#;##try#{##if#(#base#==#null#)#{#baseURL#=#FILE_UTILS#.#getFileURL#(#getProject#(#)#.#getBaseDir#(#)#)#;#}#else#{#baseURL#=#new#URL#(#base#)#;#}##URL#url#=#(#uri#.#length#(#)#==#0#?#baseURL#:#new#URL#(#baseURL#,#uri#)#)#;#source#.#setInputSource#(#new#InputSource#(#url#.#toString#(#)#)#)#;#}##catch#(#MalformedURLException#ex#)#{##// At this point we are probably in failure mode, but##// try to use the bare URI as a last gasp#source#.#setInputSource#(#new#InputSource#(#uri#)#)#;#}#}##setEntityResolver#(#source#)#;##return#source#;#}