void#doTest#(#String#msg#,#boolean#keepRoot#,#boolean#collapse#,#boolean#semantic#,#boolean#include#,#boolean#localRoot#)#{#Enumeration#iter#=#getFiles#(#new#File#(#System#.#getProperty#(#"root"#)#,#"src/etc/testcases/taskdefs/xmlproperty/inputs"#)#)#;##while#(#iter#.#hasMoreElements#(#)#)#{#File#inputFile#=#(#File#)#iter#.#nextElement#(#)#;##// What's the working directory?  If local, then its the##// folder of the input file.  Otherwise, its the "current" dir..#File#workingDir#;##if#(#localRoot#)#{#workingDir#=#inputFile#.#getParentFile#(#)#;#}#else#{#workingDir#=#FILE_UTILS#.#resolveFile#(#new#File#(#"."#)#,#"."#)#;#}##try#{#File#propertyFile#=#getGoldfile#(#inputFile#,#keepRoot#,#collapse#,#semantic#,#include#,#localRoot#)#;##if#(#!#propertyFile#.#exists#(#)#)#{##//                    System.out.println("Skipping as "##//                                       + propertyFile.getAbsolutePath()##//                                       + ") doesn't exist.");#continue#;#}##//                System.out.println(msg + " (" + propertyFile.getName() + ") in (" + workingDir + ")");#Project#p#=#new#Project#(#)#;#XmlProperty#xmlproperty#=#new#XmlProperty#(#)#;#xmlproperty#.#setProject#(#p#)#;#xmlproperty#.#setFile#(#inputFile#)#;#xmlproperty#.#setKeeproot#(#keepRoot#)#;#xmlproperty#.#setCollapseAttributes#(#collapse#)#;#xmlproperty#.#setSemanticAttributes#(#semantic#)#;#xmlproperty#.#setIncludeSemanticAttribute#(#include#)#;#xmlproperty#.#setRootDirectory#(#workingDir#)#;##// Set a property on the project to make sure that loading##// a property with the same name from an xml file will##// *not* change it.#p#.#setNewProperty#(#"override.property.test"#,#"foo"#)#;#xmlproperty#.#execute#(#)#;#Properties#props#=#new#Properties#(#)#;#props#.#load#(#new#FileInputStream#(#propertyFile#)#)#;##//printProperties(p.getProperties());#ensureProperties#(#msg#,#inputFile#,#workingDir#,#p#,#props#)#;#ensureReferences#(#msg#,#inputFile#,#p#.#getReferences#(#)#)#;#}##catch#(#IOException#ex#)#{#fail#(#ex#.#toString#(#)#)#;#}#}#}