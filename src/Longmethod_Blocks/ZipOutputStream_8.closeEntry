void#closeEntry#(#)#throws#IOException#{##if#(#entry#==#null#)#{##return#;#}##long#realCrc#=#crc#.#getValue#(#)#;#crc#.#reset#(#)#;##if#(#entry#.#getMethod#(#)#==#DEFLATED#)#{#def#.#finish#(#)#;##while#(#!#def#.#finished#(#)#)#{#deflate#(#)#;#}##entry#.#setSize#(#adjustToLong#(#def#.#getTotalIn#(#)#)#)#;#entry#.#setCompressedSize#(#adjustToLong#(#def#.#getTotalOut#(#)#)#)#;#entry#.#setCrc#(#realCrc#)#;#def#.#reset#(#)#;#written#+=#entry#.#getCompressedSize#(#)#;#}#else##if#(#raf#==#null#)#{##if#(#entry#.#getCrc#(#)#!=#realCrc#)#{#throw#new#ZipException#(#"bad CRC checksum for entry "#+#entry#.#getName#(#)#+#": "#+#Long#.#toHexString#(#entry#.#getCrc#(#)#)#+#" instead of "#+#Long#.#toHexString#(#realCrc#)#)#;#}##if#(#entry#.#getSize#(#)#!=#written#-#dataStart#)#{#throw#new#ZipException#(#"bad size for entry "#+#entry#.#getName#(#)#+#": "#+#entry#.#getSize#(#)#+#" instead of "#+#(#written#-#dataStart#)#)#;#}#}#else#{##/* method is STORED and we used RandomAccessFile */#long#size#=#written#-#dataStart#;#entry#.#setSize#(#size#)#;#entry#.#setCompressedSize#(#size#)#;#entry#.#setCrc#(#realCrc#)#;#}##// If random access output, write the local file header containing##// the correct CRC and compressed/uncompressed sizes##if#(#raf#!=#null#)#{#long#save#=#raf#.#getFilePointer#(#)#;#raf#.#seek#(#localDataStart#)#;#writeOut#(#ZipLong#.#getBytes#(#entry#.#getCrc#(#)#)#)#;#writeOut#(#ZipLong#.#getBytes#(#entry#.#getCompressedSize#(#)#)#)#;#writeOut#(#ZipLong#.#getBytes#(#entry#.#getSize#(#)#)#)#;#raf#.#seek#(#save#)#;#}##writeDataDescriptor#(#entry#)#;#entry#=#null#;#}