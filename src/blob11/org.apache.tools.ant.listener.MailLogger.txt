void#buildFinished#(#BuildEvent#event#)#{#super#.#buildFinished#(#event#)#;#Project#project#=#event#.#getProject#(#)#;#Hashtable#properties#=#project#.#getProperties#(#)#;#// overlay specified properties file (if any), which overrides project#// settings#Properties#fileProperties#=#new#Properties#(#)#;#String#filename#=#(#String#)#properties#.#get#(#"MailLogger.properties.file"#)#;#if#(#filename#!=#null#)#{#InputStream#is#=#null#;#try#{#is#=#new#FileInputStream#(#filename#)#;#fileProperties#.#load#(#is#)#;#}#catch#(#IOException#ioe#)#{#// ignore because properties file is not required#}#finally#{#FileUtils#.#close#(#is#)#;#}#}#for#(#Enumeration#e#=#fileProperties#.#keys#(#)#;#e#.#hasMoreElements#(#)#;#)#{#String#key#=#(#String#)#e#.#nextElement#(#)#;#String#value#=#fileProperties#.#getProperty#(#key#)#;#properties#.#put#(#key#,#project#.#replaceProperties#(#value#)#)#;#}#boolean#success#=#(#event#.#getException#(#)#==#null#)#;#String#prefix#=#success#?#"success"#:#"failure"#;#try#{#boolean#notify#=#Project#.#toBoolean#(#getValue#(#properties#,#prefix#+#".notify"#,#"on"#)#)#;#if#(#!#notify#)#{#return#;#}#Values#values#=#new#Values#(#)#.#mailhost#(#getValue#(#properties#,#"mailhost"#,#"localhost"#)#)#.#port#(#Integer#.#parseInt#(#getValue#(#properties#,#"port"#,#String#.#valueOf#(#MailMessage#.#DEFAULT_PORT#)#)#)#)#.#user#(#getValue#(#properties#,#"user"#,#""#)#)#.#password#(#getValue#(#properties#,#"password"#,#""#)#)#.#ssl#(#Project#.#toBoolean#(#getValue#(#properties#,#"ssl"#,#"off"#)#)#)#.#starttls#(#Project#.#toBoolean#(#getValue#(#properties#,#"starttls.enable"#,#"off"#)#)#)#.#from#(#getValue#(#properties#,#"from"#,#null#)#)#.#replytoList#(#getValue#(#properties#,#"replyto"#,#""#)#)#.#toList#(#getValue#(#properties#,#prefix#+#".to"#,#null#)#)#.#mimeType#(#getValue#(#properties#,#"mimeType"#,#DEFAULT_MIME_TYPE#)#)#.#charset#(#getValue#(#properties#,#"charset"#,#""#)#)#.#body#(#getValue#(#properties#,#prefix#+#".body"#,#""#)#)#.#subject#(#getValue#(#properties#,#prefix#+#".subject"#,#(#success#)#?#"Build Success"#:#"Build Failure"#)#)#;#if#(#values#.#user#(#)#.#equals#(#""#)#&&#values#.#password#(#)#.#equals#(#""#)#&&#!#values#.#ssl#(#)#&&#!#values#.#starttls#(#)#)#{#sendMail#(#values#,#buffer#.#substring#(#0#)#)#;#}#else#{#sendMimeMail#(#event#.#getProject#(#)#,#values#,#buffer#.#substring#(#0#)#)#;#}#}#catch#(#Exception#e#)#{#System#.#out#.#println#(#"MailLogger failed to send e-mail!"#)#;#e#.#printStackTrace#(#System#.#err#)#;#}#}##String#mailhost#(#)#{#return#mailhost#;#}##Values#mailhost#(#String#mailhost#)#{#this#.#mailhost#=#mailhost#;#return#this#;#}##int#port#(#)#{#return#port#;#}##Values#port#(#int#port#)#{#this#.#port#=#port#;#return#this#;#}##String#user#(#)#{#return#user#;#}##Values#user#(#String#user#)#{#this#.#user#=#user#;#return#this#;#}##String#password#(#)#{#return#password#;#}##Values#password#(#String#password#)#{#this#.#password#=#password#;#return#this#;#}##boolean#ssl#(#)#{#return#ssl#;#}##Values#ssl#(#boolean#ssl#)#{#this#.#ssl#=#ssl#;#return#this#;#}##String#from#(#)#{#return#from#;#}##Values#from#(#String#from#)#{#this#.#from#=#from#;#return#this#;#}##String#replytoList#(#)#{#return#replytoList#;#}##Values#replytoList#(#String#replytoList#)#{#this#.#replytoList#=#replytoList#;#return#this#;#}##String#toList#(#)#{#return#toList#;#}##Values#toList#(#String#toList#)#{#this#.#toList#=#toList#;#return#this#;#}##String#subject#(#)#{#return#subject#;#}##Values#subject#(#String#subject#)#{#this#.#subject#=#subject#;#return#this#;#}##String#charset#(#)#{#return#charset#;#}##Values#charset#(#String#charset#)#{#this#.#charset#=#charset#;#return#this#;#}##String#mimeType#(#)#{#return#mimeType#;#}##Values#mimeType#(#String#mimeType#)#{#this#.#mimeType#=#mimeType#;#return#this#;#}##String#body#(#)#{#return#body#;#}##Values#body#(#String#body#)#{#this#.#body#=#body#;#return#this#;#}##boolean#starttls#(#)#{#return#starttls#;#}##Values#starttls#(#boolean#starttls#)#{#this#.#starttls#=#starttls#;#return#this#;#}##void#log#(#String#message#)#{#buffer#.#append#(#message#)#.#append#(#StringUtils#.#LINE_SEP#)#;#}##String#getValue#(#Hashtable#properties#,#String#name#,#String#defaultValue#)#throws#Exception#{#String#propertyName#=#"MailLogger."#+#name#;#String#value#=#(#String#)#properties#.#get#(#propertyName#)#;#if#(#value#==#null#)#{#value#=#defaultValue#;#}#if#(#value#==#null#)#{#throw#new#Exception#(#"Missing required parameter: "#+#propertyName#)#;#}#return#value#;#}##void#sendMail#(#Values#values#,#String#message#)#throws#IOException#{#MailMessage#mailMessage#=#new#MailMessage#(#values#.#mailhost#(#)#,#values#.#port#(#)#)#;#mailMessage#.#setHeader#(#"Date"#,#DateUtils#.#getDateForHeader#(#)#)#;#mailMessage#.#from#(#values#.#from#(#)#)#;#if#(#!#values#.#replytoList#(#)#.#equals#(#""#)#)#{#StringTokenizer#t#=#new#StringTokenizer#(#values#.#replytoList#(#)#,#", "#,#false#)#;#while#(#t#.#hasMoreTokens#(#)#)#{#mailMessage#.#replyto#(#t#.#nextToken#(#)#)#;#}#}#StringTokenizer#t#=#new#StringTokenizer#(#values#.#toList#(#)#,#", "#,#false#)#;#while#(#t#.#hasMoreTokens#(#)#)#{#mailMessage#.#to#(#t#.#nextToken#(#)#)#;#}#mailMessage#.#setSubject#(#values#.#subject#(#)#)#;#if#(#values#.#charset#(#)#.#length#(#)#>#0#)#{#mailMessage#.#setHeader#(#"Content-Type"#,#values#.#mimeType#(#)#+#"; charset=\""#+#values#.#charset#(#)#+#"\""#)#;#}#else#{#mailMessage#.#setHeader#(#"Content-Type"#,#values#.#mimeType#(#)#)#;#}#PrintStream#ps#=#mailMessage#.#getPrintStream#(#)#;#ps#.#println#(#values#.#body#(#)#.#length#(#)#>#0#?#values#.#body#(#)#:#message#)#;#mailMessage#.#sendAndClose#(#)#;#}##void#sendMimeMail#(#Project#project#,#Values#values#,#String#message#)#{#Mailer#mailer#=#null#;#try#{#mailer#=#(#Mailer#)#ClasspathUtils#.#newInstance#(#"org.apache.tools.ant.taskdefs.email.MimeMailer"#,#MailLogger#.#class#.#getClassLoader#(#)#,#Mailer#.#class#)#;#}#catch#(#BuildException#e#)#{#Throwable#t#=#e#.#getCause#(#)#==#null#?#e#:#e#.#getCause#(#)#;#log#(#"Failed to initialise MIME mail: "#+#t#.#getMessage#(#)#)#;#return#;#}#// convert the replyTo string into a vector of emailaddresses#Vector#replyToList#=#vectorizeEmailAddresses#(#values#.#replytoList#(#)#)#;#mailer#.#setHost#(#values#.#mailhost#(#)#)#;#mailer#.#setPort#(#values#.#port#(#)#)#;#mailer#.#setUser#(#values#.#user#(#)#)#;#mailer#.#setPassword#(#values#.#password#(#)#)#;#mailer#.#setSSL#(#values#.#ssl#(#)#)#;#mailer#.#setEnableStartTLS#(#values#.#ssl#(#)#)#;#Message#mymessage#=#new#Message#(#values#.#body#(#)#.#length#(#)#>#0#?#values#.#body#(#)#:#message#)#;#mymessage#.#setProject#(#project#)#;#mymessage#.#setMimeType#(#values#.#mimeType#(#)#)#;#if#(#values#.#charset#(#)#.#length#(#)#>#0#)#{#mymessage#.#setCharset#(#values#.#charset#(#)#)#;#}#mailer#.#setMessage#(#mymessage#)#;#mailer#.#setFrom#(#new#EmailAddress#(#values#.#from#(#)#)#)#;#mailer#.#setReplyToList#(#replyToList#)#;#Vector#toList#=#vectorizeEmailAddresses#(#values#.#toList#(#)#)#;#mailer#.#setToList#(#toList#)#;#mailer#.#setCcList#(#new#Vector#(#)#)#;#mailer#.#setBccList#(#new#Vector#(#)#)#;#mailer#.#setFiles#(#new#Vector#(#)#)#;#mailer#.#setSubject#(#values#.#subject#(#)#)#;#mailer#.#setHeaders#(#new#Vector#(#)#)#;#mailer#.#send#(#)#;#}##Vector#vectorizeEmailAddresses#(#String#listString#)#{#Vector#emailList#=#new#Vector#(#)#;#StringTokenizer#tokens#=#new#StringTokenizer#(#listString#,#","#)#;#while#(#tokens#.#hasMoreTokens#(#)#)#{#emailList#.#addElement#(#new#EmailAddress#(#tokens#.#nextToken#(#)#)#)#;#}#return#emailList#;#}##