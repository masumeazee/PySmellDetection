void#setEarfile#(#File#earFile#)#{#setDestFile#(#earFile#)#;#}##void#setAppxml#(#File#descr#)#{#deploymentDescriptor#=#descr#;#if#(#!#deploymentDescriptor#.#exists#(#)#)#{#throw#new#BuildException#(#"Deployment descriptor: "#+#deploymentDescriptor#+#" does not exist."#)#;#}#// Create a ZipFileSet for this file, and pass it up.#ZipFileSet#fs#=#new#ZipFileSet#(#)#;#fs#.#setFile#(#deploymentDescriptor#)#;#fs#.#setFullpath#(#XML_DESCRIPTOR_PATH#)#;#super#.#addFileset#(#fs#)#;#}##void#addArchives#(#ZipFileSet#fs#)#{#// We just set the prefix for this fileset, and pass it up.#// Do we need to do this? LH#fs#.#setPrefix#(#"/"#)#;#super#.#addFileset#(#fs#)#;#}##void#initZipOutputStream#(#ZipOutputStream#zOut#)#throws#IOException#,#BuildException#{#// If no webxml file is specified, it's an error.#if#(#deploymentDescriptor#==#null#&&#!#isInUpdateMode#(#)#)#{#throw#new#BuildException#(#"appxml attribute is required"#,#getLocation#(#)#)#;#}#super#.#initZipOutputStream#(#zOut#)#;#}##void#zipFile#(#File#file#,#ZipOutputStream#zOut#,#String#vPath#,#int#mode#)#throws#IOException#{#// If the file being added is META-INF/application.xml, we#// warn if it's not the one specified in the "appxml"#// attribute - or if it's being added twice, meaning the same#// file is specified by the "appxml" attribute and in a#// <fileset> element.#String#vPathLowerCase#=#vPath#.#toLowerCase#(#Locale#.#ENGLISH#)#;#if#(#XML_DESCRIPTOR_PATH#.#equals#(#vPathLowerCase#)#)#{#if#(#deploymentDescriptor#!=#null#||#!#FILE_UTILS#.#fileNameEquals#(#deploymentDescriptor#,#file#)#||#descriptorAdded#)#{#logWhenWriting#(#"Warning: selected "#+#archiveType#+#" files include a "#+#XML_DESCRIPTOR_PATH#+#" which will"#+#" be ignored (please use appxml attribute to "#+#archiveType#+#" task)"#,#Project#.#MSG_WARN#)#;#}#else#{#super#.#zipFile#(#file#,#zOut#,#vPath#,#mode#)#;#descriptorAdded#=#true#;#}#}#else#{#super#.#zipFile#(#file#,#zOut#,#vPath#,#mode#)#;#}#}##void#cleanUp#(#)#{#descriptorAdded#=#false#;#super#.#cleanUp#(#)#;#}##