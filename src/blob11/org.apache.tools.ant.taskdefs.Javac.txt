String#assumedJavaVersion#(#)#{#if#(#JavaEnvUtils#.#isJavaVersion#(#JavaEnvUtils#.#JAVA_1_4#)#)#{#return#JAVAC14#;#}#else#if#(#JavaEnvUtils#.#isJavaVersion#(#JavaEnvUtils#.#JAVA_1_5#)#)#{#return#JAVAC15#;#}#else#if#(#JavaEnvUtils#.#isJavaVersion#(#JavaEnvUtils#.#JAVA_1_6#)#)#{#return#JAVAC16#;#}#else#{#return#CLASSIC#;#}#}##String#getDebugLevel#(#)#{#return#debugLevel#;#}##void#setDebugLevel#(#String#v#)#{#this#.#debugLevel#=#v#;#}##String#getSource#(#)#{#return#source#!=#null#?#source#:#getProject#(#)#.#getProperty#(#MagicNames#.#BUILD_JAVAC_SOURCE#)#;#}##void#setSource#(#String#v#)#{#this#.#source#=#v#;#}##Path#createSrc#(#)#{#if#(#src#==#null#)#{#src#=#new#Path#(#getProject#(#)#)#;#}#return#src#.#createPath#(#)#;#}##Path#recreateSrc#(#)#{#src#=#null#;#return#createSrc#(#)#;#}##void#setSrcdir#(#Path#srcDir#)#{#if#(#src#==#null#)#{#src#=#srcDir#;#}#else#{#src#.#append#(#srcDir#)#;#}#}##Path#getSrcdir#(#)#{#return#src#;#}##void#setDestdir#(#File#destDir#)#{#this#.#destDir#=#destDir#;#}##File#getDestdir#(#)#{#return#destDir#;#}##void#setSourcepath#(#Path#sourcepath#)#{#if#(#compileSourcepath#==#null#)#{#compileSourcepath#=#sourcepath#;#}#else#{#compileSourcepath#.#append#(#sourcepath#)#;#}#}##Path#getSourcepath#(#)#{#return#compileSourcepath#;#}##Path#createSourcepath#(#)#{#if#(#compileSourcepath#==#null#)#{#compileSourcepath#=#new#Path#(#getProject#(#)#)#;#}#return#compileSourcepath#.#createPath#(#)#;#}##void#setSourcepathRef#(#Reference#r#)#{#createSourcepath#(#)#.#setRefid#(#r#)#;#}##void#setClasspath#(#Path#classpath#)#{#if#(#compileClasspath#==#null#)#{#compileClasspath#=#classpath#;#}#else#{#compileClasspath#.#append#(#classpath#)#;#}#}##Path#getClasspath#(#)#{#return#compileClasspath#;#}##Path#createClasspath#(#)#{#if#(#compileClasspath#==#null#)#{#compileClasspath#=#new#Path#(#getProject#(#)#)#;#}#return#compileClasspath#.#createPath#(#)#;#}##void#setClasspathRef#(#Reference#r#)#{#createClasspath#(#)#.#setRefid#(#r#)#;#}##void#setBootclasspath#(#Path#bootclasspath#)#{#if#(#this#.#bootclasspath#==#null#)#{#this#.#bootclasspath#=#bootclasspath#;#}#else#{#this#.#bootclasspath#.#append#(#bootclasspath#)#;#}#}##Path#getBootclasspath#(#)#{#return#bootclasspath#;#}##Path#createBootclasspath#(#)#{#if#(#bootclasspath#==#null#)#{#bootclasspath#=#new#Path#(#getProject#(#)#)#;#}#return#bootclasspath#.#createPath#(#)#;#}##void#setBootClasspathRef#(#Reference#r#)#{#createBootclasspath#(#)#.#setRefid#(#r#)#;#}##void#setExtdirs#(#Path#extdirs#)#{#if#(#this#.#extdirs#==#null#)#{#this#.#extdirs#=#extdirs#;#}#else#{#this#.#extdirs#.#append#(#extdirs#)#;#}#}##Path#getExtdirs#(#)#{#return#extdirs#;#}##Path#createExtdirs#(#)#{#if#(#extdirs#==#null#)#{#extdirs#=#new#Path#(#getProject#(#)#)#;#}#return#extdirs#.#createPath#(#)#;#}##void#setListfiles#(#boolean#list#)#{#listFiles#=#list#;#}##boolean#getListfiles#(#)#{#return#listFiles#;#}##void#setFailonerror#(#boolean#fail#)#{#failOnError#=#fail#;#}##void#setProceed#(#boolean#proceed#)#{#failOnError#=#!#proceed#;#}##boolean#getFailonerror#(#)#{#return#failOnError#;#}##void#setDeprecation#(#boolean#deprecation#)#{#this#.#deprecation#=#deprecation#;#}##boolean#getDeprecation#(#)#{#return#deprecation#;#}##void#setMemoryInitialSize#(#String#memoryInitialSize#)#{#this#.#memoryInitialSize#=#memoryInitialSize#;#}##String#getMemoryInitialSize#(#)#{#return#memoryInitialSize#;#}##void#setMemoryMaximumSize#(#String#memoryMaximumSize#)#{#this#.#memoryMaximumSize#=#memoryMaximumSize#;#}##String#getMemoryMaximumSize#(#)#{#return#memoryMaximumSize#;#}##void#setEncoding#(#String#encoding#)#{#this#.#encoding#=#encoding#;#}##String#getEncoding#(#)#{#return#encoding#;#}##void#setDebug#(#boolean#debug#)#{#this#.#debug#=#debug#;#}##boolean#getDebug#(#)#{#return#debug#;#}##void#setOptimize#(#boolean#optimize#)#{#this#.#optimize#=#optimize#;#}##boolean#getOptimize#(#)#{#return#optimize#;#}##void#setDepend#(#boolean#depend#)#{#this#.#depend#=#depend#;#}##boolean#getDepend#(#)#{#return#depend#;#}##void#setVerbose#(#boolean#verbose#)#{#this#.#verbose#=#verbose#;#}##boolean#getVerbose#(#)#{#return#verbose#;#}##void#setTarget#(#String#target#)#{#this#.#targetAttribute#=#target#;#}##String#getTarget#(#)#{#return#targetAttribute#!=#null#?#targetAttribute#:#getProject#(#)#.#getProperty#(#MagicNames#.#BUILD_JAVAC_TARGET#)#;#}##void#setIncludeantruntime#(#boolean#include#)#{#includeAntRuntime#=#Boolean#.#valueOf#(#include#)#;#}##boolean#getIncludeantruntime#(#)#{#return#includeAntRuntime#!=#null#?#includeAntRuntime#.#booleanValue#(#)#:#true#;#}##void#setIncludejavaruntime#(#boolean#include#)#{#includeJavaRuntime#=#include#;#}##boolean#getIncludejavaruntime#(#)#{#return#includeJavaRuntime#;#}##void#setFork#(#boolean#f#)#{#fork#=#f#;#}##void#setExecutable#(#String#forkExec#)#{#forkedExecutable#=#forkExec#;#}##String#getExecutable#(#)#{#return#forkedExecutable#;#}##boolean#isForkedJavac#(#)#{#return#fork#||#"extJavac"#.#equals#(#getCompiler#(#)#)#;#}##String#getJavacExecutable#(#)#{#if#(#forkedExecutable#==#null#&&#isForkedJavac#(#)#)#{#forkedExecutable#=#getSystemJavac#(#)#;#}#else#if#(#forkedExecutable#!=#null#&&#!#isForkedJavac#(#)#)#{#forkedExecutable#=#null#;#}#return#forkedExecutable#;#}##void#setNowarn#(#boolean#flag#)#{#this#.#nowarn#=#flag#;#}##boolean#getNowarn#(#)#{#return#nowarn#;#}##ImplementationSpecificArgument#createCompilerArg#(#)#{#ImplementationSpecificArgument#arg#=#new#ImplementationSpecificArgument#(#)#;#facade#.#addImplementationArgument#(#arg#)#;#return#arg#;#}##String#[#]#getCurrentCompilerArgs#(#)#{#String#chosen#=#facade#.#getExplicitChoice#(#)#;#try#{#// make sure facade knows about magic properties and fork setting#String#appliedCompiler#=#getCompiler#(#)#;#facade#.#setImplementation#(#appliedCompiler#)#;#String#[#]#result#=#facade#.#getArgs#(#)#;#String#altCompilerName#=#getAltCompilerName#(#facade#.#getImplementation#(#)#)#;#if#(#result#.#length#==#0#&&#altCompilerName#!=#null#)#{#facade#.#setImplementation#(#altCompilerName#)#;#result#=#facade#.#getArgs#(#)#;#}#return#result#;#}#finally#{#facade#.#setImplementation#(#chosen#)#;#}#}##String#getAltCompilerName#(#String#anImplementation#)#{#if#(#JAVAC16#.#equalsIgnoreCase#(#anImplementation#)#||#JAVAC15#.#equalsIgnoreCase#(#anImplementation#)#||#JAVAC14#.#equalsIgnoreCase#(#anImplementation#)#||#JAVAC13#.#equalsIgnoreCase#(#anImplementation#)#)#{#return#MODERN#;#}#if#(#JAVAC12#.#equalsIgnoreCase#(#anImplementation#)#||#JAVAC11#.#equalsIgnoreCase#(#anImplementation#)#)#{#return#CLASSIC#;#}#if#(#MODERN#.#equalsIgnoreCase#(#anImplementation#)#)#{#String#nextSelected#=#assumedJavaVersion#(#)#;#if#(#JAVAC16#.#equalsIgnoreCase#(#nextSelected#)#||#JAVAC15#.#equalsIgnoreCase#(#nextSelected#)#||#JAVAC14#.#equalsIgnoreCase#(#nextSelected#)#||#JAVAC13#.#equalsIgnoreCase#(#nextSelected#)#)#{#return#nextSelected#;#}#}#if#(#CLASSIC#.#equals#(#anImplementation#)#)#{#return#assumedJavaVersion#(#)#;#}#if#(#EXTJAVAC#.#equalsIgnoreCase#(#anImplementation#)#)#{#return#assumedJavaVersion#(#)#;#}#return#null#;#}##void#setTempdir#(#File#tmpDir#)#{#this#.#tmpDir#=#tmpDir#;#}##File#getTempdir#(#)#{#return#tmpDir#;#}##void#setUpdatedProperty#(#String#updatedProperty#)#{#this#.#updatedProperty#=#updatedProperty#;#}##void#setErrorProperty#(#String#errorProperty#)#{#this#.#errorProperty#=#errorProperty#;#}##void#setIncludeDestClasses#(#boolean#includeDestClasses#)#{#this#.#includeDestClasses#=#includeDestClasses#;#}##boolean#isIncludeDestClasses#(#)#{#return#includeDestClasses#;#}##boolean#getTaskSuccess#(#)#{#return#taskSuccess#;#}##Path#createCompilerClasspath#(#)#{#return#facade#.#getImplementationClasspath#(#getProject#(#)#)#;#}##void#add#(#CompilerAdapter#adapter#)#{#if#(#nestedAdapter#!=#null#)#{#throw#new#BuildException#(#"Can't have more than one compiler"#+#" adapter"#)#;#}#nestedAdapter#=#adapter#;#}##void#execute#(#)#throws#BuildException#{#checkParameters#(#)#;#resetFileLists#(#)#;#// scan source directories and dest directory to build up#// compile lists#String#[#]#list#=#src#.#list#(#)#;#for#(#int#i#=#0#;#i#<#list#.#length#;#i#++#)#{#File#srcDir#=#getProject#(#)#.#resolveFile#(#list#[#i#]#)#;#if#(#!#srcDir#.#exists#(#)#)#{#throw#new#BuildException#(#"srcdir \""#+#srcDir#.#getPath#(#)#+#"\" does not exist!"#,#getLocation#(#)#)#;#}#DirectoryScanner#ds#=#this#.#getDirectoryScanner#(#srcDir#)#;#String#[#]#files#=#ds#.#getIncludedFiles#(#)#;#scanDir#(#srcDir#,#destDir#!=#null#?#destDir#:#srcDir#,#files#)#;#}#compile#(#)#;#if#(#updatedProperty#!=#null#&&#taskSuccess#&&#compileList#.#length#!=#0#)#{#getProject#(#)#.#setNewProperty#(#updatedProperty#,#"true"#)#;#}#}##void#resetFileLists#(#)#{#compileList#=#new#File#[#0#]#;#packageInfos#=#new#HashMap#(#)#;#}##void#scanDir#(#File#srcDir#,#File#destDir#,#String#[#]#files#)#{#GlobPatternMapper#m#=#new#GlobPatternMapper#(#)#;#m#.#setFrom#(#"*.java"#)#;#m#.#setTo#(#"*.class"#)#;#SourceFileScanner#sfs#=#new#SourceFileScanner#(#this#)#;#File#[#]#newFiles#=#sfs#.#restrictAsFiles#(#files#,#srcDir#,#destDir#,#m#)#;#if#(#newFiles#.#length#>#0#)#{#lookForPackageInfos#(#srcDir#,#newFiles#)#;#File#[#]#newCompileList#=#new#File#[#compileList#.#length#+#newFiles#.#length#]#;#System#.#arraycopy#(#compileList#,#0#,#newCompileList#,#0#,#compileList#.#length#)#;#System#.#arraycopy#(#newFiles#,#0#,#newCompileList#,#compileList#.#length#,#newFiles#.#length#)#;#compileList#=#newCompileList#;#}#}##File#[#]#getFileList#(#)#{#return#compileList#;#}##boolean#isJdkCompiler#(#String#compilerImpl#)#{#return#MODERN#.#equals#(#compilerImpl#)#||#CLASSIC#.#equals#(#compilerImpl#)#||#JAVAC16#.#equals#(#compilerImpl#)#||#JAVAC15#.#equals#(#compilerImpl#)#||#JAVAC14#.#equals#(#compilerImpl#)#||#JAVAC13#.#equals#(#compilerImpl#)#||#JAVAC12#.#equals#(#compilerImpl#)#||#JAVAC11#.#equals#(#compilerImpl#)#;#}##String#getSystemJavac#(#)#{#return#JavaEnvUtils#.#getJdkExecutable#(#"javac"#)#;#}##void#setCompiler#(#String#compiler#)#{#facade#.#setImplementation#(#compiler#)#;#}##String#getCompiler#(#)#{#String#compilerImpl#=#getCompilerVersion#(#)#;#if#(#fork#)#{#if#(#isJdkCompiler#(#compilerImpl#)#)#{#compilerImpl#=#"extJavac"#;#}#else#{#log#(#"Since compiler setting isn't classic or modern, "#+#"ignoring fork setting."#,#Project#.#MSG_WARN#)#;#}#}#return#compilerImpl#;#}##String#getCompilerVersion#(#)#{#facade#.#setMagicValue#(#getProject#(#)#.#getProperty#(#"build.compiler"#)#)#;#return#facade#.#getImplementation#(#)#;#}##void#checkParameters#(#)#throws#BuildException#{#if#(#src#==#null#)#{#throw#new#BuildException#(#"srcdir attribute must be set!"#,#getLocation#(#)#)#;#}#if#(#src#.#size#(#)#==#0#)#{#throw#new#BuildException#(#"srcdir attribute must be set!"#,#getLocation#(#)#)#;#}#if#(#destDir#!=#null#&&#!#destDir#.#isDirectory#(#)#)#{#throw#new#BuildException#(#"destination directory \""#+#destDir#+#"\" does not exist "#+#"or is not a directory"#,#getLocation#(#)#)#;#}#if#(#includeAntRuntime#==#null#&&#getProject#(#)#.#getProperty#(#"build.sysclasspath"#)#==#null#)#{#log#(#getLocation#(#)#+#"warning: 'includeantruntime' was not set, "#+#"defaulting to build.sysclasspath=last; set to false for repeatable builds"#,#Project#.#MSG_WARN#)#;#}#}##void#compile#(#)#{#String#compilerImpl#=#getCompiler#(#)#;#if#(#compileList#.#length#>#0#)#{#log#(#"Compiling "#+#compileList#.#length#+#" source file"#+#(#compileList#.#length#==#1#?#""#:#"s"#)#+#(#destDir#!=#null#?#" to "#+#destDir#:#""#)#)#;#if#(#listFiles#)#{#for#(#int#i#=#0#;#i#<#compileList#.#length#;#i#++#)#{#String#filename#=#compileList#[#i#]#.#getAbsolutePath#(#)#;#log#(#filename#)#;#}#}#CompilerAdapter#adapter#=#nestedAdapter#!=#null#?#nestedAdapter#:#CompilerAdapterFactory#.#getCompiler#(#compilerImpl#,#this#,#createCompilerClasspath#(#)#)#;#// now we need to populate the compiler adapter#adapter#.#setJavac#(#this#)#;#// finally, lets execute the compiler!!#if#(#adapter#.#execute#(#)#)#{#// Success#try#{#generateMissingPackageInfoClasses#(#)#;#}#catch#(#IOException#x#)#{#// Should this be made a nonfatal warning?#throw#new#BuildException#(#x#,#getLocation#(#)#)#;#}#}#else#{#// Fail path#this#.#taskSuccess#=#false#;#if#(#errorProperty#!=#null#)#{#getProject#(#)#.#setNewProperty#(#errorProperty#,#"true"#)#;#}#if#(#failOnError#)#{#throw#new#BuildException#(#FAIL_MSG#,#getLocation#(#)#)#;#}#else#{#log#(#FAIL_MSG#,#Project#.#MSG_ERR#)#;#}#}#}#}##void#setCompiler#(#String#impl#)#{#super#.#setImplementation#(#impl#)#;#}##void#lookForPackageInfos#(#File#srcDir#,#File#[#]#newFiles#)#{#for#(#int#i#=#0#;#i#<#newFiles#.#length#;#i#++#)#{#File#f#=#newFiles#[#i#]#;#if#(#!#f#.#getName#(#)#.#equals#(#"package-info.java"#)#)#{#continue#;#}#String#path#=#FILE_UTILS#.#removeLeadingPath#(#srcDir#,#f#)#.#replace#(#File#.#separatorChar#,#'/'#)#;#String#suffix#=#"/package-info.java"#;#if#(#!#path#.#endsWith#(#suffix#)#)#{#log#(#"anomalous package-info.java path: "#+#path#,#Project#.#MSG_WARN#)#;#continue#;#}#String#pkg#=#path#.#substring#(#0#,#path#.#length#(#)#-#suffix#.#length#(#)#)#;#packageInfos#.#put#(#pkg#,#new#Long#(#f#.#lastModified#(#)#)#)#;#}#}##void#generateMissingPackageInfoClasses#(#)#throws#IOException#{#for#(#Iterator#i#=#packageInfos#.#entrySet#(#)#.#iterator#(#)#;#i#.#hasNext#(#)#;#)#{#Map#.#Entry#entry#=#(#Map#.#Entry#)#i#.#next#(#)#;#String#pkg#=#(#String#)#entry#.#getKey#(#)#;#Long#sourceLastMod#=#(#Long#)#entry#.#getValue#(#)#;#File#pkgBinDir#=#new#File#(#destDir#,#pkg#.#replace#(#'/'#,#File#.#separatorChar#)#)#;#pkgBinDir#.#mkdirs#(#)#;#File#pkgInfoClass#=#new#File#(#pkgBinDir#,#"package-info.class"#)#;#if#(#pkgInfoClass#.#isFile#(#)#&&#pkgInfoClass#.#lastModified#(#)#>=#sourceLastMod#.#longValue#(#)#)#{#continue#;#}#log#(#"Creating empty "#+#pkgInfoClass#)#;#OutputStream#os#=#new#FileOutputStream#(#pkgInfoClass#)#;#try#{#os#.#write#(#PACKAGE_INFO_CLASS_HEADER#)#;#byte#[#]#name#=#pkg#.#getBytes#(#"UTF-8"#)#;#int#length#=#name#.#length#+#/* "/package-info" */#13#;#os#.#write#(#(#byte#)#length#/#256#)#;#os#.#write#(#(#byte#)#length#%#256#)#;#os#.#write#(#name#)#;#os#.#write#(#PACKAGE_INFO_CLASS_FOOTER#)#;#}#finally#{#os#.#close#(#)#;#}#}#}##