void#setProperty#(#String#property#)#{#this#.#property#=#property#;#}##void#setFile#(#File#file#)#{#add#(#new#FileResource#(#file#)#)#;#}##void#add#(#FileSet#fs#)#{#add#(#(#ResourceCollection#)#fs#)#;#}##void#add#(#ResourceCollection#c#)#{#if#(#c#==#null#)#{#return#;#}#resources#=#(#resources#==#null#)#?#new#Resources#(#)#:#resources#;#resources#.#add#(#c#)#;#}##void#setLength#(#long#ell#)#{#length#=#new#Long#(#ell#)#;#}##void#setWhen#(#When#w#)#{#setWhen#(#(#Comparison#)#w#)#;#}##void#setWhen#(#Comparison#c#)#{#when#=#c#;#}##void#setMode#(#FileMode#m#)#{#this#.#mode#=#m#.#getValue#(#)#;#}##void#setString#(#String#string#)#{#this#.#string#=#string#;#this#.#mode#=#STRING#;#}##void#setTrim#(#boolean#trim#)#{#this#.#trim#=#trim#?#Boolean#.#TRUE#:#Boolean#.#FALSE#;#}##boolean#getTrim#(#)#{#return#trim#!=#null#&&#trim#.#booleanValue#(#)#;#}##void#execute#(#)#{#validate#(#)#;#PrintStream#ps#=#new#PrintStream#(#(#property#!=#null#)#?#(#OutputStream#)#new#PropertyOutputStream#(#getProject#(#)#,#property#)#:#(#OutputStream#)#new#LogOutputStream#(#this#,#Project#.#MSG_INFO#)#)#;#if#(#STRING#.#equals#(#mode#)#)#{#ps#.#print#(#getLength#(#string#,#getTrim#(#)#)#)#;#ps#.#close#(#)#;#}#else#if#(#EACH#.#equals#(#mode#)#)#{#handleResources#(#new#EachHandler#(#ps#)#)#;#}#else#if#(#ALL#.#equals#(#mode#)#)#{#handleResources#(#new#AllHandler#(#ps#)#)#;#}#}##boolean#eval#(#)#{#validate#(#)#;#if#(#length#==#null#)#{#throw#new#BuildException#(#LENGTH_REQUIRED#)#;#}#Long#ell#;#if#(#STRING#.#equals#(#mode#)#)#{#ell#=#new#Long#(#getLength#(#string#,#getTrim#(#)#)#)#;#}#else#{#AccumHandler#h#=#new#AccumHandler#(#)#;#handleResources#(#h#)#;#ell#=#new#Long#(#h#.#getAccum#(#)#)#;#}#return#when#.#evaluate#(#ell#.#compareTo#(#length#)#)#;#}##void#validate#(#)#{#if#(#string#!=#null#)#{#if#(#resources#!=#null#)#{#throw#new#BuildException#(#"the string length function"#+#" is incompatible with the file/resource length function"#)#;#}#if#(#!#(#STRING#.#equals#(#mode#)#)#)#{#throw#new#BuildException#(#"the mode attribute is for use"#+#" with the file/resource length function"#)#;#}#}#else#if#(#resources#!=#null#)#{#if#(#!#(#EACH#.#equals#(#mode#)#||#ALL#.#equals#(#mode#)#)#)#{#throw#new#BuildException#(#"invalid mode setting for"#+#" file/resource length function: \""#+#mode#+#"\""#)#;#}#else#if#(#trim#!=#null#)#{#throw#new#BuildException#(#"the trim attribute is"#+#" for use with the string length function only"#)#;#}#}#else#{#throw#new#BuildException#(#"you must set either the string attribute"#+#" or specify one or more files using the file attribute or"#+#" nested resource collections"#)#;#}#}##void#handleResources#(#Handler#h#)#{#for#(#Iterator#i#=#resources#.#iterator#(#)#;#i#.#hasNext#(#)#;#)#{#Resource#r#=#(#Resource#)#i#.#next#(#)#;#if#(#!#r#.#isExists#(#)#)#{#log#(#r#+#" does not exist"#,#Project#.#MSG_WARN#)#;#}#if#(#r#.#isDirectory#(#)#)#{#log#(#r#+#" is a directory; length may not be meaningful"#,#Project#.#MSG_WARN#)#;#}#h#.#handle#(#r#)#;#}#h#.#complete#(#)#;#}##long#getLength#(#String#s#,#boolean#t#)#{#return#(#t#?#s#.#trim#(#)#:#s#)#.#length#(#)#;#}##String#[#]#getValues#(#)#{#return#MODES#;#}##PrintStream#getPs#(#)#{#return#ps#;#}##void#handle#(#Resource#r#)#;##void#complete#(#)#{#FileUtils#.#close#(#ps#)#;#}##void#handle#(#Resource#r#)#{#getPs#(#)#.#print#(#r#.#toString#(#)#)#;#getPs#(#)#.#print#(#" : "#)#;#//when writing to the log, we'll see what's happening:#long#size#=#r#.#getSize#(#)#;#if#(#size#==#Resource#.#UNKNOWN_SIZE#)#{#getPs#(#)#.#println#(#"unknown"#)#;#}#else#{#getPs#(#)#.#println#(#size#)#;#}#}##long#getAccum#(#)#{#return#accum#;#}##void#handle#(#Resource#r#)#{#long#size#=#r#.#getSize#(#)#;#if#(#size#==#Resource#.#UNKNOWN_SIZE#)#{#log#(#"Size unknown for "#+#r#.#toString#(#)#,#Project#.#MSG_WARN#)#;#}#else#{#accum#+=#size#;#}#}##void#complete#(#)#{#getPs#(#)#.#print#(#getAccum#(#)#)#;#super#.#complete#(#)#;#}##