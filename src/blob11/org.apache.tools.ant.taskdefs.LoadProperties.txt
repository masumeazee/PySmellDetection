void#setSrcFile#(#final#File#srcFile#)#{#addConfigured#(#new#FileResource#(#srcFile#)#)#;#}##void#setResource#(#String#resource#)#{#getRequiredJavaResource#(#)#.#setName#(#resource#)#;#}##void#setEncoding#(#final#String#encoding#)#{#this#.#encoding#=#encoding#;#}##void#setClasspath#(#Path#classpath#)#{#getRequiredJavaResource#(#)#.#setClasspath#(#classpath#)#;#}##Path#createClasspath#(#)#{#return#getRequiredJavaResource#(#)#.#createClasspath#(#)#;#}##void#setClasspathRef#(#Reference#r#)#{#getRequiredJavaResource#(#)#.#setClasspathRef#(#r#)#;#}##Path#getClasspath#(#)#{#return#getRequiredJavaResource#(#)#.#getClasspath#(#)#;#}##void#execute#(#)#throws#BuildException#{#//validation#if#(#src#==#null#)#{#throw#new#BuildException#(#"A source resource is required."#)#;#}#if#(#!#src#.#isExists#(#)#)#{#if#(#src#instanceof#JavaResource#)#{#// dreaded backwards compatibility#log#(#"Unable to find resource "#+#src#,#Project#.#MSG_WARN#)#;#return#;#}#throw#new#BuildException#(#"Source resource does not exist: "#+#src#)#;#}#BufferedInputStream#bis#=#null#;#Reader#instream#=#null#;#ByteArrayInputStream#tis#=#null#;#try#{#bis#=#new#BufferedInputStream#(#src#.#getInputStream#(#)#)#;#if#(#encoding#==#null#)#{#instream#=#new#InputStreamReader#(#bis#)#;#}#else#{#instream#=#new#InputStreamReader#(#bis#,#encoding#)#;#}#ChainReaderHelper#crh#=#new#ChainReaderHelper#(#)#;#crh#.#setPrimaryReader#(#instream#)#;#crh#.#setFilterChains#(#filterChains#)#;#crh#.#setProject#(#getProject#(#)#)#;#instream#=#crh#.#getAssembledReader#(#)#;#String#text#=#crh#.#readFully#(#instream#)#;#if#(#text#!=#null#&&#text#.#length#(#)#!=#0#)#{#if#(#!#text#.#endsWith#(#"\n"#)#)#{#text#=#text#+#"\n"#;#}#tis#=#new#ByteArrayInputStream#(#text#.#getBytes#(#"ISO8859_1"#)#)#;#final#Properties#props#=#new#Properties#(#)#;#props#.#load#(#tis#)#;#Property#propertyTask#=#new#Property#(#)#;#propertyTask#.#bindToOwner#(#this#)#;#propertyTask#.#addProperties#(#props#)#;#}#}#catch#(#final#IOException#ioe#)#{#throw#new#BuildException#(#"Unable to load file: "#+#ioe#,#ioe#,#getLocation#(#)#)#;#}#finally#{#FileUtils#.#close#(#bis#)#;#FileUtils#.#close#(#tis#)#;#}#}##void#addFilterChain#(#FilterChain#filter#)#{#filterChains#.#addElement#(#filter#)#;#}##void#addConfigured#(#ResourceCollection#a#)#{#if#(#src#!=#null#)#{#throw#new#BuildException#(#"only a single source is supported"#)#;#}#if#(#a#.#size#(#)#!=#1#)#{#throw#new#BuildException#(#"only single-element resource collections are supported"#)#;#}#src#=#(#Resource#)#a#.#iterator#(#)#.#next#(#)#;#}##JavaResource#getRequiredJavaResource#(#)#{#if#(#src#==#null#)#{#src#=#new#JavaResource#(#)#;#src#.#setProject#(#getProject#(#)#)#;#}#else#if#(#!#(#src#instanceof#JavaResource#)#)#{#throw#new#BuildException#(#"expected a java resource as source"#)#;#}#return#(#JavaResource#)#src#;#}##