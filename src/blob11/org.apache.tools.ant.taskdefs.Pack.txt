void#setZipfile#(#File#zipFile#)#{#this#.#zipFile#=#zipFile#;#}##void#setDestfile#(#File#zipFile#)#{#setZipfile#(#zipFile#)#;#}##void#setSrc#(#File#src#)#{#setSrcResource#(#new#FileResource#(#src#)#)#;#}##void#setSrcResource#(#Resource#src#)#{#if#(#src#.#isDirectory#(#)#)#{#throw#new#BuildException#(#"the source can't be a directory"#)#;#}#FileProvider#fp#=#(#FileProvider#)#src#.#as#(#FileProvider#.#class#)#;#if#(#fp#!=#null#)#{#source#=#fp#.#getFile#(#)#;#}#else#if#(#!#supportsNonFileResources#(#)#)#{#throw#new#BuildException#(#"Only FileSystem resources are supported."#)#;#}#this#.#src#=#src#;#}##void#addConfigured#(#ResourceCollection#a#)#{#if#(#a#.#size#(#)#==#0#)#{#throw#new#BuildException#(#"No resource selected, "#+#getTaskName#(#)#+#" needs exactly one resource."#)#;#}#if#(#a#.#size#(#)#!=#1#)#{#throw#new#BuildException#(#getTaskName#(#)#+#" cannot handle multiple resources at once. ("#+#a#.#size#(#)#+#" resources were selected.)"#)#;#}#setSrcResource#(#(#Resource#)#a#.#iterator#(#)#.#next#(#)#)#;#}##void#validate#(#)#throws#BuildException#{#if#(#zipFile#==#null#)#{#throw#new#BuildException#(#"zipfile attribute is required"#,#getLocation#(#)#)#;#}#if#(#zipFile#.#isDirectory#(#)#)#{#throw#new#BuildException#(#"zipfile attribute must not "#+#"represent a directory!"#,#getLocation#(#)#)#;#}#if#(#getSrcResource#(#)#==#null#)#{#throw#new#BuildException#(#"src attribute or nested resource is"#+#" required"#,#getLocation#(#)#)#;#}#}##void#execute#(#)#throws#BuildException#{#validate#(#)#;#Resource#s#=#getSrcResource#(#)#;#if#(#!#s#.#isExists#(#)#)#{#log#(#"Nothing to do: "#+#s#.#toString#(#)#+#" doesn't exist."#)#;#}#else#if#(#zipFile#.#lastModified#(#)#<#s#.#getLastModified#(#)#)#{#log#(#"Building: "#+#zipFile#.#getAbsolutePath#(#)#)#;#pack#(#)#;#}#else#{#log#(#"Nothing to do: "#+#zipFile#.#getAbsolutePath#(#)#+#" is up to date."#)#;#}#}##void#zipFile#(#InputStream#in#,#OutputStream#zOut#)#throws#IOException#{#byte#[#]#buffer#=#new#byte#[#BUFFER_SIZE#]#;#int#count#=#0#;#do#{#zOut#.#write#(#buffer#,#0#,#count#)#;#count#=#in#.#read#(#buffer#,#0#,#buffer#.#length#)#;#}#while#(#count#!=#-#1#)#;#}##void#zipFile#(#File#file#,#OutputStream#zOut#)#throws#IOException#{#zipResource#(#new#FileResource#(#file#)#,#zOut#)#;#}##void#zipResource#(#Resource#resource#,#OutputStream#zOut#)#throws#IOException#{#InputStream#rIn#=#resource#.#getInputStream#(#)#;#try#{#zipFile#(#rIn#,#zOut#)#;#}#finally#{#rIn#.#close#(#)#;#}#}##void#pack#(#)#;##Resource#getSrcResource#(#)#{#return#src#;#}##boolean#supportsNonFileResources#(#)#{#return#false#;#}##