void#setFile#(#File#file#)#{#this#.#file#=#file#;#}##void#setName#(#String#name#)#{#this#.#name#=#name#;#}##boolean#isSigned#(#File#zipFile#,#String#name#)#throws#IOException#{#ZipFile#jarFile#=#null#;#try#{#jarFile#=#new#ZipFile#(#zipFile#)#;#if#(#null#==#name#)#{#Enumeration#entries#=#jarFile#.#getEntries#(#)#;#while#(#entries#.#hasMoreElements#(#)#)#{#String#eName#=#(#(#ZipEntry#)#entries#.#nextElement#(#)#)#.#getName#(#)#;#if#(#eName#.#startsWith#(#SIG_START#)#&&#eName#.#endsWith#(#SIG_END#)#)#{#return#true#;#}#}#return#false#;#}#name#=#replaceInvalidChars#(#name#)#;#boolean#shortSig#=#jarFile#.#getEntry#(#SIG_START#+#name#.#toUpperCase#(#)#+#SIG_END#)#!=#null#;#boolean#longSig#=#false#;#if#(#name#.#length#(#)#>#SHORT_SIG_LIMIT#)#{#longSig#=#jarFile#.#getEntry#(#SIG_START#+#name#.#substring#(#0#,#SHORT_SIG_LIMIT#)#.#toUpperCase#(#)#+#SIG_END#)#!=#null#;#}#return#shortSig#||#longSig#;#}#finally#{#ZipFile#.#closeQuietly#(#jarFile#)#;#}#}##boolean#eval#(#)#{#if#(#file#==#null#)#{#throw#new#BuildException#(#"The file attribute must be set."#)#;#}#if#(#!#file#.#exists#(#)#)#{#log#(#"The file \""#+#file#.#getAbsolutePath#(#)#+#"\" does not exist."#,#Project#.#MSG_VERBOSE#)#;#return#false#;#}#boolean#r#=#false#;#try#{#r#=#isSigned#(#file#,#name#)#;#}#catch#(#IOException#e#)#{#log#(#"Got IOException reading file \""#+#file#.#getAbsolutePath#(#)#+#"\""#+#e#,#Project#.#MSG_WARN#)#;#}#if#(#r#)#{#log#(#"File \""#+#file#.#getAbsolutePath#(#)#+#"\" is signed."#,#Project#.#MSG_VERBOSE#)#;#}#return#r#;#}##String#replaceInvalidChars#(#final#String#name#)#{#StringBuffer#sb#=#new#StringBuffer#(#)#;#final#int#len#=#name#.#length#(#)#;#boolean#changes#=#false#;#for#(#int#i#=#0#;#i#<#len#;#i#++#)#{#final#char#ch#=#name#.#charAt#(#i#)#;#if#(#ManifestTask#.#VALID_ATTRIBUTE_CHARS#.#indexOf#(#ch#)#<#0#)#{#sb#.#append#(#"_"#)#;#changes#=#true#;#}#else#{#sb#.#append#(#ch#)#;#}#}#return#changes#?#sb#.#toString#(#)#:#name#;#}##