void#execute#(#)#throws#BuildException#{#Commandline#toExecute#=#new#Commandline#(#)#;#toExecute#.#setExecutable#(#rpmBuildCommand#==#null#?#guessRpmBuildCommand#(#)#:#rpmBuildCommand#)#;#if#(#topDir#!=#null#)#{#toExecute#.#createArgument#(#)#.#setValue#(#"--define"#)#;#toExecute#.#createArgument#(#)#.#setValue#(#"_topdir "#+#topDir#)#;#}#toExecute#.#createArgument#(#)#.#setLine#(#command#)#;#if#(#cleanBuildDir#)#{#toExecute#.#createArgument#(#)#.#setValue#(#"--clean"#)#;#}#if#(#removeSpec#)#{#toExecute#.#createArgument#(#)#.#setValue#(#"--rmspec"#)#;#}#if#(#removeSource#)#{#toExecute#.#createArgument#(#)#.#setValue#(#"--rmsource"#)#;#}#toExecute#.#createArgument#(#)#.#setValue#(#"SPECS/"#+#specFile#)#;#ExecuteStreamHandler#streamhandler#=#null#;#OutputStream#outputstream#=#null#;#OutputStream#errorstream#=#null#;#if#(#error#==#null#&&#output#==#null#)#{#if#(#!#quiet#)#{#streamhandler#=#new#LogStreamHandler#(#this#,#Project#.#MSG_INFO#,#Project#.#MSG_WARN#)#;#}#else#{#streamhandler#=#new#LogStreamHandler#(#this#,#Project#.#MSG_DEBUG#,#Project#.#MSG_DEBUG#)#;#}#}#else#{#if#(#output#!=#null#)#{#try#{#BufferedOutputStream#bos#=#new#BufferedOutputStream#(#new#FileOutputStream#(#output#)#)#;#outputstream#=#new#PrintStream#(#bos#)#;#}#catch#(#IOException#e#)#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#}#else#if#(#!#quiet#)#{#outputstream#=#new#LogOutputStream#(#this#,#Project#.#MSG_INFO#)#;#}#else#{#outputstream#=#new#LogOutputStream#(#this#,#Project#.#MSG_DEBUG#)#;#}#if#(#error#!=#null#)#{#try#{#BufferedOutputStream#bos#=#new#BufferedOutputStream#(#new#FileOutputStream#(#error#)#)#;#errorstream#=#new#PrintStream#(#bos#)#;#}#catch#(#IOException#e#)#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#}#else#if#(#!#quiet#)#{#errorstream#=#new#LogOutputStream#(#this#,#Project#.#MSG_WARN#)#;#}#else#{#errorstream#=#new#LogOutputStream#(#this#,#Project#.#MSG_DEBUG#)#;#}#streamhandler#=#new#PumpStreamHandler#(#outputstream#,#errorstream#)#;#}#Execute#exe#=#getExecute#(#toExecute#,#streamhandler#)#;#try#{#log#(#"Building the RPM based on the "#+#specFile#+#" file"#)#;#int#returncode#=#exe#.#execute#(#)#;#if#(#Execute#.#isFailure#(#returncode#)#)#{#String#msg#=#"'"#+#toExecute#.#getExecutable#(#)#+#"' failed with exit code "#+#returncode#;#if#(#failOnError#)#{#throw#new#BuildException#(#msg#)#;#}#log#(#msg#,#Project#.#MSG_ERR#)#;#}#}#catch#(#IOException#e#)#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#finally#{#FileUtils#.#close#(#outputstream#)#;#FileUtils#.#close#(#errorstream#)#;#}#}##void#setTopDir#(#File#td#)#{#this#.#topDir#=#td#;#}##void#setCommand#(#String#c#)#{#this#.#command#=#c#;#}##void#setSpecFile#(#String#sf#)#{#if#(#(#sf#==#null#)#||#(#sf#.#trim#(#)#.#length#(#)#==#0#)#)#{#throw#new#BuildException#(#"You must specify a spec file"#,#getLocation#(#)#)#;#}#this#.#specFile#=#sf#;#}##void#setCleanBuildDir#(#boolean#cbd#)#{#cleanBuildDir#=#cbd#;#}##void#setRemoveSpec#(#boolean#rs#)#{#removeSpec#=#rs#;#}##void#setRemoveSource#(#boolean#rs#)#{#removeSource#=#rs#;#}##void#setOutput#(#File#output#)#{#this#.#output#=#output#;#}##void#setError#(#File#error#)#{#this#.#error#=#error#;#}##void#setRpmBuildCommand#(#String#c#)#{#this#.#rpmBuildCommand#=#c#;#}##void#setFailOnError#(#boolean#value#)#{#failOnError#=#value#;#}##void#setQuiet#(#boolean#value#)#{#quiet#=#value#;#}##String#guessRpmBuildCommand#(#)#{#Vector#env#=#Execute#.#getProcEnvironment#(#)#;#String#path#=#null#;#for#(#Enumeration#e#=#env#.#elements#(#)#;#e#.#hasMoreElements#(#)#;#)#{#String#var#=#(#String#)#e#.#nextElement#(#)#;#if#(#var#.#startsWith#(#PATH1#)#||#var#.#startsWith#(#PATH2#)#||#var#.#startsWith#(#PATH3#)#)#{#path#=#var#.#substring#(#PATH_LEN#)#;#break#;#}#}#if#(#path#!=#null#)#{#Path#p#=#new#Path#(#getProject#(#)#,#path#)#;#String#[#]#pElements#=#p#.#list#(#)#;#for#(#int#i#=#0#;#i#<#pElements#.#length#;#i#++#)#{#File#f#=#new#File#(#pElements#[#i#]#,#"rpmbuild"#+#(#Os#.#isFamily#(#"dos"#)#?#".exe"#:#""#)#)#;#if#(#f#.#canRead#(#)#)#{#return#f#.#getAbsolutePath#(#)#;#}#}#}#return#"rpm"#;#}##Execute#getExecute#(#Commandline#toExecute#,#ExecuteStreamHandler#streamhandler#)#{#Execute#exe#=#new#Execute#(#streamhandler#,#null#)#;#exe#.#setAntRun#(#getProject#(#)#)#;#if#(#topDir#==#null#)#{#topDir#=#getProject#(#)#.#getBaseDir#(#)#;#}#exe#.#setWorkingDirectory#(#topDir#)#;#exe#.#setCommandline#(#toExecute#.#getCommandline#(#)#)#;#return#exe#;#}##