void#init#(#)#throws#BuildException#{#super#.#init#(#)#;#//validating#setLenient#(#false#)#;#}##boolean#enableXercesSchemaValidation#(#)#{#try#{#setFeature#(#XmlConstants#.#FEATURE_XSD#,#true#)#;#//set the schema source for the doc#setNoNamespaceSchemaProperty#(#XmlConstants#.#PROPERTY_NO_NAMESPACE_SCHEMA_LOCATION#)#;#}#catch#(#BuildException#e#)#{#log#(#e#.#toString#(#)#,#Project#.#MSG_VERBOSE#)#;#return#false#;#}#return#true#;#}##void#setNoNamespaceSchemaProperty#(#String#property#)#{#String#anonSchema#=#getNoNamespaceSchemaURL#(#)#;#if#(#anonSchema#!=#null#)#{#setProperty#(#property#,#anonSchema#)#;#}#}##boolean#enableJAXP12SchemaValidation#(#)#{#try#{#//enable XSD#setProperty#(#XmlConstants#.#FEATURE_JAXP12_SCHEMA_LANGUAGE#,#XmlConstants#.#URI_XSD#)#;#//set the schema source for the doc#setNoNamespaceSchemaProperty#(#XmlConstants#.#FEATURE_JAXP12_SCHEMA_SOURCE#)#;#}#catch#(#BuildException#e#)#{#log#(#e#.#toString#(#)#,#Project#.#MSG_VERBOSE#)#;#return#false#;#}#return#true#;#}##void#addConfiguredSchema#(#SchemaLocation#location#)#{#log#(#"adding schema "#+#location#,#Project#.#MSG_DEBUG#)#;#location#.#validateNamespace#(#)#;#SchemaLocation#old#=#(#SchemaLocation#)#schemaLocations#.#get#(#location#.#getNamespace#(#)#)#;#if#(#old#!=#null#&&#!#old#.#equals#(#location#)#)#{#throw#new#BuildException#(#ERROR_DUPLICATE_SCHEMA#+#location#)#;#}#schemaLocations#.#put#(#location#.#getNamespace#(#)#,#location#)#;#}##void#setFullChecking#(#boolean#fullChecking#)#{#this#.#fullChecking#=#fullChecking#;#}##void#createAnonymousSchema#(#)#{#if#(#anonymousSchema#==#null#)#{#anonymousSchema#=#new#SchemaLocation#(#)#;#}#anonymousSchema#.#setNamespace#(#"(no namespace)"#)#;#}##void#setNoNamespaceURL#(#String#defaultSchemaURL#)#{#createAnonymousSchema#(#)#;#this#.#anonymousSchema#.#setUrl#(#defaultSchemaURL#)#;#}##void#setNoNamespaceFile#(#File#defaultSchemaFile#)#{#createAnonymousSchema#(#)#;#this#.#anonymousSchema#.#setFile#(#defaultSchemaFile#)#;#}##void#setDisableDTD#(#boolean#disableDTD#)#{#this#.#disableDTD#=#disableDTD#;#}##void#initValidator#(#)#{#super#.#initValidator#(#)#;#//validate the parser type#if#(#isSax1Parser#(#)#)#{#throw#new#BuildException#(#ERROR_SAX_1#)#;#}#//enable schema#//setFeature(XmlConstants.FEATURE_VALIDATION, false);#setFeature#(#XmlConstants#.#FEATURE_NAMESPACES#,#true#)#;#if#(#!#enableXercesSchemaValidation#(#)#&&#!#enableJAXP12SchemaValidation#(#)#)#{#//couldnt use the xerces or jaxp calls#throw#new#BuildException#(#ERROR_NO_XSD_SUPPORT#)#;#}#//enable schema checking#setFeature#(#XmlConstants#.#FEATURE_XSD_FULL_VALIDATION#,#fullChecking#)#;#//turn off DTDs if desired#setFeatureIfSupported#(#XmlConstants#.#FEATURE_DISALLOW_DTD#,#disableDTD#)#;#//schema declarations go in next#addSchemaLocations#(#)#;#}##XMLReader#createDefaultReader#(#)#{#SAXParserFactory#factory#=#SAXParserFactory#.#newInstance#(#)#;#factory#.#setValidating#(#true#)#;#factory#.#setNamespaceAware#(#true#)#;#XMLReader#reader#=#null#;#try#{#SAXParser#saxParser#=#factory#.#newSAXParser#(#)#;#reader#=#saxParser#.#getXMLReader#(#)#;#}#catch#(#ParserConfigurationException#e#)#{#throw#new#BuildException#(#ERROR_PARSER_CREATION_FAILURE#,#e#)#;#}#catch#(#SAXException#e#)#{#throw#new#BuildException#(#ERROR_PARSER_CREATION_FAILURE#,#e#)#;#}#return#reader#;#}##void#addSchemaLocations#(#)#{#Iterator#it#=#schemaLocations#.#values#(#)#.#iterator#(#)#;#StringBuffer#buffer#=#new#StringBuffer#(#)#;#int#count#=#0#;#while#(#it#.#hasNext#(#)#)#{#if#(#count#>#0#)#{#buffer#.#append#(#' '#)#;#}#SchemaLocation#schemaLocation#=#(#SchemaLocation#)#it#.#next#(#)#;#String#tuple#=#schemaLocation#.#getURIandLocation#(#)#;#buffer#.#append#(#tuple#)#;#log#(#"Adding schema "#+#tuple#,#Project#.#MSG_VERBOSE#)#;#count#++#;#}#if#(#count#>#0#)#{#setProperty#(#XmlConstants#.#PROPERTY_SCHEMA_LOCATION#,#buffer#.#toString#(#)#)#;#}#}##String#getNoNamespaceSchemaURL#(#)#{#if#(#anonymousSchema#==#null#)#{#return#null#;#}#else#{#return#anonymousSchema#.#getSchemaLocationURL#(#)#;#}#}##void#setFeatureIfSupported#(#String#feature#,#boolean#value#)#{#try#{#getXmlReader#(#)#.#setFeature#(#feature#,#value#)#;#}#catch#(#SAXNotRecognizedException#e#)#{#log#(#"Not recognizied: "#+#feature#,#Project#.#MSG_VERBOSE#)#;#}#catch#(#SAXNotSupportedException#e#)#{#log#(#"Not supported: "#+#feature#,#Project#.#MSG_VERBOSE#)#;#}#}##void#onSuccessfulValidation#(#int#fileProcessed#)#{#log#(#fileProcessed#+#MESSAGE_FILES_VALIDATED#,#Project#.#MSG_VERBOSE#)#;#}##String#getNamespace#(#)#{#return#namespace#;#}##void#setNamespace#(#String#namespace#)#{#this#.#namespace#=#namespace#;#}##File#getFile#(#)#{#return#file#;#}##void#setFile#(#File#file#)#{#this#.#file#=#file#;#}##String#getUrl#(#)#{#return#url#;#}##void#setUrl#(#String#url#)#{#this#.#url#=#url#;#}##String#getSchemaLocationURL#(#)#{#boolean#hasFile#=#file#!=#null#;#boolean#hasURL#=#isSet#(#url#)#;#//error if both are empty, or both are set#if#(#!#hasFile#&&#!#hasURL#)#{#throw#new#BuildException#(#ERROR_NO_LOCATION#+#namespace#)#;#}#if#(#hasFile#&&#hasURL#)#{#throw#new#BuildException#(#ERROR_TWO_LOCATIONS#+#namespace#)#;#}#String#schema#=#url#;#if#(#hasFile#)#{#if#(#!#file#.#exists#(#)#)#{#throw#new#BuildException#(#ERROR_NO_FILE#+#file#)#;#}#try#{#schema#=#FileUtils#.#getFileUtils#(#)#.#getFileURL#(#file#)#.#toString#(#)#;#}#catch#(#MalformedURLException#e#)#{#//this is almost implausible, but required handling#throw#new#BuildException#(#ERROR_NO_URL_REPRESENTATION#+#file#,#e#)#;#}#}#return#schema#;#}##String#getURIandLocation#(#)#throws#BuildException#{#validateNamespace#(#)#;#StringBuffer#buffer#=#new#StringBuffer#(#)#;#buffer#.#append#(#namespace#)#;#buffer#.#append#(#' '#)#;#buffer#.#append#(#getSchemaLocationURL#(#)#)#;#return#new#String#(#buffer#)#;#}##void#validateNamespace#(#)#{#if#(#!#isSet#(#getNamespace#(#)#)#)#{#throw#new#BuildException#(#ERROR_NO_URI#)#;#}#}##boolean#isSet#(#String#property#)#{#return#property#!=#null#&&#property#.#length#(#)#!=#0#;#}##boolean#equals#(#Object#o#)#{#if#(#this#==#o#)#{#return#true#;#}#if#(#!#(#o#instanceof#SchemaLocation#)#)#{#return#false#;#}#final#SchemaLocation#schemaLocation#=#(#SchemaLocation#)#o#;#if#(#file#!=#null#?#!#file#.#equals#(#schemaLocation#.#file#)#:#schemaLocation#.#file#!=#null#)#{#return#false#;#}#if#(#namespace#!=#null#?#!#namespace#.#equals#(#schemaLocation#.#namespace#)#:#schemaLocation#.#namespace#!=#null#)#{#return#false#;#}#if#(#url#!=#null#?#!#url#.#equals#(#schemaLocation#.#url#)#:#schemaLocation#.#url#!=#null#)#{#return#false#;#}#return#true#;#}##int#hashCode#(#)#{#int#result#;#// CheckStyle:MagicNumber OFF#result#=#(#namespace#!=#null#?#namespace#.#hashCode#(#)#:#0#)#;#result#=#29#*#result#+#(#file#!=#null#?#file#.#hashCode#(#)#:#0#)#;#result#=#29#*#result#+#(#url#!=#null#?#url#.#hashCode#(#)#:#0#)#;#// CheckStyle:MagicNumber OFF#return#result#;#}##String#toString#(#)#{#StringBuffer#buffer#=#new#StringBuffer#(#)#;#buffer#.#append#(#namespace#!=#null#?#namespace#:#"(anonymous)"#)#;#buffer#.#append#(#' '#)#;#buffer#.#append#(#url#!=#null#?#(#url#+#" "#)#:#""#)#;#buffer#.#append#(#file#!=#null#?#file#.#getAbsolutePath#(#)#:#""#)#;#return#buffer#.#toString#(#)#;#}##