void#registerDTD#(#String#publicId#,#String#location#)#{#if#(#location#==#null#)#{#return#;#}#File#fileDTD#=#new#File#(#location#)#;#if#(#!#fileDTD#.#exists#(#)#)#{#// resolve relative to project basedir#fileDTD#=#owningTask#.#getProject#(#)#.#resolveFile#(#location#)#;#}#if#(#fileDTD#.#exists#(#)#)#{#if#(#publicId#!=#null#)#{#fileDTDs#.#put#(#publicId#,#fileDTD#)#;#owningTask#.#log#(#"Mapped publicId "#+#publicId#+#" to file "#+#fileDTD#,#Project#.#MSG_VERBOSE#)#;#}#return#;#}#if#(#getClass#(#)#.#getResource#(#location#)#!=#null#)#{#if#(#publicId#!=#null#)#{#resourceDTDs#.#put#(#publicId#,#location#)#;#owningTask#.#log#(#"Mapped publicId "#+#publicId#+#" to resource "#+#location#,#Project#.#MSG_VERBOSE#)#;#}#}#try#{#if#(#publicId#!=#null#)#{#URL#urldtd#=#new#URL#(#location#)#;#urlDTDs#.#put#(#publicId#,#urldtd#)#;#}#}#catch#(#java#.#net#.#MalformedURLException#e#)#{#//ignored#}#}##InputSource#resolveEntity#(#String#publicId#,#String#systemId#)#throws#SAXException#{#this#.#publicId#=#publicId#;#File#dtdFile#=#(#File#)#fileDTDs#.#get#(#publicId#)#;#if#(#dtdFile#!=#null#)#{#try#{#owningTask#.#log#(#"Resolved "#+#publicId#+#" to local file "#+#dtdFile#,#Project#.#MSG_VERBOSE#)#;#return#new#InputSource#(#new#FileInputStream#(#dtdFile#)#)#;#}#catch#(#FileNotFoundException#ex#)#{#// ignore#}#}#String#dtdResourceName#=#(#String#)#resourceDTDs#.#get#(#publicId#)#;#if#(#dtdResourceName#!=#null#)#{#InputStream#is#=#this#.#getClass#(#)#.#getResourceAsStream#(#dtdResourceName#)#;#if#(#is#!=#null#)#{#owningTask#.#log#(#"Resolved "#+#publicId#+#" to local resource "#+#dtdResourceName#,#Project#.#MSG_VERBOSE#)#;#return#new#InputSource#(#is#)#;#}#}#URL#dtdUrl#=#(#URL#)#urlDTDs#.#get#(#publicId#)#;#if#(#dtdUrl#!=#null#)#{#try#{#InputStream#is#=#dtdUrl#.#openStream#(#)#;#owningTask#.#log#(#"Resolved "#+#publicId#+#" to url "#+#dtdUrl#,#Project#.#MSG_VERBOSE#)#;#return#new#InputSource#(#is#)#;#}#catch#(#IOException#ioe#)#{#//ignore#}#}#owningTask#.#log#(#"Could not resolve ( publicId: "#+#publicId#+#", systemId: "#+#systemId#+#") to a local entity"#,#Project#.#MSG_INFO#)#;#return#null#;#}##Hashtable#getFiles#(#)#{#return#(#ejbFiles#==#null#)#?#new#Hashtable#(#)#:#ejbFiles#;#}##String#getPublicId#(#)#{#return#publicId#;#}##String#getEjbName#(#)#{#return#ejbName#;#}##void#startDocument#(#)#throws#SAXException#{#this#.#ejbFiles#=#new#Hashtable#(#DEFAULT_HASH_TABLE_SIZE#,#1#)#;#this#.#currentElement#=#null#;#inEJBRef#=#false#;#}##void#startElement#(#String#name#,#AttributeList#attrs#)#throws#SAXException#{#this#.#currentElement#=#name#;#currentText#=#""#;#if#(#name#.#equals#(#EJB_REF#)#||#name#.#equals#(#EJB_LOCAL_REF#)#)#{#inEJBRef#=#true#;#}#else#if#(#parseState#==#STATE_LOOKING_EJBJAR#&&#name#.#equals#(#EJB_JAR#)#)#{#parseState#=#STATE_IN_EJBJAR#;#}#else#if#(#parseState#==#STATE_IN_EJBJAR#&&#name#.#equals#(#ENTERPRISE_BEANS#)#)#{#parseState#=#STATE_IN_BEANS#;#}#else#if#(#parseState#==#STATE_IN_BEANS#&&#name#.#equals#(#SESSION_BEAN#)#)#{#parseState#=#STATE_IN_SESSION#;#}#else#if#(#parseState#==#STATE_IN_BEANS#&&#name#.#equals#(#ENTITY_BEAN#)#)#{#parseState#=#STATE_IN_ENTITY#;#}#else#if#(#parseState#==#STATE_IN_BEANS#&&#name#.#equals#(#MESSAGE_BEAN#)#)#{#parseState#=#STATE_IN_MESSAGE#;#}#}##void#endElement#(#String#name#)#throws#SAXException#{#processElement#(#)#;#currentText#=#""#;#this#.#currentElement#=#""#;#if#(#name#.#equals#(#EJB_REF#)#||#name#.#equals#(#EJB_LOCAL_REF#)#)#{#inEJBRef#=#false#;#}#else#if#(#parseState#==#STATE_IN_ENTITY#&&#name#.#equals#(#ENTITY_BEAN#)#)#{#parseState#=#STATE_IN_BEANS#;#}#else#if#(#parseState#==#STATE_IN_SESSION#&&#name#.#equals#(#SESSION_BEAN#)#)#{#parseState#=#STATE_IN_BEANS#;#}#else#if#(#parseState#==#STATE_IN_MESSAGE#&&#name#.#equals#(#MESSAGE_BEAN#)#)#{#parseState#=#STATE_IN_BEANS#;#}#else#if#(#parseState#==#STATE_IN_BEANS#&&#name#.#equals#(#ENTERPRISE_BEANS#)#)#{#parseState#=#STATE_IN_EJBJAR#;#}#else#if#(#parseState#==#STATE_IN_EJBJAR#&&#name#.#equals#(#EJB_JAR#)#)#{#parseState#=#STATE_LOOKING_EJBJAR#;#}#}##void#characters#(#char#[#]#ch#,#int#start#,#int#length#)#throws#SAXException#{#currentText#+=#new#String#(#ch#,#start#,#length#)#;#}##void#processElement#(#)#{#if#(#inEJBRef#||#(#parseState#!=#STATE_IN_ENTITY#&&#parseState#!=#STATE_IN_SESSION#&&#parseState#!=#STATE_IN_MESSAGE#)#)#{#return#;#}#if#(#currentElement#.#equals#(#HOME_INTERFACE#)#||#currentElement#.#equals#(#REMOTE_INTERFACE#)#||#currentElement#.#equals#(#LOCAL_INTERFACE#)#||#currentElement#.#equals#(#LOCAL_HOME_INTERFACE#)#||#currentElement#.#equals#(#BEAN_CLASS#)#||#currentElement#.#equals#(#PK_CLASS#)#)#{#// Get the filename into a String object#File#classFile#=#null#;#String#className#=#currentText#.#trim#(#)#;#// If it's a primitive wrapper then we shouldn't try and put#// it into the jar, so ignore it.#if#(#!#className#.#startsWith#(#"java."#)#&&#!#className#.#startsWith#(#"javax."#)#)#{#// Translate periods into path separators, add .class to the#// name, create the File object and add it to the Hashtable.#className#=#className#.#replace#(#'.'#,#File#.#separatorChar#)#;#className#+=#".class"#;#classFile#=#new#File#(#srcDir#,#className#)#;#ejbFiles#.#put#(#className#,#classFile#)#;#}#}#// Get the value of the <ejb-name> tag.  Only the first occurrence.#if#(#currentElement#.#equals#(#EJB_NAME#)#)#{#if#(#ejbName#==#null#)#{#ejbName#=#currentText#.#trim#(#)#;#}#}#}##