void#execute#(#)#throws#BuildException#{#/**  A server name is required to continue */#if#(#server#==#null#)#{#throw#new#BuildException#(#"No Server Specified"#)#;#}#/**  A userid and password must appear together
        *   if they appear.  They are not required.
        */#if#(#userid#==#null#&&#password#!=#null#)#{#throw#new#BuildException#(#"No Userid Specified"#)#;#}#if#(#password#==#null#&&#userid#!=#null#)#{#throw#new#BuildException#(#"No Password Specified"#)#;#}#/**  Create the telnet client object */#AntTelnetClient#telnet#=#null#;#try#{#telnet#=#new#AntTelnetClient#(#)#;#try#{#telnet#.#connect#(#server#,#port#)#;#}#catch#(#IOException#e#)#{#throw#new#BuildException#(#"Can't connect to "#+#server#)#;#}#/**  Login if userid and password were specified */#if#(#userid#!=#null#&&#password#!=#null#)#{#login#(#telnet#)#;#}#/**  Process each sub command */#Enumeration#tasksToRun#=#telnetTasks#.#elements#(#)#;#while#(#tasksToRun#!=#null#&&#tasksToRun#.#hasMoreElements#(#)#)#{#TelnetSubTask#task#=#(#TelnetSubTask#)#tasksToRun#.#nextElement#(#)#;#if#(#task#instanceof#TelnetRead#&&#defaultTimeout#!=#null#)#{#(#(#TelnetRead#)#task#)#.#setDefaultTimeout#(#defaultTimeout#)#;#}#task#.#execute#(#telnet#)#;#}#}#finally#{#if#(#telnet#!=#null#&&#telnet#.#isConnected#(#)#)#{#try#{#telnet#.#disconnect#(#)#;#}#catch#(#IOException#e#)#{#throw#new#BuildException#(#"Error disconnecting from "#+#server#)#;#}#}#}#}##void#login#(#AntTelnetClient#telnet#)#{#if#(#addCarriageReturn#)#{#telnet#.#sendString#(#"\n"#,#true#)#;#}#telnet#.#waitForString#(#"ogin:"#)#;#telnet#.#sendString#(#userid#,#true#)#;#telnet#.#waitForString#(#"assword:"#)#;#telnet#.#sendString#(#password#,#false#)#;#}##void#setUserid#(#String#u#)#{#this#.#userid#=#u#;#}##void#setPassword#(#String#p#)#{#this#.#password#=#p#;#}##void#setServer#(#String#m#)#{#this#.#server#=#m#;#}##void#setPort#(#int#p#)#{#this#.#port#=#p#;#}##void#setInitialCR#(#boolean#b#)#{#this#.#addCarriageReturn#=#b#;#}##void#setTimeout#(#Integer#i#)#{#this#.#defaultTimeout#=#i#;#}##TelnetSubTask#createRead#(#)#{#TelnetSubTask#task#=#(#TelnetSubTask#)#new#TelnetRead#(#)#;#telnetTasks#.#addElement#(#task#)#;#return#task#;#}##TelnetSubTask#createWrite#(#)#{#TelnetSubTask#task#=#(#TelnetSubTask#)#new#TelnetWrite#(#)#;#telnetTasks#.#addElement#(#task#)#;#return#task#;#}##void#execute#(#AntTelnetClient#telnet#)#throws#BuildException#{#throw#new#BuildException#(#"Shouldn't be able instantiate a SubTask directly"#)#;#}##void#addText#(#String#s#)#{#setString#(#getProject#(#)#.#replaceProperties#(#s#)#)#;#}##void#setString#(#String#s#)#{#taskString#+=#s#;#}##void#execute#(#AntTelnetClient#telnet#)#throws#BuildException#{#telnet#.#sendString#(#taskString#,#echoString#)#;#}##void#setEcho#(#boolean#b#)#{#echoString#=#b#;#}##void#execute#(#AntTelnetClient#telnet#)#throws#BuildException#{#telnet#.#waitForString#(#taskString#,#timeout#)#;#}##void#setTimeout#(#Integer#i#)#{#this#.#timeout#=#i#;#}##void#setDefaultTimeout#(#Integer#defaultTimeout#)#{#if#(#timeout#==#null#)#{#timeout#=#defaultTimeout#;#}#}##void#waitForString#(#String#s#)#{#waitForString#(#s#,#null#)#;#}##void#waitForString#(#String#s#,#Integer#timeout#)#{#InputStream#is#=#this#.#getInputStream#(#)#;#try#{#StringBuffer#sb#=#new#StringBuffer#(#)#;#int#windowStart#=#-#s#.#length#(#)#;#if#(#timeout#==#null#||#timeout#.#intValue#(#)#==#0#)#{#while#(#windowStart#++#<#0#||#!#sb#.#substring#(#windowStart#)#.#equals#(#s#)#)#{#sb#.#append#(#(#char#)#is#.#read#(#)#)#;#}#}#else#{#Calendar#endTime#=#Calendar#.#getInstance#(#)#;#endTime#.#add#(#Calendar#.#SECOND#,#timeout#.#intValue#(#)#)#;#while#(#windowStart#++#<#0#||#!#sb#.#substring#(#windowStart#)#.#equals#(#s#)#)#{#while#(#Calendar#.#getInstance#(#)#.#before#(#endTime#)#&&#is#.#available#(#)#==#0#)#{#Thread#.#sleep#(#WAIT_INTERVAL#)#;#}#if#(#is#.#available#(#)#==#0#)#{#log#(#"Read before running into timeout: "#+#sb#.#toString#(#)#,#Project#.#MSG_DEBUG#)#;#throw#new#BuildException#(#"Response timed-out waiting for \""#+#s#+#'\"'#,#getLocation#(#)#)#;#}#sb#.#append#(#(#char#)#is#.#read#(#)#)#;#}#}#log#(#sb#.#toString#(#)#,#Project#.#MSG_INFO#)#;#}#catch#(#BuildException#be#)#{#throw#be#;#}#catch#(#Exception#e#)#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#}##void#sendString#(#String#s#,#boolean#echoString#)#{#OutputStream#os#=#this#.#getOutputStream#(#)#;#try#{#os#.#write#(#(#s#+#"\n"#)#.#getBytes#(#)#)#;#if#(#echoString#)#{#log#(#s#,#Project#.#MSG_INFO#)#;#}#os#.#flush#(#)#;#}#catch#(#Exception#e#)#{#throw#new#BuildException#(#e#,#getLocation#(#)#)#;#}#}##