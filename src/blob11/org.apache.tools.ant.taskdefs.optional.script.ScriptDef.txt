void#setProject#(#Project#project#)#{#super#.#setProject#(#project#)#;#helper#.#setProjectComponent#(#this#)#;#helper#.#setSetBeans#(#false#)#;#}##void#setName#(#String#name#)#{#this#.#name#=#name#;#}##boolean#isAttributeSupported#(#String#attributeName#)#{#return#attributeSet#.#contains#(#attributeName#)#;#}##void#setName#(#String#name#)#{#this#.#name#=#name#.#toLowerCase#(#Locale#.#US#)#;#}##void#addAttribute#(#Attribute#attribute#)#{#attributes#.#add#(#attribute#)#;#}##void#setName#(#String#name#)#{#this#.#name#=#name#.#toLowerCase#(#Locale#.#US#)#;#}##void#setType#(#String#type#)#{#this#.#type#=#type#;#}##void#setClassName#(#String#className#)#{#this#.#className#=#className#;#}##void#addElement#(#NestedElement#nestedElement#)#{#nestedElements#.#add#(#nestedElement#)#;#}##void#execute#(#)#{#if#(#name#==#null#)#{#throw#new#BuildException#(#"scriptdef requires a name attribute to "#+#"name the script"#)#;#}#if#(#helper#.#getLanguage#(#)#==#null#)#{#throw#new#BuildException#(#"<scriptdef> requires a language attribute "#+#"to specify the script language"#)#;#}#// Check if need to set the loader#if#(#getAntlibClassLoader#(#)#!=#null#||#hasCpDelegate#(#)#)#{#helper#.#setClassLoader#(#createLoader#(#)#)#;#}#attributeSet#=#new#HashSet#(#)#;#for#(#Iterator#i#=#attributes#.#iterator#(#)#;#i#.#hasNext#(#)#;#)#{#Attribute#attribute#=#(#Attribute#)#i#.#next#(#)#;#if#(#attribute#.#name#==#null#)#{#throw#new#BuildException#(#"scriptdef <attribute> elements "#+#"must specify an attribute name"#)#;#}#if#(#attributeSet#.#contains#(#attribute#.#name#)#)#{#throw#new#BuildException#(#"scriptdef <"#+#name#+#"> declares "#+#"the "#+#attribute#.#name#+#" attribute more than once"#)#;#}#attributeSet#.#add#(#attribute#.#name#)#;#}#nestedElementMap#=#new#HashMap#(#)#;#for#(#Iterator#i#=#nestedElements#.#iterator#(#)#;#i#.#hasNext#(#)#;#)#{#NestedElement#nestedElement#=#(#NestedElement#)#i#.#next#(#)#;#if#(#nestedElement#.#name#==#null#)#{#throw#new#BuildException#(#"scriptdef <element> elements "#+#"must specify an element name"#)#;#}#if#(#nestedElementMap#.#containsKey#(#nestedElement#.#name#)#)#{#throw#new#BuildException#(#"scriptdef <"#+#name#+#"> declares "#+#"the "#+#nestedElement#.#name#+#" nested element more "#+#"than once"#)#;#}#if#(#nestedElement#.#className#==#null#&&#nestedElement#.#type#==#null#)#{#throw#new#BuildException#(#"scriptdef <element> elements "#+#"must specify either a classname or type attribute"#)#;#}#if#(#nestedElement#.#className#!=#null#&&#nestedElement#.#type#!=#null#)#{#throw#new#BuildException#(#"scriptdef <element> elements "#+#"must specify only one of the classname and type "#+#"attributes"#)#;#}#nestedElementMap#.#put#(#nestedElement#.#name#,#nestedElement#)#;#}#// find the script repository - it is stored in the project#Map#scriptRepository#=#lookupScriptRepository#(#)#;#name#=#ProjectHelper#.#genComponentName#(#getURI#(#)#,#name#)#;#scriptRepository#.#put#(#name#,#this#)#;#AntTypeDefinition#def#=#new#AntTypeDefinition#(#)#;#def#.#setName#(#name#)#;#def#.#setClass#(#ScriptDefBase#.#class#)#;#ComponentHelper#.#getComponentHelper#(#getProject#(#)#)#.#addDataTypeDefinition#(#def#)#;#}##Map#lookupScriptRepository#(#)#{#Map#scriptRepository#=#null#;#Project#p#=#getProject#(#)#;#synchronized#(#p#)#{#scriptRepository#=#(#Map#)#p#.#getReference#(#MagicNames#.#SCRIPT_REPOSITORY#)#;#if#(#scriptRepository#==#null#)#{#scriptRepository#=#new#HashMap#(#)#;#p#.#addReference#(#MagicNames#.#SCRIPT_REPOSITORY#,#scriptRepository#)#;#}#}#return#scriptRepository#;#}##Object#createNestedElement#(#String#elementName#)#{#NestedElement#definition#=#(#NestedElement#)#nestedElementMap#.#get#(#elementName#)#;#if#(#definition#==#null#)#{#throw#new#BuildException#(#"<"#+#name#+#"> does not support "#+#"the <"#+#elementName#+#"> nested element"#)#;#}#Object#instance#=#null#;#String#classname#=#definition#.#className#;#if#(#classname#==#null#)#{#instance#=#getProject#(#)#.#createTask#(#definition#.#type#)#;#if#(#instance#==#null#)#{#instance#=#getProject#(#)#.#createDataType#(#definition#.#type#)#;#}#}#else#{#/*
            // try the context classloader
            ClassLoader loader
                = Thread.currentThread().getContextClassLoader();
            */#ClassLoader#loader#=#createLoader#(#)#;#try#{#instance#=#ClasspathUtils#.#newInstance#(#classname#,#loader#)#;#}#catch#(#BuildException#e#)#{#instance#=#ClasspathUtils#.#newInstance#(#classname#,#ScriptDef#.#class#.#getClassLoader#(#)#)#;#}#getProject#(#)#.#setProjectReference#(#instance#)#;#}#if#(#instance#==#null#)#{#throw#new#BuildException#(#"<"#+#name#+#"> is unable to create "#+#"the <"#+#elementName#+#"> nested element"#)#;#}#return#instance#;#}##void#executeScript#(#Map#attributes#,#Map#elements#)#{#executeScript#(#attributes#,#elements#,#null#)#;#}##void#executeScript#(#Map#attributes#,#Map#elements#,#ScriptDefBase#instance#)#{#ScriptRunnerBase#runner#=#helper#.#getScriptRunner#(#)#;#runner#.#addBean#(#"attributes"#,#attributes#)#;#runner#.#addBean#(#"elements"#,#elements#)#;#runner#.#addBean#(#"project"#,#getProject#(#)#)#;#if#(#instance#!=#null#)#{#runner#.#addBean#(#"self"#,#instance#)#;#}#runner#.#executeScript#(#"scriptdef_"#+#name#)#;#}##void#setManager#(#String#manager#)#{#helper#.#setManager#(#manager#)#;#}##void#setLanguage#(#String#language#)#{#helper#.#setLanguage#(#language#)#;#}##void#setSrc#(#File#file#)#{#helper#.#setSrc#(#file#)#;#}##void#addText#(#String#text#)#{#helper#.#addText#(#text#)#;#}##void#add#(#ResourceCollection#resource#)#{#helper#.#add#(#resource#)#;#}##