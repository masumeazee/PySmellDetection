Collection#getCollection#(#)#{#int#count#=#getValidCount#(#)#;#ResourceCollection#rc#=#getResourceCollection#(#)#;#int#i#=#count#;#Iterator#iter#=#rc#.#iterator#(#)#;#int#size#=#rc#.#size#(#)#;#for#(#;#i#<#size#;#i#++#)#{#iter#.#next#(#)#;#}#ArrayList#al#=#new#ArrayList#(#count#)#;#for#(#;#iter#.#hasNext#(#)#;#i#++#)#{#al#.#add#(#iter#.#next#(#)#)#;#}#int#found#=#al#.#size#(#)#;#if#(#found#==#count#||#(#size#<#count#&&#found#==#size#)#)#{#return#al#;#}#//mismatch:#String#msg#=#"Resource collection "#+#rc#+#" reports size "#+#size#+#" but returns "#+#i#+#" elements."#;#//size was understated -> too many results; warn and continue:#if#(#found#>#count#)#{#log#(#msg#,#Project#.#MSG_WARN#)#;#return#al#.#subList#(#found#-#count#,#found#)#;#}#//size was overstated; we missed some and are now in error-land:#throw#new#BuildException#(#msg#)#;#}##