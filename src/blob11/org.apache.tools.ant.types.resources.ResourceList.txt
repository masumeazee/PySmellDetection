void#add#(#ResourceCollection#rc#)#{#if#(#isReference#(#)#)#{#throw#noChildrenAllowed#(#)#;#}#textDocuments#.#add#(#rc#)#;#setChecked#(#false#)#;#}##void#addFilterChain#(#FilterChain#filter#)#{#if#(#isReference#(#)#)#{#throw#noChildrenAllowed#(#)#;#}#filterChains#.#add#(#filter#)#;#setChecked#(#false#)#;#}##void#setEncoding#(#String#encoding#)#{#if#(#isReference#(#)#)#{#throw#tooManyAttributes#(#)#;#}#this#.#encoding#=#encoding#;#}##void#setRefid#(#Reference#r#)#throws#BuildException#{#if#(#encoding#!=#null#)#{#throw#tooManyAttributes#(#)#;#}#if#(#filterChains#.#size#(#)#>#0#||#textDocuments#.#size#(#)#>#0#)#{#throw#noChildrenAllowed#(#)#;#}#super#.#setRefid#(#r#)#;#}##Iterator#iterator#(#)#{#if#(#isReference#(#)#)#{#return#(#(#ResourceList#)#getCheckedRef#(#)#)#.#iterator#(#)#;#}#return#cache#(#)#.#iterator#(#)#;#}##int#size#(#)#{#if#(#isReference#(#)#)#{#return#(#(#ResourceList#)#getCheckedRef#(#)#)#.#size#(#)#;#}#return#cache#(#)#.#size#(#)#;#}##boolean#isFilesystemOnly#(#)#{#if#(#isReference#(#)#)#{#return#(#(#ResourceList#)#getCheckedRef#(#)#)#.#isFilesystemOnly#(#)#;#}#return#cache#(#)#.#isFilesystemOnly#(#)#;#}##void#dieOnCircularReference#(#Stack#stk#,#Project#p#)#throws#BuildException#{#if#(#isChecked#(#)#)#{#return#;#}#if#(#isReference#(#)#)#{#super#.#dieOnCircularReference#(#stk#,#p#)#;#}#else#{#for#(#Iterator#iter#=#textDocuments#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#Object#o#=#(#Object#)#iter#.#next#(#)#;#if#(#o#instanceof#DataType#)#{#pushAndInvokeCircularReferenceCheck#(#(#DataType#)#o#,#stk#,#p#)#;#}#}#for#(#Iterator#iter#=#filterChains#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#FilterChain#fc#=#(#FilterChain#)#iter#.#next#(#)#;#pushAndInvokeCircularReferenceCheck#(#fc#,#stk#,#p#)#;#}#setChecked#(#true#)#;#}#}##ResourceCollection#cache#(#)#{#if#(#!#cached#)#{#dieOnCircularReference#(#)#;#for#(#Iterator#iter#=#textDocuments#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#ResourceCollection#rc#=#(#ResourceCollection#)#iter#.#next#(#)#;#for#(#Iterator#r#=#rc#.#iterator#(#)#;#r#.#hasNext#(#)#;#)#{#cachedResources#.#add#(#read#(#(#Resource#)#r#.#next#(#)#)#)#;#}#}#cached#=#true#;#}#return#cachedResources#;#}##ResourceCollection#read#(#Resource#r#)#{#BufferedInputStream#bis#=#null#;#try#{#bis#=#new#BufferedInputStream#(#r#.#getInputStream#(#)#)#;#Reader#input#=#null#;#if#(#encoding#==#null#)#{#input#=#new#InputStreamReader#(#bis#)#;#}#else#{#input#=#new#InputStreamReader#(#bis#,#encoding#)#;#}#ChainReaderHelper#crh#=#new#ChainReaderHelper#(#)#;#crh#.#setPrimaryReader#(#input#)#;#crh#.#setFilterChains#(#filterChains#)#;#crh#.#setProject#(#getProject#(#)#)#;#BufferedReader#reader#=#new#BufferedReader#(#crh#.#getAssembledReader#(#)#)#;#Union#streamResources#=#new#Union#(#)#;#streamResources#.#setCache#(#true#)#;#String#line#=#null#;#while#(#(#line#=#reader#.#readLine#(#)#)#!=#null#)#{#streamResources#.#add#(#parse#(#line#)#)#;#}#return#streamResources#;#}#catch#(#final#IOException#ioe#)#{#throw#new#BuildException#(#"Unable to read resource "#+#r#.#getName#(#)#+#": "#+#ioe#,#ioe#,#getLocation#(#)#)#;#}#finally#{#FileUtils#.#close#(#bis#)#;#}#}##Resource#parse#(#final#String#line#)#{#PropertyHelper#propertyHelper#=#(#PropertyHelper#)#PropertyHelper#.#getPropertyHelper#(#getProject#(#)#)#;#Object#expanded#=#propertyHelper#.#parseProperties#(#line#)#;#if#(#expanded#instanceof#Resource#)#{#return#(#Resource#)#expanded#;#}#String#expandedLine#=#expanded#.#toString#(#)#;#int#colon#=#expandedLine#.#indexOf#(#":"#)#;#if#(#colon#!=#-#1#)#{#// could be an URL or an absolute file on an OS with drives#try#{#return#new#URLResource#(#expandedLine#)#;#}#catch#(#BuildException#mfe#)#{#// a translated MalformedURLException#// probably it's an absolute path fall back to file#// resource#}#}#return#new#FileResource#(#getProject#(#)#,#expandedLine#)#;#}##