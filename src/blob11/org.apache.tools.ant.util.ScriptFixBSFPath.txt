File#getClassSource#(#ClassLoader#loader#,#String#className#)#{#return#LoaderUtils#.#getResourceSource#(#loader#,#LoaderUtils#.#classNameToResource#(#className#)#)#;#}##File#getClassSource#(#String#className#)#{#return#getClassSource#(#getClass#(#)#.#getClassLoader#(#)#,#className#)#;#}##void#fixClassLoader#(#ClassLoader#loader#,#String#language#)#{#if#(#loader#==#getClass#(#)#.#getClassLoader#(#)#||#!#(#loader#instanceof#AntClassLoader#)#)#{#return#;#}#ClassLoader#myLoader#=#getClass#(#)#.#getClassLoader#(#)#;#AntClassLoader#fixLoader#=#(#AntClassLoader#)#loader#;#// Check for location of bsf in this classloader#File#bsfSource#=#getClassSource#(#BSF_MANAGER#)#;#// If bsf is not in the classloader for this, need to move#// runner.#boolean#needMoveRunner#=#(#bsfSource#==#null#)#;#// Check for location of language#String#languageClassName#=#(#String#)#BSF_LANGUAGE_MAP#.#get#(#language#)#;#// Check if need to need to move bsf#boolean#needMoveBsf#=#bsfSource#!=#null#&&#languageClassName#!=#null#&&#!#LoaderUtils#.#classExists#(#myLoader#,#languageClassName#)#&&#LoaderUtils#.#classExists#(#loader#,#languageClassName#)#;#// Update need to move runner#needMoveRunner#=#needMoveRunner#||#needMoveBsf#;#// Check if bsf in place#if#(#bsfSource#==#null#)#{#bsfSource#=#getClassSource#(#loader#,#BSF_MANAGER#)#;#}#if#(#bsfSource#==#null#)#{#throw#new#BuildException#(#"Unable to find BSF classes for scripting"#)#;#}#if#(#needMoveBsf#)#{#fixLoader#.#addPathComponent#(#bsfSource#)#;#fixLoader#.#addLoaderPackageRoot#(#BSF_PACKAGE#)#;#}#if#(#needMoveRunner#)#{#fixLoader#.#addPathComponent#(#LoaderUtils#.#getResourceSource#(#fixLoader#,#LoaderUtils#.#classNameToResource#(#BSF_SCRIPT_RUNNER#)#)#)#;#fixLoader#.#addLoaderPackageRoot#(#UTIL_OPTIONAL_PACKAGE#)#;#}#}##