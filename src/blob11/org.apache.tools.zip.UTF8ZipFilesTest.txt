void#testUtf8FileRoundtripExplicitUnicodeExtra#(#)#throws#IOException#{#testFileRoundtrip#(#UTF_8#,#true#,#true#)#;#}##void#testUtf8FileRoundtripNoEFSExplicitUnicodeExtra#(#)#throws#IOException#{#testFileRoundtrip#(#UTF_8#,#false#,#true#)#;#}##void#testCP437FileRoundtripExplicitUnicodeExtra#(#)#throws#IOException#{#testFileRoundtrip#(#CP437#,#false#,#true#)#;#}##void#testASCIIFileRoundtripExplicitUnicodeExtra#(#)#throws#IOException#{#testFileRoundtrip#(#US_ASCII#,#false#,#true#)#;#}##void#testUtf8FileRoundtripImplicitUnicodeExtra#(#)#throws#IOException#{#testFileRoundtrip#(#UTF_8#,#true#,#false#)#;#}##void#testUtf8FileRoundtripNoEFSImplicitUnicodeExtra#(#)#throws#IOException#{#testFileRoundtrip#(#UTF_8#,#false#,#false#)#;#}##void#testCP437FileRoundtripImplicitUnicodeExtra#(#)#throws#IOException#{#testFileRoundtrip#(#CP437#,#false#,#false#)#;#}##void#testASCIIFileRoundtripImplicitUnicodeExtra#(#)#throws#IOException#{#testFileRoundtrip#(#US_ASCII#,#false#,#false#)#;#}##void#testZipFileReadsUnicodeFields#(#)#throws#IOException#{#File#file#=#File#.#createTempFile#(#"unicode-test"#,#".zip"#)#;#ZipFile#zf#=#null#;#try#{#createTestFile#(#file#,#US_ASCII#,#false#,#true#)#;#zf#=#new#ZipFile#(#file#,#US_ASCII#,#true#)#;#assertNotNull#(#zf#.#getEntry#(#ASCII_TXT#)#)#;#assertNotNull#(#zf#.#getEntry#(#EURO_FOR_DOLLAR_TXT#)#)#;#assertNotNull#(#zf#.#getEntry#(#OIL_BARREL_TXT#)#)#;#}#finally#{#ZipFile#.#closeQuietly#(#zf#)#;#if#(#file#.#exists#(#)#)#{#file#.#delete#(#)#;#}#}#}##void#testFileRoundtrip#(#String#encoding#,#boolean#withEFS#,#boolean#withExplicitUnicodeExtra#)#throws#IOException#{#File#file#=#File#.#createTempFile#(#encoding#+#"-test"#,#".zip"#)#;#try#{#createTestFile#(#file#,#encoding#,#withEFS#,#withExplicitUnicodeExtra#)#;#testFile#(#file#,#encoding#)#;#}#finally#{#if#(#file#.#exists#(#)#)#{#file#.#delete#(#)#;#}#}#}##void#createTestFile#(#File#file#,#String#encoding#,#boolean#withEFS#,#boolean#withExplicitUnicodeExtra#)#throws#UnsupportedEncodingException#,#IOException#{#ZipEncoding#zipEncoding#=#ZipEncodingHelper#.#getZipEncoding#(#encoding#)#;#ZipOutputStream#zos#=#null#;#try#{#zos#=#new#ZipOutputStream#(#file#)#;#zos#.#setEncoding#(#encoding#)#;#zos#.#setUseLanguageEncodingFlag#(#withEFS#)#;#zos#.#setCreateUnicodeExtraFields#(#withExplicitUnicodeExtra#?#ZipOutputStream#.#UnicodeExtraFieldPolicy#.#NEVER#:#ZipOutputStream#.#UnicodeExtraFieldPolicy#.#ALWAYS#)#;#ZipEntry#ze#=#new#ZipEntry#(#OIL_BARREL_TXT#)#;#if#(#withExplicitUnicodeExtra#&&#!#zipEncoding#.#canEncode#(#ze#.#getName#(#)#)#)#{#ByteBuffer#en#=#zipEncoding#.#encode#(#ze#.#getName#(#)#)#;#ze#.#addExtraField#(#new#UnicodePathExtraField#(#ze#.#getName#(#)#,#en#.#array#(#)#,#en#.#arrayOffset#(#)#,#en#.#limit#(#)#)#)#;#}#zos#.#putNextEntry#(#ze#)#;#zos#.#write#(#"Hello, world!"#.#getBytes#(#"US-ASCII"#)#)#;#zos#.#closeEntry#(#)#;#ze#=#new#ZipEntry#(#EURO_FOR_DOLLAR_TXT#)#;#if#(#withExplicitUnicodeExtra#&&#!#zipEncoding#.#canEncode#(#ze#.#getName#(#)#)#)#{#ByteBuffer#en#=#zipEncoding#.#encode#(#ze#.#getName#(#)#)#;#ze#.#addExtraField#(#new#UnicodePathExtraField#(#ze#.#getName#(#)#,#en#.#array#(#)#,#en#.#arrayOffset#(#)#,#en#.#limit#(#)#)#)#;#}#zos#.#putNextEntry#(#ze#)#;#zos#.#write#(#"Give me your money!"#.#getBytes#(#"US-ASCII"#)#)#;#zos#.#closeEntry#(#)#;#ze#=#new#ZipEntry#(#ASCII_TXT#)#;#if#(#withExplicitUnicodeExtra#&&#!#zipEncoding#.#canEncode#(#ze#.#getName#(#)#)#)#{#ByteBuffer#en#=#zipEncoding#.#encode#(#ze#.#getName#(#)#)#;#ze#.#addExtraField#(#new#UnicodePathExtraField#(#ze#.#getName#(#)#,#en#.#array#(#)#,#en#.#arrayOffset#(#)#,#en#.#limit#(#)#)#)#;#}#zos#.#putNextEntry#(#ze#)#;#zos#.#write#(#"ascii"#.#getBytes#(#"US-ASCII"#)#)#;#zos#.#closeEntry#(#)#;#}#finally#{#if#(#zos#!=#null#)#{#try#{#zos#.#close#(#)#;#}#catch#(#IOException#e#)#{#/* swallow */#}#}#}#}##void#testFile#(#File#file#,#String#encoding#)#throws#IOException#{#ZipFile#zf#=#null#;#try#{#zf#=#new#ZipFile#(#file#,#encoding#,#false#)#;#Enumeration#e#=#zf#.#getEntries#(#)#;#while#(#e#.#hasMoreElements#(#)#)#{#ZipEntry#ze#=#(#ZipEntry#)#e#.#nextElement#(#)#;#if#(#ze#.#getName#(#)#.#endsWith#(#"sser.txt"#)#)#{#assertUnicodeName#(#ze#,#OIL_BARREL_TXT#,#encoding#)#;#}#else#if#(#ze#.#getName#(#)#.#endsWith#(#"_for_Dollar.txt"#)#)#{#assertUnicodeName#(#ze#,#EURO_FOR_DOLLAR_TXT#,#encoding#)#;#}#else#if#(#!#ze#.#getName#(#)#.#equals#(#ASCII_TXT#)#)#{#throw#new#AssertionError#(#"Urecognized ZIP entry with name ["#+#ze#.#getName#(#)#+#"] found."#)#;#}#}#}#finally#{#ZipFile#.#closeQuietly#(#zf#)#;#}#}##UnicodePathExtraField#findUniCodePath#(#ZipEntry#ze#)#{#return#(#UnicodePathExtraField#)#ze#.#getExtraField#(#UnicodePathExtraField#.#UPATH_ID#)#;#}##void#assertUnicodeName#(#ZipEntry#ze#,#String#expectedName#,#String#encoding#)#throws#IOException#{#if#(#!#expectedName#.#equals#(#ze#.#getName#(#)#)#)#{#UnicodePathExtraField#ucpf#=#findUniCodePath#(#ze#)#;#assertNotNull#(#ucpf#)#;#ZipEncoding#enc#=#ZipEncodingHelper#.#getZipEncoding#(#encoding#)#;#ByteBuffer#ne#=#enc#.#encode#(#ze#.#getName#(#)#)#;#CRC32#crc#=#new#CRC32#(#)#;#crc#.#update#(#ne#.#array#(#)#,#ne#.#arrayOffset#(#)#,#ne#.#limit#(#)#)#;#assertEquals#(#crc#.#getValue#(#)#,#ucpf#.#getNameCRC32#(#)#)#;#assertEquals#(#expectedName#,#new#String#(#ucpf#.#getUnicodeName#(#)#,#UTF_8#)#)#;#}#}##