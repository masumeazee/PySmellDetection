String#getSetid#(#)#{#return#setid#;#}##void#setSetid#(#String#id#)#{#setid#=#id#;#}##void#setUseOrigin#(#boolean#useOrigin#)#{#if#(#useOrigin#)#{#throw#new#UnsupportedOperationException#(#"the cachefileset task does not support the useOrigin mode, since filesets "#+#"require to have only one root directory. Please use the the cachepath "#+#"task instead"#)#;#}#}##void#doExecute#(#)#throws#BuildException#{#prepareAndCheck#(#)#;#if#(#setid#==#null#)#{#throw#new#BuildException#(#"setid is required in ivy cachefileset"#)#;#}#try#{#FileSet#fileset#=#new#FileSet#(#)#;#fileset#.#setProject#(#getProject#(#)#)#;#getProject#(#)#.#addReference#(#setid#,#fileset#)#;#List#paths#=#getArtifactReports#(#)#;#File#base#=#null#;#for#(#Iterator#iter#=#paths#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#ArtifactDownloadReport#a#=#(#ArtifactDownloadReport#)#iter#.#next#(#)#;#if#(#a#.#getLocalFile#(#)#!=#null#)#{#base#=#getBaseDir#(#base#,#a#.#getLocalFile#(#)#)#;#}#}#if#(#base#==#null#)#{#fileset#.#setDir#(#new#File#(#"."#)#)#;#NameEntry#ne#=#fileset#.#createExclude#(#)#;#ne#.#setName#(#"**/*"#)#;#}#else#{#fileset#.#setDir#(#base#)#;#for#(#Iterator#iter#=#paths#.#iterator#(#)#;#iter#.#hasNext#(#)#;#)#{#ArtifactDownloadReport#a#=#(#ArtifactDownloadReport#)#iter#.#next#(#)#;#if#(#a#.#getLocalFile#(#)#!=#null#)#{#NameEntry#ne#=#fileset#.#createInclude#(#)#;#ne#.#setName#(#getPath#(#base#,#a#.#getLocalFile#(#)#)#)#;#}#}#}#}#catch#(#Exception#ex#)#{#throw#new#BuildException#(#"impossible to build ivy cache fileset: "#+#ex#,#ex#)#;#}#}##String#getPath#(#File#base#,#File#file#)#{#String#absoluteBasePath#=#base#.#getAbsolutePath#(#)#;#int#beginIndex#=#absoluteBasePath#.#length#(#)#;#// checks if the basePath ends with the file separator (which can for instance#// happen if the basePath is the root on unix)#if#(#!#absoluteBasePath#.#endsWith#(#File#.#separator#)#)#{#beginIndex#++#;#// skip the seperator char as well#}#return#file#.#getAbsolutePath#(#)#.#substring#(#beginIndex#)#;#}##File#getBaseDir#(#File#base#,#File#file#)#{#if#(#base#==#null#)#{#return#file#.#getParentFile#(#)#.#getAbsoluteFile#(#)#;#}#else#{#Iterator#bases#=#getParents#(#base#)#.#iterator#(#)#;#Iterator#fileParents#=#getParents#(#file#.#getAbsoluteFile#(#)#)#.#iterator#(#)#;#File#result#=#null#;#while#(#bases#.#hasNext#(#)#&&#fileParents#.#hasNext#(#)#)#{#File#next#=#(#File#)#bases#.#next#(#)#;#if#(#next#.#equals#(#fileParents#.#next#(#)#)#)#{#result#=#next#;#}#else#{#break#;#}#}#return#result#;#}#}##LinkedList#/*<File>*/#getParents#(#File#file#)#{#LinkedList#r#=#new#LinkedList#(#)#;#while#(#file#!=#null#)#{#r#.#addFirst#(#file#)#;#file#=#file#.#getParentFile#(#)#;#}#return#r#;#}##