void#setUp#(#)#throws#Exception#{#super#.#setUp#(#)#;#helper#=#new#VfsTestHelper#(#)#;#repo#=#new#VfsRepository#(#)#;#scratchDir#=#new#File#(#FileUtil#.#concat#(#VfsTestHelper#.#TEST_REPO_DIR#,#VfsTestHelper#.#SCRATCH_DIR#)#)#;#scratchDir#.#mkdir#(#)#;#}##void#tearDown#(#)#throws#Exception#{#super#.#tearDown#(#)#;#repo#=#null#;#if#(#scratchDir#.#exists#(#)#)#{#FileUtil#.#forceDelete#(#scratchDir#)#;#}#}##void#testPutValid#(#)#throws#Exception#{#String#testResource#=#VfsTestHelper#.#TEST_IVY_XML#;#String#srcFile#=#FileUtil#.#concat#(#VfsTestHelper#.#TEST_REPO_DIR#,#testResource#)#;#String#destResource#=#VfsTestHelper#.#SCRATCH_DIR#+#"/"#+#testResource#;#String#destFile#=#FileUtil#.#concat#(#VfsTestHelper#.#TEST_REPO_DIR#,#destResource#)#;#Iterator#vfsURIs#=#helper#.#createVFSUriSet#(#destResource#)#.#iterator#(#)#;#while#(#vfsURIs#.#hasNext#(#)#)#{#VfsURI#vfsURI#=#(#VfsURI#)#vfsURIs#.#next#(#)#;#if#(#scratchDir#.#exists#(#)#)#{#FileUtil#.#forceDelete#(#scratchDir#)#;#}#try#{#repo#.#put#(#new#File#(#srcFile#)#,#vfsURI#.#toString#(#)#,#false#)#;#if#(#!#new#File#(#srcFile#)#.#exists#(#)#)#{#fail#(#"Put didn't happen. Src VfsURI: "#+#vfsURI#.#toString#(#)#+#".\nExpected file: "#+#destFile#)#;#}#}#catch#(#IOException#e#)#{#fail#(#"Caught unexpected IOException on Vfs URI: "#+#vfsURI#.#toString#(#)#+#"\n"#+#e#.#getLocalizedMessage#(#)#)#;#}#}#}##void#testPutOverwriteTrue#(#)#throws#Exception#{#String#testResource#=#VfsTestHelper#.#TEST_IVY_XML#;#String#srcFile#=#FileUtil#.#concat#(#VfsTestHelper#.#TEST_REPO_DIR#,#testResource#)#;#String#destResource#=#VfsTestHelper#.#SCRATCH_DIR#+#"/"#+#testResource#;#File#destFile#=#new#File#(#FileUtil#.#concat#(#VfsTestHelper#.#TEST_REPO_DIR#,#destResource#)#)#;#Iterator#vfsURIs#=#helper#.#createVFSUriSet#(#destResource#)#.#iterator#(#)#;#while#(#vfsURIs#.#hasNext#(#)#)#{#VfsURI#vfsURI#=#(#VfsURI#)#vfsURIs#.#next#(#)#;#// remove existing scratch dir and populate it with an empty file#// that we can overwrite. We do this so that we can test file sizes.#// seeded file has length 0, while put file will have a length > 0#if#(#scratchDir#.#exists#(#)#)#{#FileUtil#.#forceDelete#(#scratchDir#)#;#}#destFile#.#getParentFile#(#)#.#mkdirs#(#)#;#destFile#.#createNewFile#(#)#;#try#{#repo#.#put#(#new#File#(#srcFile#)#,#vfsURI#.#toString#(#)#,#true#)#;#if#(#!#new#File#(#srcFile#)#.#exists#(#)#)#{#fail#(#"Put didn't happen. Src VfsURI: "#+#vfsURI#.#toString#(#)#+#".\nExpected file: "#+#destFile#)#;#}#if#(#destFile#.#length#(#)#==#0#)#{#fail#(#"Zero file size indicates file not overwritten"#)#;#}#}#catch#(#IOException#e#)#{#fail#(#"Caught unexpected IOException on Vfs URI: "#+#vfsURI#.#toString#(#)#+#"\n"#+#e#.#getLocalizedMessage#(#)#)#;#}#}#}##void#testPutOverwriteFalse#(#)#throws#Exception#{#String#testResource#=#VfsTestHelper#.#TEST_IVY_XML#;#String#srcFile#=#FileUtil#.#concat#(#VfsTestHelper#.#TEST_REPO_DIR#,#testResource#)#;#String#destResource#=#VfsTestHelper#.#SCRATCH_DIR#+#"/"#+#testResource#;#File#destFile#=#new#File#(#FileUtil#.#concat#(#VfsTestHelper#.#TEST_REPO_DIR#,#destResource#)#)#;#destFile#.#getParentFile#(#)#.#mkdirs#(#)#;#destFile#.#createNewFile#(#)#;#Iterator#vfsURIs#=#helper#.#createVFSUriSet#(#destResource#)#.#iterator#(#)#;#while#(#vfsURIs#.#hasNext#(#)#)#{#VfsURI#vfsURI#=#(#VfsURI#)#vfsURIs#.#next#(#)#;#try#{#repo#.#put#(#new#File#(#srcFile#)#,#vfsURI#.#toString#(#)#,#false#)#;#fail#(#"Did not throw expected IOException from attempted overwrite of existing file"#)#;#}#catch#(#IOException#e#)#{#}#}#}##void#testGetNoExisting#(#)#throws#Exception#{#String#testResource#=#VfsTestHelper#.#TEST_IVY_XML#;#String#testFile#=#FileUtil#.#concat#(#scratchDir#.#getAbsolutePath#(#)#,#testResource#)#;#Iterator#vfsURIs#=#helper#.#createVFSUriSet#(#testResource#)#.#iterator#(#)#;#while#(#vfsURIs#.#hasNext#(#)#)#{#VfsURI#vfsURI#=#(#VfsURI#)#vfsURIs#.#next#(#)#;#if#(#scratchDir#.#exists#(#)#)#{#FileUtil#.#forceDelete#(#scratchDir#)#;#}#try#{#repo#.#get#(#vfsURI#.#toString#(#)#,#new#File#(#testFile#)#)#;#if#(#!#new#File#(#testFile#)#.#exists#(#)#)#{#fail#(#"Expected file: "#+#testFile#+#"not found. Failed vfsURI: "#+#vfsURI#.#toString#(#)#)#;#}#}#catch#(#IOException#e#)#{#fail#(#"Caught unexpected IOException on Vfs URI: "#+#vfsURI#.#toString#(#)#+#"\n"#+#e#.#getLocalizedMessage#(#)#)#;#}#}#}##void#testGetOverwriteExisting#(#)#throws#Exception#{#String#testResource#=#VfsTestHelper#.#TEST_IVY_XML#;#File#testFile#=#new#File#(#FileUtil#.#concat#(#scratchDir#.#getAbsolutePath#(#)#,#testResource#)#)#;#Iterator#vfsURIs#=#helper#.#createVFSUriSet#(#testResource#)#.#iterator#(#)#;#while#(#vfsURIs#.#hasNext#(#)#)#{#VfsURI#vfsURI#=#(#VfsURI#)#vfsURIs#.#next#(#)#;#// setup - remove existing scratch area and populate with a file to override#if#(#scratchDir#.#exists#(#)#)#{#FileUtil#.#forceDelete#(#scratchDir#)#;#}#testFile#.#getParentFile#(#)#.#mkdirs#(#)#;#testFile#.#createNewFile#(#)#;#try#{#repo#.#get#(#vfsURI#.#toString#(#)#,#testFile#)#;#if#(#!#testFile#.#exists#(#)#)#{#fail#(#"Expected file: "#+#testFile#+#"not found. Failed vfsURI: "#+#vfsURI#.#toString#(#)#)#;#}#if#(#testFile#.#length#(#)#==#0#)#{#fail#(#"Zero file size indicates file not overwritten"#)#;#}#}#catch#(#IOException#e#)#{#fail#(#"Caught unexpected IOException on Vfs URI: "#+#vfsURI#.#toString#(#)#+#"\n"#+#e#.#getLocalizedMessage#(#)#)#;#}#}#}##void#testGetResourceValidExist#(#)#throws#Exception#{#String#testResource#=#VfsTestHelper#.#TEST_IVY_XML#;#Iterator#vfsURIs#=#helper#.#createVFSUriSet#(#testResource#)#.#iterator#(#)#;#while#(#vfsURIs#.#hasNext#(#)#)#{#VfsURI#vfsURI#=#(#VfsURI#)#vfsURIs#.#next#(#)#;#try#{#assertNotNull#(#repo#.#getResource#(#vfsURI#.#toString#(#)#)#)#;#}#catch#(#IOException#e#)#{#fail#(#"Unexpected IOError on fetch of valid resource"#)#;#e#.#printStackTrace#(#)#;#}#}#}##void#testGetResourceValidNoExist#(#)#throws#Exception#{#String#testResource#=#VfsTestHelper#.#SCRATCH_DIR#+#"/nosuchfile.jar"#;#Iterator#vfsURIs#=#helper#.#createVFSUriSet#(#testResource#)#.#iterator#(#)#;#while#(#vfsURIs#.#hasNext#(#)#)#{#VfsURI#vfsURI#=#(#VfsURI#)#vfsURIs#.#next#(#)#;#// make sure the declared resource does not exist#if#(#scratchDir#.#exists#(#)#)#{#FileUtil#.#forceDelete#(#scratchDir#)#;#}#try#{#assertNotNull#(#repo#.#getResource#(#vfsURI#.#toString#(#)#)#)#;#}#catch#(#IOException#e#)#{#// this should not happen#fail#(#"Unexpected IOException"#)#;#}#}#}##