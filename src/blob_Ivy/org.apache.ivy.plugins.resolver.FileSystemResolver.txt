String#getTypeName#(#)#{#return#"file"#;#}##boolean#isLocal#(#)#{#return#getFileRepository#(#)#.#isLocal#(#)#;#}##void#setLocal#(#boolean#local#)#{#getFileRepository#(#)#.#setLocal#(#local#)#;#}##FileRepository#getFileRepository#(#)#{#return#(#FileRepository#)#getRepository#(#)#;#}##String#getDestination#(#String#pattern#,#Artifact#artifact#,#ModuleRevisionId#mrid#)#{#if#(#supportTransaction#(#)#&&#isTransactionStarted#(#)#)#{#String#destPattern#=#(#String#)#fullTransactionPatterns#.#get#(#pattern#)#;#if#(#destPattern#==#null#)#{#throw#new#IllegalArgumentException#(#"unsupported pattern for publish destination pattern: "#+#pattern#+#". supported patterns: "#+#fullTransactionPatterns#.#keySet#(#)#)#;#}#return#IvyPatternHelper#.#substitute#(#destPattern#,#mrid#,#artifact#)#;#}#else#{#return#super#.#getDestination#(#pattern#,#artifact#,#mrid#)#;#}#}##boolean#isTransactionStarted#(#)#{#return#transactionTempDir#!=#null#;#}##void#abortPublishTransaction#(#)#throws#IOException#{#if#(#supportTransaction#(#)#)#{#if#(#isTransactionStarted#(#)#)#{#try#{#getFileRepository#(#)#.#delete#(#transactionTempDir#)#;#Message#.#info#(#"\tpublish aborted: deleted "#+#transactionTempDir#)#;#}#finally#{#closeTransaction#(#)#;#}#}#else#{#Message#.#info#(#"\tpublish aborted: nothing was started"#)#;#}#}#}##void#commitPublishTransaction#(#)#throws#IOException#{#if#(#supportTransaction#(#)#)#{#if#(#!#isTransactionStarted#(#)#)#{#throw#new#IllegalStateException#(#"no current transaction!"#)#;#}#if#(#transactionDestDir#.#exists#(#)#)#{#throw#new#IOException#(#"impossible to commit transaction: transaction destination directory "#+#"already exists: "#+#transactionDestDir#+#"\npossible cause: usage of identifying tokens after the revision token"#)#;#}#try#{#getFileRepository#(#)#.#move#(#transactionTempDir#,#transactionDestDir#)#;#Message#.#info#(#"\tpublish commited: moved "#+#transactionTempDir#+#" \n\t\tto "#+#transactionDestDir#)#;#}#catch#(#IOException#ex#)#{#IOException#commitEx#;#try#{#getFileRepository#(#)#.#delete#(#transactionTempDir#)#;#commitEx#=#new#IOException#(#"publish transaction commit error for "#+#transactionDestDir#+#": rolled back"#)#;#}#catch#(#IOException#deleteEx#)#{#commitEx#=#new#IOException#(#"publish transaction commit error for "#+#transactionDestDir#+#": rollback impossible either, "#+#"please remove "#+#transactionTempDir#+#" manually"#)#;#}#commitEx#.#initCause#(#ex#)#;#throw#commitEx#;#}#finally#{#closeTransaction#(#)#;#}#}#}##void#beginPublishTransaction#(#ModuleRevisionId#module#,#boolean#overwrite#)#throws#IOException#{#if#(#supportTransaction#(#)#)#{#if#(#isTransactionStarted#(#)#)#{#throw#new#IllegalStateException#(#"a transaction is already started and not closed!"#)#;#}#if#(#overwrite#)#{#unsupportedTransaction#(#"overwrite transaction not supported yet"#)#;#}#else#{#initTransaction#(#module#)#;#if#(#transactionDestDir#.#exists#(#)#)#{#unsupportedTransaction#(#"transaction destination directory already exists: "#+#transactionDestDir#+#"\npossible cause: usage of identifying tokens after the revision token"#)#;#closeTransaction#(#)#;#}#else#{#Message#.#verbose#(#"\tstarting transaction: publish during transaction will be done in \n\t\t"#+#transactionTempDir#+#"\n\tand on commit moved to \n\t\t"#+#transactionDestDir#)#;#}#}#}#}##Collection#filterNames#(#Collection#values#)#{#if#(#supportTransaction#(#)#)#{#values#=#super#.#filterNames#(#values#)#;#for#(#Iterator#iterator#=#values#.#iterator#(#)#;#iterator#.#hasNext#(#)#;#)#{#String#v#=#(#String#)#iterator#.#next#(#)#;#if#(#v#.#endsWith#(#TRANSACTION_DESTINATION_SUFFIX#)#)#{#iterator#.#remove#(#)#;#}#}#return#values#;#}#else#{#return#super#.#filterNames#(#values#)#;#}#}##boolean#supportTransaction#(#)#{#if#(#"false"#.#equals#(#transactional#)#)#{#return#false#;#}#checkSupportTransaction#(#)#;#return#supportTransaction#.#booleanValue#(#)#;#}##void#closeTransaction#(#)#{#transactionTempDir#=#null#;#transactionDestDir#=#null#;#}##void#checkSupportTransaction#(#)#{#if#(#supportTransaction#==#null#)#{#supportTransaction#=#Boolean#.#FALSE#;#List#ivyPatterns#=#getIvyPatterns#(#)#;#List#artifactPatterns#=#getArtifactPatterns#(#)#;#if#(#ivyPatterns#.#size#(#)#>#0#)#{#String#pattern#=#(#String#)#ivyPatterns#.#get#(#0#)#;#Matcher#m#=#TRANSACTION_PATTERN#.#matcher#(#pattern#)#;#if#(#!#m#.#matches#(#)#)#{#unsupportedTransaction#(#"ivy pattern does not use revision as a directory"#)#;#return#;#}#else#{#baseTransactionPattern#=#m#.#group#(#1#)#;#fullTransactionPatterns#.#put#(#pattern#,#m#.#group#(#1#)#+#TRANSACTION_DESTINATION_SUFFIX#+#m#.#group#(#2#)#)#;#}#}#if#(#artifactPatterns#.#size#(#)#>#0#)#{#String#pattern#=#(#String#)#artifactPatterns#.#get#(#0#)#;#Matcher#m#=#TRANSACTION_PATTERN#.#matcher#(#pattern#)#;#if#(#!#m#.#matches#(#)#)#{#unsupportedTransaction#(#"artifact pattern does not use revision as a directory"#)#;#return#;#}#else#if#(#baseTransactionPattern#!=#null#)#{#if#(#!#baseTransactionPattern#.#equals#(#m#.#group#(#1#)#)#)#{#unsupportedTransaction#(#"ivy pattern and artifact pattern "#+#"do not use the same directory for revision"#)#;#return#;#}#else#{#fullTransactionPatterns#.#put#(#pattern#,#m#.#group#(#1#)#+#TRANSACTION_DESTINATION_SUFFIX#+#m#.#group#(#2#)#)#;#}#}#else#{#baseTransactionPattern#=#m#.#group#(#1#)#;#fullTransactionPatterns#.#put#(#pattern#,#m#.#group#(#1#)#+#TRANSACTION_DESTINATION_SUFFIX#+#m#.#group#(#2#)#)#;#}#}#supportTransaction#=#Boolean#.#TRUE#;#}#}##void#unsupportedTransaction#(#String#msg#)#{#String#fullMsg#=#getName#(#)#+#" do not support transaction. "#+#msg#;#if#(#"true"#.#equals#(#transactional#)#)#{#throw#new#IllegalStateException#(#fullMsg#+#". Set transactional attribute to 'auto' or 'false' or fix the problem."#)#;#}#else#{#Message#.#verbose#(#fullMsg#)#;#supportTransaction#=#Boolean#.#FALSE#;#}#}##void#initTransaction#(#ModuleRevisionId#module#)#{#transactionTempDir#=#Checks#.#checkAbsolute#(#IvyPatternHelper#.#substitute#(#baseTransactionPattern#,#ModuleRevisionId#.#newInstance#(#module#,#module#.#getRevision#(#)#+#TRANSACTION_DESTINATION_SUFFIX#)#)#,#"baseTransactionPattern"#)#;#transactionDestDir#=#Checks#.#checkAbsolute#(#IvyPatternHelper#.#substitute#(#baseTransactionPattern#,#module#)#,#"baseTransactionPattern"#)#;#}##String#getTransactional#(#)#{#return#transactional#;#}##void#setTransactional#(#String#transactional#)#{#this#.#transactional#=#transactional#;#}##void#addConfiguredIvy#(#IvyPattern#p#)#{#Checks#.#checkAbsolute#(#p#.#getPattern#(#)#,#"ivy pattern"#)#;#super#.#addConfiguredIvy#(#p#)#;#}##void#addIvyPattern#(#String#pattern#)#{#Checks#.#checkAbsolute#(#pattern#,#"ivy pattern"#)#;#super#.#addIvyPattern#(#pattern#)#;#}##void#addConfiguredArtifact#(#IvyPattern#p#)#{#Checks#.#checkAbsolute#(#p#.#getPattern#(#)#,#"artifact pattern"#)#;#super#.#addConfiguredArtifact#(#p#)#;#}##void#addArtifactPattern#(#String#pattern#)#{#Checks#.#checkAbsolute#(#pattern#,#"artifact pattern"#)#;#super#.#addArtifactPattern#(#pattern#)#;#}##