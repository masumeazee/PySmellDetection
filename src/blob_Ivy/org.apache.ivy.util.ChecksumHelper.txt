void#check#(#File#dest#,#File#checksumFile#,#String#algorithm#)#throws#IOException#{#String#csFileContent#=#FileUtil#.#readEntirely#(#new#BufferedReader#(#new#FileReader#(#checksumFile#)#)#)#.#trim#(#)#.#toLowerCase#(#Locale#.#US#)#;#String#expected#;#if#(#csFileContent#.#indexOf#(#' '#)#>#-#1#&&#(#csFileContent#.#startsWith#(#"md"#)#||#csFileContent#.#startsWith#(#"sha"#)#)#)#{#int#lastSpaceIndex#=#csFileContent#.#lastIndexOf#(#' '#)#;#expected#=#csFileContent#.#substring#(#lastSpaceIndex#+#1#)#;#}#else#{#int#spaceIndex#=#csFileContent#.#indexOf#(#' '#)#;#if#(#spaceIndex#!=#-#1#)#{#expected#=#csFileContent#.#substring#(#0#,#spaceIndex#)#;#}#else#{#expected#=#csFileContent#;#}#}#String#computed#=#computeAsString#(#dest#,#algorithm#)#.#trim#(#)#.#toLowerCase#(#Locale#.#US#)#;#if#(#!#expected#.#equals#(#computed#)#)#{#throw#new#IOException#(#"invalid "#+#algorithm#+#": expected="#+#expected#+#" computed="#+#computed#)#;#}#}##String#computeAsString#(#File#f#,#String#algorithm#)#throws#IOException#{#return#byteArrayToHexString#(#compute#(#f#,#algorithm#)#)#;#}##byte#[#]#compute#(#File#f#,#String#algorithm#)#throws#IOException#{#InputStream#is#=#new#FileInputStream#(#f#)#;#try#{#MessageDigest#md#=#getMessageDigest#(#algorithm#)#;#md#.#reset#(#)#;#byte#[#]#buf#=#new#byte#[#BUFFER_SIZE#]#;#int#len#=#0#;#while#(#(#len#=#is#.#read#(#buf#)#)#!=#-#1#)#{#md#.#update#(#buf#,#0#,#len#)#;#}#return#md#.#digest#(#)#;#}#finally#{#is#.#close#(#)#;#}#}##boolean#isKnownAlgorithm#(#String#algorithm#)#{#return#algorithms#.#containsKey#(#algorithm#)#;#}##MessageDigest#getMessageDigest#(#String#algorithm#)#{#String#mdAlgorithm#=#(#String#)#algorithms#.#get#(#algorithm#)#;#if#(#mdAlgorithm#==#null#)#{#throw#new#IllegalArgumentException#(#"unknown algorithm "#+#algorithm#)#;#}#try#{#return#MessageDigest#.#getInstance#(#mdAlgorithm#)#;#}#catch#(#NoSuchAlgorithmException#e#)#{#throw#new#IllegalArgumentException#(#"unknown algorithm "#+#algorithm#)#;#}#}##String#byteArrayToHexString#(#byte#[#]#in#)#{#byte#ch#=#0x00#;#if#(#in#==#null#||#in#.#length#<=#0#)#{#return#null#;#}#StringBuffer#out#=#new#StringBuffer#(#in#.#length#*#2#)#;#//CheckStyle:MagicNumber OFF#for#(#int#i#=#0#;#i#<#in#.#length#;#i#++#)#{#ch#=#(#byte#)#(#in#[#i#]#&#0xF0#)#;#// Strip off high nibble#ch#=#(#byte#)#(#ch#>#>#>#4#)#;#// shift the bits down#ch#=#(#byte#)#(#ch#&#0x0F#)#;#// must do this is high order bit is on!#out#.#append#(#CHARS#[#(#int#)#ch#]#)#;#// convert the nibble to a String Character#ch#=#(#byte#)#(#in#[#i#]#&#0x0F#)#;#// Strip off low nibble#out#.#append#(#CHARS#[#(#int#)#ch#]#)#;#// convert the nibble to a String Character#}#//CheckStyle:MagicNumber ON#return#out#.#toString#(#)#;#}##